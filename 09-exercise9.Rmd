# Computer intensive methods {#exercise9}

Estimation involves the calculation of a measure with some sense of precision based upon sampling variation.

Only a few estimators (e.g. the sample mean from a normal population) have exact formulae that may be used to estimate sampling variation. Typically, estimates of variability are based upon approximations informed by expected or postulated properties of the sampled population. The development of variance formulae for some measures may require in-depth statistical and mathematical knowledge or may even be impossible to derive.

*Bootstrap* methods are computer-intensive methods that can provide estimates and measures of precision (e.g. confidence intervals) without resort to theoretical models, higher mathematics, or assumptions about the sampled population. They rely on repeated sampling, sometimes called *resampling*, of the observed data.

As a simple example of how such methods work, we will start by using bootstrap methods to estimate the mean from a normal population. We will work with a very simple dataset which we will enter directly:

```{r, eval = TRUE}
x <- c(7.3, 10.4, 14.0, 12.2, 8.4)
```

We can summarise this data quite easily:

```{r, eval = TRUE}
mean(x)
```

The `sample()` function can be used to select a bootstrap `replicate`: 

```{r, eval = TRUE}
sample(x, length(x), replace = TRUE)
```

Enter this command several times to see some more bootstrap replicates. Remember that previous commands can be recalled and edited using the up and down arrow keys â€“ they do not need to be typed out in full each time. The `length()` parameter is not required for taking bootstrap replicates and can be omitted.

It is possible to apply a summary measure to a replicate:

```{r, eval = TRUE}
mean(sample(x, replace = TRUE))
```

Enter this command several times. A bootstrap estimate of the mean of `x` can be made by repeating this process many times and taking the `median` of the means for each replicate.

One way of doing this is to create a matrix where each column contains a bootstrap replicate and then use the `apply()` and `mean()` functions to get at the estimate.

First create the matrix of replicates. Here we take ten replicates:

```{r, eval = TRUE}
x1 <- matrix(sample(x, length(x) * 10, replace = TRUE),
             nrow = length(x), ncol = 10)
x1
```

Then calculate and store the means of each replicate. We can do this using the `apply()` function to apply the `mean()` function to the columns of matrix `x1`:

```{r, eval = TRUE}
x2 <- apply(x1, 2, mean)
x2
```

The bootstrap estimate of the mean is:

```{r, eval = TRUE}
median(x2)
```

The bootstrap estimate may differ somewhat from the mean of `x`: 

```{r, eval = TRUE}
mean(x)
```

The situation is improved by increasing the number of replicates. Here we take 5000 replicates:

```{r, eval = TRUE}
x1 <- matrix(sample(x, length(x) * 5000, replace = TRUE),
             nrow = length(x), ncol = 5000)
x2 <- apply(x1, 2, mean)
median(x2)
```

This is a pretty useless example as estimating the mean / standard deviation, or standard error of the mean of a sample from a normal population can be done using standard formulae.

The utility of bootstrap methods is that they can be applied to summary measures that are not as well understood as the arithmetic mean. The bootstrap method also has the advantage of retaining simplicity even with complicated measures.

To illustrate this, we will work through an example of using the bootstrap to estimate the harmonic mean. 

Again, we will work with a simple dataset which we will enter directly:

```{r, eval = TRUE}
d <- c(43.64, 50.67, 33.56, 27.75, 43.35, 29.56, 38.83, 35.95, 20.01)
```

The data represents distance (in kilometres) from a point source of environmental pollution for nine female patients with oral / pharyngeal cancer.

The harmonic mean is considered to be a sensitive measure of spatial clustering. The first step is to construct a function to calculate the harmonic mean:

```{r, eval = TRUE}
h.mean <- function(x) {length(x) / sum(1 / x)}
```

Calling this function with the sample data:

```{r, eval = TRUE}
h.mean(d)
```

Should return an estimated harmonic mean distance of 33.47 kilometres. This is simple. The problem is that calculating the variance of this estimate is complicated using standard methods. This problem is relatively simple to solve using bootstrap methods:

```{r, eval = TRUE}
replicates <- 5000
n <- length(d)
x1 <- matrix(sample(d, n * replicates, replace = TRUE),
             nrow = n, ncol = replicates)
x2 <- apply(x1, 2, h.mean)
median(x2)
```

A 95% confidence interval can be extracted from `x2` using the `quantile()` function: 

```{r, eval = TRUE}
quantile(x2, c(0.025, 0.975))
```

A 99% confidence interval can also be extracted from `x2` using the `quantile()` function: 

```{r, eval = TRUE}
quantile(x2, c(0.005, 0.995))
```


