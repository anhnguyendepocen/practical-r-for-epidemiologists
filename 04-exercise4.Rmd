# Analysing some data with R {#exercise4}

```{r "setup4", include = FALSE}
require("knitr")
opts_knit$set(root.dir = "data/")
```

In this exercise we will use the `R` functions we have already used and the functions we have added to `R` to
analyse a small dataset. First we will start `R` and retrieve our functions: 

```{r, eval = FALSE}
load("tab2by2.r")
load("lregor.r")
```

And then retrieve and attach the sample dataset:

```{r, eval = TRUE}
gudhiv <- read.table("gudhiv.dat", header = TRUE, na.strings = "X")
attach(gudhiv)
```

This data is from a cross-sectional study of 435 male patients who presented with sexually transmitted infections at an outpatient clinic in The Gambia between August 1988 and June 1990. Several studies have documented an association between genital ulcer disease (GUD) and HIV infection. A study of Gambian prostitutes documented an association between seropositivity for HIV-2 and antibodies against `Treponema pallidum` (a serological test for syphilis). Prostitutes are not the ideal population for such studies as they may have experienced multiple sexually transmitted infections and it is difficult to quantify the number of times they may have had sex with HIV-2 seropositive customers. A sample of males with sexually transmitted infections is easier to study as they have probably had fewer sexual partners than prostitutes and much less contact with sexually transmitted infection pathogens. In such a sample it is also easier to find subjects and collect data. The variables in the dataset are:

+---------------+------------------------------------------------------------+
| **MARRIED**   | Married (1=yes, 0=no)                                      |
+---------------+------------------------------------------------------------+
| **GAMBIAN**   | Gambian Citizen (1=yes, 0=no)                              |
+---------------+------------------------------------------------------------+
| **GUD**       | History of GUD or syphilis (1=yes, 0=no)                   |
+---------------+------------------------------------------------------------+
| **UTIGC**     | History of urethral discharge (1=yes, 0=no)                |
+---------------+------------------------------------------------------------+
| **CIR**       | Circumcised (1=yes, 0=no)                                  |  
+---------------+------------------------------------------------------------+
| **TRAVOUT**   | Travelled outside of Gambia and Senegal (1=yes, 0=no)      |
+---------------+------------------------------------------------------------+
| **SEXPRO**    | Ever had sex with a prostitute (1=yes, 0=no)               |
+---------------+------------------------------------------------------------+
| **INJ12M**    | Injection in previous 12 months (1=yes, 0=no)              |
+---------------+------------------------------------------------------------+
| **PARTNERS**  | Sexual partners in previous 12 months (number)             |
+---------------+------------------------------------------------------------+
| **HIV HIV-2** | positive serology (1=yes, 0=no)                            |
+---------------+------------------------------------------------------------+

Data is available for all 435 patients enrolled in the study.

We will start our analysis by examining pairwise associations between the binary exposure variables and the
HIV variable using the `tab2by2()` function that we wrote earlier:

```{r, eval = FALSE}
tab2by2(MARRIED, HIV)
tab2by2(GAMBIAN, HIV)
tab2by2(GUD, HIV)
tab2by2(UTIGC, HIV)
tab2by2(CIR, HIV)
tab2by2(TRAVOUT, HIV)
tab2by2(SEXPRO, HIV)
tab2by2(INJ12M, HIV)
```

```{r, eval = TRUE}
tab2by2(MARRIED, HIV)
tab2by2(GAMBIAN, HIV)
tab2by2(GUD, HIV)
tab2by2(UTIGC, HIV)
tab2by2(CIR, HIV)
tab2by2(TRAVOUT, HIV)
tab2by2(SEXPRO, HIV)
tab2by2(INJ12M, HIV)
```

Note that our `tab2by2()` function returns misleading risk ratio estimates and confidence intervals for this dataset. This is because the function expects the `exposure` and `outcome` variables to be ordered with exposure-present and outcome-present as the first category (e.g. 1 = present, 2 = absent). This coding is reversed (i.e. 0 = absent, 1 = present) in the `gudhiv` dataset.

We can produce risk ratio estimates for variables in the `gudhiv` data using the `tab2by2()` function and a
simple transformation of the `exposure` and `outcome` variables. For example: 

```{r, eval = TRUE}
tab2by2(2 - GUD, 2 - HIV)
```

The odds ratio estimates returned by the `tab2by2()` function, with or without this transformation, are correct. The `GUD` and `TRAVOUT` variables are associated with `HIV`.

`PARTNERS` is a continuous variable and we should examine its distribution before doing anything with it: 

```{r, eval = FALSE}
table(PARTNERS)
hist(PARTNERS)
```

```{r, echo = FALSE, eval = TRUE}
table(PARTNERS)
hist(PARTNERS)
```

The distribution of `PARTNERS` is severely non-normal. Instead of attempting to transform the variable we will produce summary statistics for each level of the `HIV` variable and perform a non-parametric test:
   
```{r, eval = FALSE}
by(PARTNERS, HIV, summary)
kruskal.test(PARTNERS ~ HIV)
```

```{r, echo = FALSE, eval = TRUE}
by(PARTNERS, HIV, summary)
kruskal.test(PARTNERS ~ HIV)
```

An alternative way of looking at the data is as a tabulation:

```{r, eval = TRUE}
table(PARTNERS, HIV)
```

You can use the `plot()` function to represent this table graphically: 

```{r, eval = TRUE}
plot(table(PARTNERS, HIV), color = c("lightgreen", "red"))
```

There appears to be an association between the number of sexual `PARTNERS` in the previous twelve months and positive `HIV` serology. The proportion with positive `HIV` serology increases as the number of sexual partners increases:

```{r, eval = TRUE}
prop.table(table(PARTNERS, HIV), 1) * 100
```

The **‘1’** instructs the `prop.table()` function to calculate row proportions. You can also use the `plot()` function to represent this table graphically:

```{r, eval = TRUE}
plot(prop.table(table(PARTNERS, HIV), 1) * 100, color = c("lightgreen", "red"))
```

The *chi-square test for trend* is an appropriate test to perform on this data. The `prop.trend.test()` function that performs the *chi-square test for trend* requires you to specify the *number of events* and the *number of trials*. In this table:

```{r, eval = TRUE}
table(PARTNERS, HIV)
```

The *number of events* in each row is in the second column (labelled **1**) and the *number of trials* is the total number of cases in each row of the table.

