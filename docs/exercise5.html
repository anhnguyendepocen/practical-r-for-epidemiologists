<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Practical R for Epidemiologists</title>
  <meta name="description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book.">
  <meta name="generator" content="bookdown 0.7.1 and GitBook 2.6.7">

  <meta property="og:title" content="Practical R for Epidemiologists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://guevarra.io/prfe/" />
  <meta property="og:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />
  <meta property="og:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="github-repo" content="ernestguevarra/practical-r-for-epidemiologists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Practical R for Epidemiologists" />
  
  <meta name="twitter:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="twitter:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />

<meta name="author" content="Mark Myatt">


<meta name="date" content="2018-04-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exercise4.html">
<link rel="next" href="exercise6.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
pre, code { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.bn { color: #0000cf; } /* BaseN */
code span.fl { color: #0000cf; } /* Float */
code span.ch { color: #4e9a06; } /* Char */
code span.st { color: #4e9a06; } /* String */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.ot { color: #8f5902; } /* Other */
code span.al { color: #ef2929; } /* Alert */
code span.fu { color: #000000; } /* Function */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #000000; } /* Constant */
code span.sc { color: #000000; } /* SpecialChar */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #000000; } /* Variable */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.ex { } /* Extension */
code span.at { color: #c4a000; } /* Attribute */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical R for Epidemiologists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Practical R for Epidemiologists</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="introducing-r.html"><a href="introducing-r.html"><i class="fa fa-check"></i><b>1</b> Introducing R</a><ul>
<li class="chapter" data-level="1.1" data-path="introducing-r.html"><a href="introducing-r.html#retrieving-data"><i class="fa fa-check"></i><b>1.1</b> Retrieving data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise1.html"><a href="exercise1.html"><i class="fa fa-check"></i><b>2</b> Getting acquainted with R</a><ul>
<li class="chapter" data-level="2.1" data-path="exercise1.html"><a href="exercise1.html#summary"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise2.html"><a href="exercise2.html"><i class="fa fa-check"></i><b>3</b> Manipulating objects and creating new functions</a><ul>
<li class="chapter" data-level="3.1" data-path="exercise2.html"><a href="exercise2.html#summary-1"><i class="fa fa-check"></i><b>3.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise3.html"><a href="exercise3.html"><i class="fa fa-check"></i><b>4</b> Logistic regression and stratified analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exercise3.html"><a href="exercise3.html#matched-data"><i class="fa fa-check"></i><b>4.1</b> Matched data</a></li>
<li class="chapter" data-level="4.2" data-path="exercise3.html"><a href="exercise3.html#summary-2"><i class="fa fa-check"></i><b>4.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise4.html"><a href="exercise4.html"><i class="fa fa-check"></i><b>5</b> Analysing some data with R</a><ul>
<li class="chapter" data-level="5.1" data-path="exercise4.html"><a href="exercise4.html#summary-3"><i class="fa fa-check"></i><b>5.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise5.html"><a href="exercise5.html"><i class="fa fa-check"></i><b>6</b> Extending R with packages</a><ul>
<li class="chapter" data-level="6.1" data-path="exercise5.html"><a href="exercise5.html#summary-4"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exercise6.html"><a href="exercise6.html"><i class="fa fa-check"></i><b>7</b> Making your own objects behave like R objects</a><ul>
<li class="chapter" data-level="7.1" data-path="exercise6.html"><a href="exercise6.html#summary-5"><i class="fa fa-check"></i><b>7.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercise7.html"><a href="exercise7.html"><i class="fa fa-check"></i><b>8</b> Writing your own graphical functions</a><ul>
<li class="chapter" data-level="8.1" data-path="exercise7.html"><a href="exercise7.html#summary-6"><i class="fa fa-check"></i><b>8.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="exercise8.html"><a href="exercise8.html"><i class="fa fa-check"></i><b>9</b> More graphical functions</a></li>
<li class="chapter" data-level="10" data-path="exercise9.html"><a href="exercise9.html"><i class="fa fa-check"></i><b>10</b> Computer intensive methods</a></li>
<li class="chapter" data-level="11" data-path="whatnow.html"><a href="whatnow.html"><i class="fa fa-check"></i><b>11</b> What now?</a></li>
<li class="divider"></li>
<li>&nbsp; &nbsp; @ Mark Myatt 2018</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical R for Epidemiologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise5" class="section level1">
<h1><span class="header-section-number">6</span> Extending R with packages</h1>
<p><code>R</code> has no built-in functions for survival analysis but, because it is an extensible system, survival analysis is
available as an add-in package. You can find a list of add-in packages at the <code>R</code> website.</p>
<p><a href="http://www.r-project.org/" class="uri">http://www.r-project.org/</a></p>
<p>Add-in packages are installed from the Internet. There are a series of <code>R</code> functions that enable you to download and install add-in packages.</p>
<p>The <code>survival</code> package adds functions to <code>R</code> that enable it to analyse survival data. This package may be downloaded and installed using <code>install.packages(&quot;survival&quot;)</code> or from the <code>Packages</code> or <code>Packages &amp; Data</code> menu if you are using a GUI version of <code>R</code>.</p>
<p>Packages are loaded into <code>R</code> as they are needed using the <code>library()</code> function. Start <code>R</code> and load the <code>survival</code> package:</p>
<pre class="sourceCode r" id="cb442"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1"><span class="kw">library</span>(survival)</a></code></pre>
<p>Before we go any further we should retrieve a dataset:</p>
<pre class="sourceCode r" id="cb443"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" data-line-number="1">ca &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;ca.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb443-2" data-line-number="2"><span class="kw">attach</span>(ca)</a></code></pre>
<p>The columns in this dataset on the survival of cancer patients in two different treatment groups are as follows:</p>
<table style="width:79%;">
<colgroup>
<col width="22%" />
<col width="56%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>time</strong></td>
<td>Survival or censoring time (months)</td>
</tr>
<tr class="even">
<td><strong>status</strong></td>
<td>Censoring status (1=dead, 0=censored)</td>
</tr>
<tr class="odd">
<td><strong>group</strong></td>
<td>Treatment group (1 / 2)</td>
</tr>
</tbody>
</table>
<p>We next need to create a <code>survival</code> object from the <code>time</code> and <code>status</code> variables using the <code>Surv()</code> function:</p>
<pre class="sourceCode r" id="cb444"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1">response &lt;-<span class="st"> </span><span class="kw">Surv</span>(time, status)</a></code></pre>
<p>We can then specify the model for the survival analysis. In this case we state that survival (<code>response</code>) is dependent upon the treatment <code>group</code>:</p>
<pre class="sourceCode r" id="cb445"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" data-line-number="1">ca.surv &lt;-<span class="st"> </span><span class="kw">survfit</span>(response <span class="op">~</span><span class="st"> </span>group)</a></code></pre>
<p>The <code>summary()</code> function applied to a <code>survfit</code> object lists the survival probabilities at each time point with 95% confidence intervals:</p>
<pre class="sourceCode r" id="cb446"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1"><span class="kw">summary</span>(ca.surv)</a></code></pre>
<pre><code>## Call: survfit(formula = response ~ group)
## 
##                 group=1 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     8     22       1    0.955  0.0444       0.8714        1.000
##     9     21       1    0.909  0.0613       0.7966        1.000
##    13     19       1    0.861  0.0744       0.7270        1.000
##    14     17       1    0.811  0.0856       0.6591        0.997
##    18     16       1    0.760  0.0940       0.5963        0.968
##    19     15       1    0.709  0.1005       0.5373        0.936
##    21     14       1    0.659  0.1053       0.4814        0.901
##    23     13       1    0.608  0.1087       0.4282        0.863
##    30     10       1    0.547  0.1136       0.3643        0.822
##    31      9       1    0.486  0.1161       0.3046        0.776
##    32      8       1    0.426  0.1164       0.2489        0.727
##    34      7       1    0.365  0.1146       0.1971        0.675
##    48      5       1    0.292  0.1125       0.1371        0.621
##    56      3       1    0.195  0.1092       0.0647        0.585
## 
##                 group=2 
##  time n.risk n.event survival std.err lower 95% CI upper 95% CI
##     4     24       1   0.9583  0.0408      0.88163        1.000
##     5     23       2   0.8750  0.0675      0.75221        1.000
##     6     21       1   0.8333  0.0761      0.69681        0.997
##     7     20       1   0.7917  0.0829      0.64478        0.972
##     8     19       2   0.7083  0.0928      0.54795        0.916
##     9     17       1   0.6667  0.0962      0.50240        0.885
##    11     16       1   0.6250  0.0988      0.45845        0.852
##    12     15       1   0.5833  0.1006      0.41598        0.818
##    21     12       1   0.5347  0.1033      0.36614        0.781
##    23     11       1   0.4861  0.1047      0.31866        0.742
##    27     10       1   0.4375  0.1049      0.27340        0.700
##    28      9       1   0.3889  0.1039      0.23032        0.657
##    30      8       1   0.3403  0.1017      0.18945        0.611
##    32      7       1   0.2917  0.0981      0.15088        0.564
##    33      6       1   0.2431  0.0930      0.11481        0.515
##    37      5       1   0.1944  0.0862      0.08157        0.464
##    41      4       2   0.0972  0.0650      0.02624        0.360
##    43      2       1   0.0486  0.0473      0.00722        0.327
##    45      1       1   0.0000     NaN           NA           NA</code></pre>
<p>Printing the <code>ca.surv</code> object provides another view of the results:</p>
<pre class="sourceCode r" id="cb448"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" data-line-number="1">ca.surv</a></code></pre>
<pre><code>## Call: survfit(formula = response ~ group)
## 
##          n events median 0.95LCL 0.95UCL
## group=1 22     14     31      21      NA
## group=2 24     22     23      11      37</code></pre>
<p>The <code>plot()</code> function with a <code>survfit</code> object displays the survival curves:</p>
<pre class="sourceCode r" id="cb450"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1"><span class="kw">plot</span>(ca.surv, <span class="dt">xlab =</span> <span class="st">&quot;Months&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Survival&quot;</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-232-1.png" width="672" /></p>
<p>We can make it easier to distinguish between the two lines by specifying a width for each line using thelwd
parameter of the <code>plot()</code> function:</p>
<pre class="sourceCode r" id="cb451"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" data-line-number="1"><span class="kw">plot</span>(ca.surv, <span class="dt">xlab =</span> <span class="st">&quot;Months&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Survival&quot;</span>, <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-233-1.png" width="672" /></p>
<p>It would also be useful to add a legend:</p>
<pre class="sourceCode r" id="cb452"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1"><span class="kw">legend</span>(<span class="dv">125</span>, <span class="dv">1</span>, <span class="kw">names</span>(ca.surv<span class="op">$</span>strata), <span class="dt">lwd =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-235-1.png" width="672" /></p>
<p>If there is only one survival curve to plot then plotting a <code>survfit</code> object will plot the survival curve with 95% confidence limits. You can specify that confidence limits should be plotted when there is more than one survival curve but the results can be disappointing:</p>
<pre class="sourceCode r" id="cb453"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" data-line-number="1"><span class="kw">plot</span>(ca.surv, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-236-1.png" width="672" /></p>
<p>Plots can be improved by specifying different colours for each curve:</p>
<pre class="sourceCode r" id="cb454"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1"><span class="kw">plot</span>(ca.surv, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>, <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>))</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-237-1.png" width="672" /></p>
<p>We can perform a formal test of the two survival times using the <code>survdiff()</code> function:</p>
<pre class="sourceCode r" id="cb455"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" data-line-number="1"><span class="kw">survdiff</span>(response <span class="op">~</span><span class="st"> </span>group)</a></code></pre>
<pre><code>## Call:
## survdiff(formula = response ~ group)
## 
##          N Observed Expected (O-E)^2/E (O-E)^2/V
## group=1 22       14     21.1      2.38      6.26
## group=2 24       22     14.9      3.36      6.26
## 
##  Chisq= 6.3  on 1 degrees of freedom, p= 0.0123</code></pre>
<p>We can now quit <code>R</code>:</p>
<pre class="sourceCode r" id="cb457"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" data-line-number="1"><span class="kw">q</span>()</a></code></pre>
<p>For this exercise there is no need to save the workspace image so click the <strong>No</strong> or <strong>Don’t Save</strong> button (GUI) or enter <code>n</code> when prompted to save the workspace image (terminal).</p>
<div id="summary-4" class="section level2">
<h2><span class="header-section-number">6.1</span> Summary</h2>
<ul>
<li><p><code>R</code> can be extended by adding additional packages. Some packages are included with the standard <code>R</code> installation but many others are available and may be downloaded from the Internet.</p></li>
<li><p>You can find a list of add-in packages at the <code>R</code> website: <a href="http://www.r-project.org/" class="uri">http://www.r-project.org/</a></p></li>
<li><p>Packages may also be downloaded and installed from this site using the <code>install.packages()</code> function or from the <strong>Packages</strong> or <strong>Packages &amp; Data</strong> menu if you are using a GUI version of <code>R</code>.</p></li>
<li><p>Packages are loaded into <code>R</code> as they are needed using the <code>library()</code> function. You can use the <code>search()</code> function to display a list of loaded packages and attached data.frames.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise4.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise6.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["prfe.pdf", "prfe.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
