<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Practical R for Epidemiologists</title>
  <meta name="description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Practical R for Epidemiologists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://guevarra.io/practical-r-for-epidemiologists/" />
  <meta property="og:image" content="https://guevarra.io/practical-r-for-epidemiologists/images/bookcover.jpg" />
  <meta property="og:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="github-repo" content="ernestguevarra/practical-r-for-epidemiologists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Practical R for Epidemiologists" />
  
  <meta name="twitter:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="twitter:image" content="https://guevarra.io/practical-r-for-epidemiologists/images/bookcover.jpg" />

<meta name="author" content="Mark Myatt and Ernest Guevarra">


<meta name="date" content="2018-05-14">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exercise7.html">
<link rel="next" href="exercise9.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118912078-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118912078-1');
</script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical R for Epidemiologists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="introducing-r.html"><a href="introducing-r.html"><i class="fa fa-check"></i>Introducing R</a><ul>
<li class="chapter" data-level="" data-path="introducing-r.html"><a href="introducing-r.html#retrieving-data"><i class="fa fa-check"></i>Retrieving data</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="exercise1.html"><a href="exercise1.html"><i class="fa fa-check"></i><b>1</b> Getting acquainted with R</a><ul>
<li class="chapter" data-level="1.1" data-path="exercise1.html"><a href="exercise1.html#summary"><i class="fa fa-check"></i><b>1.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise2.html"><a href="exercise2.html"><i class="fa fa-check"></i><b>2</b> Manipulating objects and creating new functions</a><ul>
<li class="chapter" data-level="2.1" data-path="exercise2.html"><a href="exercise2.html#summary-1"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise3.html"><a href="exercise3.html"><i class="fa fa-check"></i><b>3</b> Logistic regression and stratified analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="exercise3.html"><a href="exercise3.html#matched-data"><i class="fa fa-check"></i><b>3.1</b> Matched data</a></li>
<li class="chapter" data-level="3.2" data-path="exercise3.html"><a href="exercise3.html#summary-2"><i class="fa fa-check"></i><b>3.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise4.html"><a href="exercise4.html"><i class="fa fa-check"></i><b>4</b> Analysing some data with R</a><ul>
<li class="chapter" data-level="4.1" data-path="exercise4.html"><a href="exercise4.html#summary-3"><i class="fa fa-check"></i><b>4.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise5.html"><a href="exercise5.html"><i class="fa fa-check"></i><b>5</b> Extending R with packages</a><ul>
<li class="chapter" data-level="5.1" data-path="exercise5.html"><a href="exercise5.html#summary-4"><i class="fa fa-check"></i><b>5.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise6.html"><a href="exercise6.html"><i class="fa fa-check"></i><b>6</b> Making your own objects behave like R objects</a><ul>
<li class="chapter" data-level="6.1" data-path="exercise6.html"><a href="exercise6.html#summary-5"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exercise7.html"><a href="exercise7.html"><i class="fa fa-check"></i><b>7</b> Writing your own graphical functions</a><ul>
<li class="chapter" data-level="7.1" data-path="exercise7.html"><a href="exercise7.html#summary-6"><i class="fa fa-check"></i><b>7.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercise8.html"><a href="exercise8.html"><i class="fa fa-check"></i><b>8</b> More graphical functions</a><ul>
<li class="chapter" data-level="8.1" data-path="exercise8.html"><a href="exercise8.html#population-pyramid"><i class="fa fa-check"></i><b>8.1</b> Population pyramid</a></li>
<li class="chapter" data-level="8.2" data-path="exercise8.html"><a href="exercise8.html#pareto-chart"><i class="fa fa-check"></i><b>8.2</b> Pareto chart</a></li>
<li class="chapter" data-level="8.3" data-path="exercise8.html"><a href="exercise8.html#adding-confidence-intervals-or-error-bars-on-plots"><i class="fa fa-check"></i><b>8.3</b> Adding confidence intervals or error bars on plots</a></li>
<li class="chapter" data-level="8.4" data-path="exercise8.html"><a href="exercise8.html#mesh-map"><i class="fa fa-check"></i><b>8.4</b> Mesh map</a></li>
<li class="chapter" data-level="8.5" data-path="exercise8.html"><a href="exercise8.html#combining-plots"><i class="fa fa-check"></i><b>8.5</b> Combining plots</a></li>
<li class="chapter" data-level="8.6" data-path="exercise8.html"><a href="exercise8.html#summary-7"><i class="fa fa-check"></i><b>8.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="exercise9.html"><a href="exercise9.html"><i class="fa fa-check"></i><b>9</b> Computer intensive methods</a><ul>
<li class="chapter" data-level="9.1" data-path="exercise9.html"><a href="exercise9.html#estimation"><i class="fa fa-check"></i><b>9.1</b> Estimation</a></li>
<li class="chapter" data-level="9.2" data-path="exercise9.html"><a href="exercise9.html#hypothesis-testing"><i class="fa fa-check"></i><b>9.2</b> Hypothesis testing</a></li>
<li class="chapter" data-level="9.3" data-path="exercise9.html"><a href="exercise9.html#simulating-processes"><i class="fa fa-check"></i><b>9.3</b> Simulating processes</a></li>
<li class="chapter" data-level="9.4" data-path="exercise9.html"><a href="exercise9.html#cellular-automata-machines"><i class="fa fa-check"></i><b>9.4</b> Cellular automata machines</a></li>
<li class="chapter" data-level="9.5" data-path="exercise9.html"><a href="exercise9.html#summary-8"><i class="fa fa-check"></i><b>9.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="what-now.html"><a href="what-now.html"><i class="fa fa-check"></i>What now?</a></li>
<li class="divider"></li>
<li>&nbsp; &nbsp; @ Mark Myatt and Ernest Guevarra 2018</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical R for Epidemiologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise8" class="section level1">
<h1><span class="header-section-number">Exercise 8</span> More graphical functions</h1>
<p>Graphical functions in <code>R</code> are just like any other function in <code>R</code> in the sense that <code>R</code> provides you with a set of functions which can be altered or added to. In this exercise we will experiment with some of the graphical functions provided by R to demonstrate the flexibility of graphical functions in <code>R</code>. We will then use the graphical functions that we experiment with to create some useful graphical functions of our own.</p>
<p>The first function that we will develop will be a function that is capable of plotting two data series on a single graph. We will take this exercise slowly in order to introduce some further graphical functions.
Before we go any further we should start <code>R</code> and retrieve a dataset:</p>
<p> </p>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb531-1" data-line-number="1">mal &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;malaria.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb531-2" data-line-number="2"><span class="kw">attach</span>(mal)</a></code></pre></div>
<p> </p>
<p>The file <code>malaria.dat</code> contains data on rainfall (in mm) and the number of cases of malaria reported from health centres in an administrative district of Ethiopia between July 1997 and July 1999. The columns in this dataset are as follows:</p>
<p> </p>
<table style="width:72%;">
<colgroup>
<col width="15%" />
<col width="56%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Time</strong></td>
<td>Month and year (as text)</td>
</tr>
<tr class="even">
<td><strong>Cases</strong></td>
<td>Number of cases of malaria reported</td>
</tr>
<tr class="odd">
<td><strong>Rain</strong></td>
<td>Rainfall in mm</td>
</tr>
</tbody>
</table>

<p>Examine the dataset:</p>
<p> </p>
<div class="sourceCode" id="cb532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb532-1" data-line-number="1">mal</a></code></pre></div>
<pre><code>##      Time Cases  Rain
## 1  Jul-97   997  68.5
## 2  Aug-97   824 162.1
## 3  Sep-97   573 138.8
## 4  Oct-97   586 222.2
## 5  Nov-97   523 115.5
## 6  Dec-97   968  37.2
## 7  Jan-98   985  96.6
## 8  Feb-98   745  99.1
## 9  Mar-98   520  51.2
## 10 Apr-98   406  80.0
## 11 May-98   523 112.4
## 12 Jun-98   560 183.7
## 13 Jul-98   671 101.0
## 14 Aug-98   667 252.5
## 15 Sep-98   768  40.8
## 16 Oct-98   990 193.7
## 17 Nov-98   775  17.5
## 18 Dec-98   833   0.0
## 19 Jan-99   672  33.5
## 20 Feb-99   505   0.0
## 21 Mar-99   320 106.8
## 22 Apr-99   274 117.4
## 23 May-99   263 175.8
## 24 Jun-99   264 187.5
## 25 Jul-99   179 283.5</code></pre>

<p>First we will plot the number of cases of malaria seen over time using the <code>plot()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb534-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-345-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The problem with this plot is that it does not treat the data as a time series. Adding the <code>Time</code> variable to the plot does not solve the problem:</p>
<p> </p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb535-1" data-line-number="1"><span class="kw">plot</span>(Time, Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-346-1.png" style="display: block; margin: auto;" /></p>

<p>Because <code>Time</code> is a factor variable. If you convert <code>Time</code> to a character variable using <code>as.character()</code> or prevent <code>R</code> from converting <code>Time</code> to a factor using the <code>as.is</code> parameter to the <code>read.table()</code> function the <code>plot()</code> function will return an error because it expects a numeric x-axis variable. We should, instead, specify a time series (<code>ts</code>) class object. Rather than change the original data, we will create a new object using the <code>ts()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb536-1" data-line-number="1">cases.ts &lt;-<span class="st"> </span><span class="kw">ts</span>(Cases, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">1997</span>, <span class="dv">7</span>), <span class="dt">frequency =</span> <span class="dv">12</span>)</a></code></pre></div>
<p> </p>
<p>Examine the cases.ts object:</p>
<p> </p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb537-1" data-line-number="1">cases.ts</a></code></pre></div>
<pre><code>##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 1997                         997 824 573 586 523 968
## 1998 985 745 520 406 523 560 671 667 768 990 775 833
## 1999 672 505 320 274 263 264 179</code></pre>
<p> </p>
<p>We can now plot <code>cases.ts</code> as a time series:</p>
<p> </p>
<div class="sourceCode" id="cb539"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb539-1" data-line-number="1"><span class="kw">plot</span>(cases.ts)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-349-1.png" style="display: block; margin: auto;" /></p>

<p>We might want to explore the association between the <code>Rain</code> and <code>Cases</code> variables. A simple scatter plot is not particularly informative:</p>
<p> </p>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" data-line-number="1"><span class="kw">plot</span>(Rain, Cases)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-350-1.png" style="display: block; margin: auto;" /></p>

<p>It is better to treat both variables as time series (which they are) and use the built-in <code>plot()</code> methods for objects of class <code>ts</code>:</p>
<p> </p>
<div class="sourceCode" id="cb541"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb541-1" data-line-number="1">rain.cases.ts &lt;-<span class="st"> </span><span class="kw">ts</span>(<span class="kw">cbind</span>(Rain, Cases), <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">1997</span>,<span class="dv">7</span>), <span class="dt">frequency =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb541-2" data-line-number="2"><span class="kw">plot</span>(rain.cases.ts)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-351-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The association between the <code>Rain</code> and <code>Cases</code> variables is now clearer with the number of malaria cases peaking shortly after peaks in rainfall.</p>
<p>The <code>plot()</code> function when used with objects of class <code>ts</code> produces useful output but it is not particularly flexible and the output is, sometimes, not particularly pretty. We can however use basic graphical functions to produce multiple plots. First we will set the <code>mfrow</code> graphical parameter using the <code>par()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</a></code></pre></div>
<p> </p>
<p>The <code>par()</code> function sets a graphical parameter. The <code>mfrow</code> parameter is used to set the number of charts that will appear on a page in rows and columns. We have specified two rows with one chart per row. Test this by plotting two charts:</p>
<p> </p>
<div class="sourceCode" id="cb543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb543-1" data-line-number="1"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-353-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-353-2.png" style="display: block; margin: auto;" /></p>

<p>We will want to have tick-marks on the x-axis of each for each record. We can set the number of tick-marks on axes by setting the <code>lab</code> graphical parameter using the <code>par()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb545"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb545-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(Time), <span class="dv">10</span>, <span class="dv">7</span>))</a></code></pre></div>
<p> </p>
<p>The <code>par()</code> function sets a graphical parameter. The <code>lab</code> parameter is used to set the number tick-marks on the x and y axes and the label size. We have specified a tick-mark on the x-axis for each record (i.e. using <code>length(Time)</code>), ten tick-marks on the y-axis, and a label length of seven. Test this by plotting two charts:</p>
<p> </p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" data-line-number="1"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a>
<a class="sourceLine" id="cb546-2" data-line-number="2"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-356-1.png" style="display: block; margin: auto;" /></p>

<p><img src="prfe_files/figure-html/unnamed-chunk-357-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The problem with these charts is that the month and year are not displayed on the x-axis. We can get round this by plotting a chart without axes and then specifying the axes and labels directly:</p>
<p> </p>
<div class="sourceCode" id="cb547"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb547-1" data-line-number="1"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;mm&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Rainfall&quot;</span>)</a>
<a class="sourceLine" id="cb547-2" data-line-number="2"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(Time), <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Time))</a>
<a class="sourceLine" id="cb547-3" data-line-number="3"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-358-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Cases&quot;</span>)</a>
<a class="sourceLine" id="cb548-2" data-line-number="2"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(Time), <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Time))</a>
<a class="sourceLine" id="cb548-3" data-line-number="3"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-358-2.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The resulting charts now look much better (you may need to resize the plot to display the x-axis labels correctly) but it would be nice to be able draw the two lines on a single chart.</p>
<p>Before proceeding we will use the <code>par()</code> function to specify one plot per window (using the <code>mfrow</code> parameter) and set the default number of tick-marks on the axes (using the <code>lab</code> parameter):</p>
<p> </p>
<div class="sourceCode" id="cb549"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb549-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb549-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">7</span>))</a></code></pre></div>
<p> </p>
<p>And then use the <code>plot()</code> and <code>lines()</code> function to draw the two lines on the same graph:</p>
<p> </p>
<div class="sourceCode" id="cb550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb550-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a>
<a class="sourceLine" id="cb550-2" data-line-number="2"><span class="kw">lines</span>(Rain, <span class="dt">lty =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-360-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The problem with this is that the ranges of the two variables are different and the <code>plot()</code> function automatically sets the y-axis to the range of the specified variable. To fix this problem we need to set the limits of the y-axis to the minimum and maximum value of both of variables using the <code>ylim</code> parameter of the <code>plot()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(Cases, Rain), <span class="kw">max</span>(Cases, Rain)))</a>
<a class="sourceLine" id="cb551-2" data-line-number="2"><span class="kw">lines</span>(Rain, <span class="dt">lty =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-361-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>We can improve the chart by adding a legend:</p>
<p> </p>
<div class="sourceCode" id="cb552"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb552-1" data-line-number="1"><span class="kw">legend</span>(<span class="dv">18</span>, <span class="dv">1000</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Cases&quot;</span>, <span class="st">&quot;Rainfall (mm)&quot;</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-363-1.png" style="display: block; margin: auto;" /></p>

<p>We could continue to improve the chart (e.g. by adding labels for the x-axis tick-marks taken from the <code>Time</code> variable, specifying more meaningful axis labels, and specifying a title) but the chart would be more useful if each variable made full use of the plotting area. We can do this by plotting one chart on top of another by using the <code>new</code> graphical parameter:</p>
<p> </p>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb553-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(Time), <span class="dv">5</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb553-2" data-line-number="2"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb553-3" data-line-number="3"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb553-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb553-5" data-line-number="5"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb553-6" data-line-number="6"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb553-7" data-line-number="7"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-364-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>This chart is much clearer but there are still some improvements that could be made:</p>
<ul>
<li><p>The chart should have a title. We can do this using the <code>main</code> parameter of either of the <code>plot()</code> functions.</p></li>
<li><p>The y-axis labels are displayed on top of each other beside the left-hand y-axis. We can solve this problem by preventing the second <code>plot()</code> function from displaying a y-axis label (i.e. by specifying an empty character string for the <code>ylab</code> parameter).</p></li>
<li><p>We will need to make room on the right-hand side of the chart for an axis label (i.e. by setting the <code>mar</code> (margin) graphical parameter) and place the label there ourselves (using the <code>mtext()</code> function).</p></li>
<li><p>The x-axis should display the month and year which are held as character strings in the <code>Time</code> variable. We can do this using the labels parameter of the <code>axis()</code> function after setting the appropriate number of tick-marks using the <code>lab</code> graphical parameter.</p></li>
</ul>
<p>The x-axis should be properly labelled. We can do this using the <code>xlab</code> parameters of the <code>plot()</code> functions. An empty string must be specified for one of the <code>plot()</code> functions in order to prevent the default label from being displayed.</p>
<p>Try this now:</p>
<p> </p>
<div class="sourceCode" id="cb554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb554-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb554-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(Time), <span class="dv">5</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb554-3" data-line-number="3"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb554-4" data-line-number="4">     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Malaria cases and rainfall&quot;</span>)</a>
<a class="sourceLine" id="cb554-5" data-line-number="5"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb554-6" data-line-number="6"><span class="kw">mtext</span>(<span class="dt">text =</span> <span class="st">&quot;Malaria cases&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb554-7" data-line-number="7"><span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb554-8" data-line-number="8"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb554-9" data-line-number="9">     <span class="dt">xlab =</span> <span class="st">&quot;Month &amp; Year&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb554-10" data-line-number="10"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb554-11" data-line-number="11"><span class="kw">mtext</span>(<span class="dt">text =</span> <span class="st">&quot;Rainfall (mm)&quot;</span>, <span class="dt">side =</span> <span class="dv">4</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb554-12" data-line-number="12"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(Time), <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Time))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-365-1.png" style="display: block; margin: auto;" /></p>

<p>Now that we know how to create a two-axis chart, we can write a function that we will be able to use whenever we need to plot two variables on the same chart. Create a new function called <code>plot2var()</code>:</p>
<p> </p>
<div class="sourceCode" id="cb555"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb555-1" data-line-number="1">plot2var &lt;-<span class="st"> </span><span class="cf">function</span>() {}</a></code></pre></div>
<p> </p>
<p>This creates an empty function called <code>plot2var()</code>.</p>
<p>Use the <code>fix()</code> function to edit the <code>plot2var()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" data-line-number="1"><span class="kw">fix</span>(plot2var)</a></code></pre></div>
<p> </p>
<p>Edit the function to read:</p>
<p> </p>
<div class="sourceCode" id="cb557"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb557-1" data-line-number="1"><span class="cf">function</span>(y1,</a>
<a class="sourceLine" id="cb557-2" data-line-number="2">         y2,</a>
<a class="sourceLine" id="cb557-3" data-line-number="3">         x.ticks,</a>
<a class="sourceLine" id="cb557-4" data-line-number="4">         <span class="dt">x.lab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(x.ticks)),</a>
<a class="sourceLine" id="cb557-5" data-line-number="5">         <span class="dt">y1.lab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y1)),</a>
<a class="sourceLine" id="cb557-6" data-line-number="6">         <span class="dt">y2.lab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y2)),</a>
<a class="sourceLine" id="cb557-7" data-line-number="7">         <span class="dt">main =</span> <span class="kw">paste</span>(y1.lab, <span class="st">&quot;&amp;&quot;</span>, y2.lab)) {</a>
<a class="sourceLine" id="cb557-8" data-line-number="8">  old.par.mar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;mar&quot;</span>)</a>
<a class="sourceLine" id="cb557-9" data-line-number="9">  old.par.lab &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;lab&quot;</span>)</a>
<a class="sourceLine" id="cb557-10" data-line-number="10">  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb557-11" data-line-number="11">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">missing</span>(x.ticks)) {<span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(x.ticks), <span class="dv">5</span>, <span class="dv">7</span>))}</a>
<a class="sourceLine" id="cb557-12" data-line-number="12">  <span class="kw">plot</span>(y1, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb557-13" data-line-number="13">       <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">main =</span> main)</a>
<a class="sourceLine" id="cb557-14" data-line-number="14">  <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb557-15" data-line-number="15">  <span class="kw">mtext</span>(<span class="dt">text =</span> y1.lab, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb557-16" data-line-number="16">  <span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb557-17" data-line-number="17">  <span class="kw">plot</span>(y2, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb557-18" data-line-number="18">       <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> x.lab)</a>
<a class="sourceLine" id="cb557-19" data-line-number="19">  <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb557-20" data-line-number="20">  <span class="kw">mtext</span>(<span class="dt">text =</span> y2.lab, <span class="dt">side =</span> <span class="dv">4</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb557-21" data-line-number="21">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">missing</span>(x.ticks)) {</a>
<a class="sourceLine" id="cb557-22" data-line-number="22">    <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(x.ticks),</a>
<a class="sourceLine" id="cb557-23" data-line-number="23">         <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x.ticks))</a>
<a class="sourceLine" id="cb557-24" data-line-number="24">  } <span class="cf">else</span> {<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>)}</a>
<a class="sourceLine" id="cb557-25" data-line-number="25">  <span class="kw">par</span>(<span class="dt">mar =</span> old.par.mar)</a>
<a class="sourceLine" id="cb557-26" data-line-number="26">  <span class="kw">par</span>(<span class="dt">lab =</span> old.par.lab)</a>
<a class="sourceLine" id="cb557-27" data-line-number="27">}</a></code></pre></div>
<p> </p>
<p>Once you have made the changes shown above, save the file and quit the editor.</p>
<p>Note that with this function we have given some of the parameters default values in the function definition and we have also used the <code>if()</code> function to check whether the user specified a value for the <code>x.ticks</code> parameter. We also save and restore the graphical parameters <code>mar</code> and <code>lab</code> so as to prevent changes to these parameters in the <code>plot2var()</code> function affecting other graphical functions.</p>
<p>Let’s try the <code>plot2var()</code> function with the test data:</p>
<p> </p>
<div class="sourceCode" id="cb558"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb558-1" data-line-number="1"><span class="kw">plot2var</span>(Rain, Cases)</a>
<a class="sourceLine" id="cb558-2" data-line-number="2"><span class="kw">plot2var</span>(Rain, Cases, Time)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-371-1.png" style="display: block; margin: auto;" /></p>

<p><img src="prfe_files/figure-html/unnamed-chunk-372-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Note how the function has used default values for the axis labels and chart title. We can override these default values if we want to:</p>
<p> </p>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb559-1" data-line-number="1"><span class="kw">plot2var</span>(Rain, Cases, Time, <span class="dt">x.lab =</span> <span class="st">&quot;Month and Year&quot;</span>,</a>
<a class="sourceLine" id="cb559-2" data-line-number="2">         <span class="dt">y1.lab =</span> <span class="st">&quot;Rainfall (mm)&quot;</span>, <span class="dt">y2.lab =</span> <span class="st">&quot;Cases of malaria&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-373-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>You might like to use the <code>save()</code> function to save the <code>plot2var()</code> function.</p>
<p>As an exercise you might want to edit the <code>plot2var()</code> function to automatically add a legend to the two-axis
chart using the <code>legend()</code> function with <code>y1.lab</code> and <code>y2.lab</code>. Before continuing we should detach the <code>mal</code> data.frame:</p>
<p> </p>
<div class="sourceCode" id="cb560"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb560-1" data-line-number="1"><span class="kw">detach</span>(mal)</a></code></pre></div>
<div id="population-pyramid" class="section level2">
<h2><span class="header-section-number">8.1</span> Population pyramid</h2>
<p>A common chart type that is not available in many statistical applications and in <code>R</code> is the <em>population pyramid</em>.</p>
<p>Before we go any further we should retrieve a dataset:</p>
<p> </p>
<div class="sourceCode" id="cb561"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb561-1" data-line-number="1">pop &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;pop.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb561-2" data-line-number="2"><span class="kw">attach</span>(pop)</a></code></pre></div>
<pre><code>## The following objects are masked from fem (pos = 4):
## 
##     AGE, SEX</code></pre>
<pre><code>## The following objects are masked from fem (pos = 5):
## 
##     AGE, SEX</code></pre>
<pre><code>## The following objects are masked from fem (pos = 10):
## 
##     AGE, SEX</code></pre>
<p> </p>
<p>The file <code>pop.dat</code> contains data on the age (in months) and sex of 438 children aged between six and sixty months collected as part of a nutritional anthropometry survey of the Khosh Valley in Northeast Afghanistan.</p>
<p>The columns in this dataset are as follows:</p>
<p> </p>
<table style="width:56%;">
<colgroup>
<col width="15%" />
<col width="40%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>AGE</strong></td>
<td>Age of the child in months</td>
</tr>
<tr class="even">
<td><strong>SEX</strong></td>
<td>Sex of the child (M/F)</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Examine the first twenty records of the dataset:</p>
<p> </p>
<div class="sourceCode" id="cb565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb565-1" data-line-number="1">pop[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, ]</a></code></pre></div>
<pre><code>##    AGE SEX
## 1    7   M
## 2   42   M
## 3   60   M
## 4   60   F
## 5   48   M
## 6   60   F
## 7   18   M
## 8   48   M
## 9   60   F
## 10  36   M
## 11  24   F
## 12  60   M
## 13  60   M
## 14  48   F
## 15  18   M
## 16  60   M
## 17   6   M
## 18   7   M
## 19  12   M
## 20  60   M</code></pre>
<p> </p>
<p>The first step is to make groups from the <code>AGE</code> variable since many ages are biased towards full years:</p>
<p> </p>
<div class="sourceCode" id="cb567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb567-1" data-line-number="1"><span class="kw">table</span>(AGE)</a>
<a class="sourceLine" id="cb567-2" data-line-number="2"><span class="kw">barplot</span>(<span class="kw">table</span>(AGE), <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<pre><code>## AGE
##  6  7  8  9 10 12 13 14 15 17 18 22 23 24 25 26 30 34 36 38 40 42 48 54 60 
##  7  5  8 15  3 21  1  3  5  1 45  1  1 48  1  2 24  1 80  2  1  9 67  4 83</code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-378-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>So we will centre the age-groups around the months representing full years:</p>
<p> </p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb569-1" data-line-number="1">age.group &lt;-<span class="st"> </span><span class="kw">cut</span>(AGE, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">17</span>, <span class="dv">29</span>, <span class="dv">41</span>, <span class="dv">53</span>, <span class="dv">99</span>))</a></code></pre></div>

<p>We can check that the grouping operation has worked as expected by tabulating <code>AGE</code> and <code>age.group</code>:</p>
<p> </p>
<div class="sourceCode" id="cb570"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb570-1" data-line-number="1"><span class="kw">table</span>(AGE, age.group)</a></code></pre></div>
<pre><code>##     age.group
## AGE  (0,17] (17,29] (29,41] (41,53] (53,99]
##   6       7       0       0       0       0
##   7       5       0       0       0       0
##   8       8       0       0       0       0
##   9      15       0       0       0       0
##   10      3       0       0       0       0
##   12     21       0       0       0       0
##   13      1       0       0       0       0
##   14      3       0       0       0       0
##   15      5       0       0       0       0
##   17      1       0       0       0       0
##   18      0      45       0       0       0
##   22      0       1       0       0       0
##   23      0       1       0       0       0
##   24      0      48       0       0       0
##   25      0       1       0       0       0
##   26      0       2       0       0       0
##   30      0       0      24       0       0
##   34      0       0       1       0       0
##   36      0       0      80       0       0
##   38      0       0       2       0       0
##   40      0       0       1       0       0
##   42      0       0       0       9       0
##   48      0       0       0      67       0
##   54      0       0       0       0       4
##   60      0       0       0       0      83</code></pre>

<p>We now use the <code>table()</code> function to produce the summary data for the population pyramid:</p>
<p> </p>
<div class="sourceCode" id="cb572"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb572-1" data-line-number="1"><span class="kw">table</span>(age.group, SEX)</a></code></pre></div>
<pre><code>##          SEX
## age.group  F  M
##   (0,17]  34 35
##   (17,29] 54 44
##   (29,41] 49 59
##   (41,53] 39 37
##   (53,99] 41 46</code></pre>
<p> </p>
<p>We will construct our population pyramid using the <code>barplot()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb574"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb574-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(age.group, SEX))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-382-1.png" style="display: block; margin: auto;" /></p>

<p>The default behaviour of the <code>barplot()</code> function is to produce stacked bars. We can set the <code>beside</code> parameter to display the bars side-by-side:</p>
<p> </p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(age.group, SEX), <span class="dt">beside =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-383-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>We can also use the <code>horiz</code> parameter to present the data as horizontal bars:</p>
<p> </p>
<div class="sourceCode" id="cb576"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb576-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(age.group, SEX), <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-384-1.png" style="display: block; margin: auto;" /></p>

<p>In order to centre the bars around zero we need to make one column of the summary data table contain negative numbers:</p>
<p> </p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" data-line-number="1">tab &lt;-<span class="st"> </span><span class="kw">table</span>(age.group, SEX)</a>
<a class="sourceLine" id="cb577-2" data-line-number="2">tab</a></code></pre></div>
<pre><code>##          SEX
## age.group  F  M
##   (0,17]  34 35
##   (17,29] 54 44
##   (29,41] 49 59
##   (41,53] 39 37
##   (53,99] 41 46</code></pre>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" data-line-number="1">tab[ ,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="op">-</span>tab[ ,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb579-2" data-line-number="2">tab</a></code></pre></div>
<pre><code>##          SEX
## age.group   F   M
##   (0,17]  -34  35
##   (17,29] -54  44
##   (29,41] -49  59
##   (41,53] -39  37
##   (53,99] -41  46</code></pre>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" data-line-number="1"><span class="kw">barplot</span>(tab, <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">horiz =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-385-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>This is looking better.</p>
<p>We still need to shift the second set of bars down beside the first set of bars using thespace parameter:</p>
<p> </p>
<div class="sourceCode" id="cb582"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb582-1" data-line-number="1"><span class="kw">barplot</span>(tab, <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">space =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="op">-</span><span class="kw">nrow</span>(tab)))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-386-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The axis labels are wrong but we can fix that using the <code>names.arg</code> parameter:</p>
<p> </p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb583-1" data-line-number="1">bar.names &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">dimnames</span>(tab)<span class="op">$</span>age.group, <span class="kw">dimnames</span>(tab)<span class="op">$</span>age.group)</a>
<a class="sourceLine" id="cb583-2" data-line-number="2"><span class="kw">barplot</span>(tab, <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">space =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="op">-</span><span class="kw">nrow</span>(tab)),</a>
<a class="sourceLine" id="cb583-3" data-line-number="3">        <span class="dt">names.arg =</span> bar.names)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-387-1.png" style="display: block; margin: auto;" /></p>

<p>The chart can still be improved upon by making the fill-colour of each bar white and by expanding the x-axis slightly:</p>
<p> </p>
<div class="sourceCode" id="cb584"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb584-1" data-line-number="1"><span class="kw">barplot</span>(tab, <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">space =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="op">-</span><span class="kw">nrow</span>(tab)),</a>
<a class="sourceLine" id="cb584-2" data-line-number="2">        <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="kw">min</span>(tab) <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>, <span class="kw">max</span>(tab) <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>),</a>
<a class="sourceLine" id="cb584-3" data-line-number="3">        <span class="dt">names.arg =</span> bar.names)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-388-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The chart would be better if the x-axis displayed only positive numbers:</p>
<p> </p>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb585-1" data-line-number="1"><span class="kw">barplot</span>(tab, <span class="dt">beside =</span> <span class="ot">TRUE</span>, <span class="dt">horiz =</span> <span class="ot">TRUE</span>, <span class="dt">space =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="op">-</span><span class="kw">nrow</span>(tab)),</a>
<a class="sourceLine" id="cb585-2" data-line-number="2">        <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="kw">min</span>(tab) <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>, <span class="kw">max</span>(tab) <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>),</a>
<a class="sourceLine" id="cb585-3" data-line-number="3">        <span class="dt">names.arg =</span> bar.names, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb585-4" data-line-number="4"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb585-5" data-line-number="5">     <span class="dt">labels =</span> <span class="kw">abs</span>(<span class="kw">axTicks</span>(<span class="dt">side =</span> <span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb585-6" data-line-number="6">     <span class="dt">at =</span> (<span class="kw">axTicks</span>(<span class="dt">side =</span> <span class="dv">1</span>)))</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-390-1.png" style="display: block; margin: auto;" /></p>
<p>Now we know how to create a population pyramid, we can write a function that we will be able to use whenever we need to plot a population pyramid.</p>
<p>Create a new function called <code>pyramid.plot()</code>:</p>
<p> </p>
<div class="sourceCode" id="cb586"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb586-1" data-line-number="1">pyramid.plot &lt;-<span class="st"> </span><span class="cf">function</span>() {}</a></code></pre></div>
<p> </p>
<p>This creates an empty function called <code>pyramid.plot()</code>.</p>
<p>Use the <code>fix()</code> function to edit the <code>pyramid.plot()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb587-1" data-line-number="1"><span class="kw">fix</span>(pyramid.plot)</a></code></pre></div>

<p>Edit the function to read:</p>
<p> </p>
<div class="sourceCode" id="cb588"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb588-1" data-line-number="1"><span class="cf">function</span>(x,</a>
<a class="sourceLine" id="cb588-2" data-line-number="2">         g,</a>
<a class="sourceLine" id="cb588-3" data-line-number="3">         <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Pyramid plot of&quot;</span>, <span class="kw">deparse</span>(<span class="kw">substitute</span>(x)),</a>
<a class="sourceLine" id="cb588-4" data-line-number="4">                      <span class="st">&quot;by&quot;</span>, <span class="kw">deparse</span>(<span class="kw">substitute</span>(g))),</a>
<a class="sourceLine" id="cb588-5" data-line-number="5">         <span class="dt">xlab =</span> <span class="kw">paste</span>(<span class="kw">deparse</span>(<span class="kw">substitute</span>(g)),</a>
<a class="sourceLine" id="cb588-6" data-line-number="6">                      <span class="st">&quot;(&quot;</span>, <span class="kw">levels</span>(g)[<span class="dv">1</span>], <span class="st">&quot;/&quot;</span>,<span class="kw">levels</span>(g)[<span class="dv">2</span>],<span class="st">&quot;)&quot;</span>),</a>
<a class="sourceLine" id="cb588-7" data-line-number="7">         <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(x))) {</a>
<a class="sourceLine" id="cb588-8" data-line-number="8">  tab &lt;-<span class="st"> </span><span class="kw">table</span>(x, g)</a>
<a class="sourceLine" id="cb588-9" data-line-number="9">  tab[ ,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="op">-</span>tab[ ,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb588-10" data-line-number="10">  <span class="kw">barplot</span>(tab,</a>
<a class="sourceLine" id="cb588-11" data-line-number="11">          <span class="dt">horiz =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb588-12" data-line-number="12">          <span class="dt">beside =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb588-13" data-line-number="13">          <span class="dt">space =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="op">-</span><span class="kw">nrow</span>(tab)),</a>
<a class="sourceLine" id="cb588-14" data-line-number="14">          <span class="dt">names.arg =</span> <span class="kw">c</span>(<span class="kw">dimnames</span>(tab)<span class="op">$</span>x, <span class="kw">dimnames</span>(tab)<span class="op">$</span>x),</a>
<a class="sourceLine" id="cb588-15" data-line-number="15">          <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="kw">min</span>(tab) <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>,</a>
<a class="sourceLine" id="cb588-16" data-line-number="16">          <span class="kw">max</span>(tab) <span class="op">*</span><span class="st"> </span><span class="fl">1.2</span>),</a>
<a class="sourceLine" id="cb588-17" data-line-number="17">          <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>,</a>
<a class="sourceLine" id="cb588-18" data-line-number="18">          <span class="dt">main =</span> main,</a>
<a class="sourceLine" id="cb588-19" data-line-number="19">          <span class="dt">xlab =</span> xlab,</a>
<a class="sourceLine" id="cb588-20" data-line-number="20">          <span class="dt">ylab =</span> ylab,</a>
<a class="sourceLine" id="cb588-21" data-line-number="21">          <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb588-22" data-line-number="22">  <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb588-23" data-line-number="23">       <span class="dt">labels =</span> <span class="kw">abs</span>(<span class="kw">axTicks</span>(<span class="dt">side =</span> <span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb588-24" data-line-number="24">       <span class="dt">at =</span> (<span class="kw">axTicks</span>(<span class="dt">side =</span> <span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb588-25" data-line-number="25">}</a></code></pre></div>
<p> </p>
<p>Note that with this function we have given some of the parameters default values in the function definition.</p>
<p>Giving default values to parameters is useful because it means that you do not need to specify parameters such as titles and axis labels unless you want to. Many <code>R</code> functions use default parameters which are usually set to the most frequently used values.</p>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor. Let’s try the <code>pyramid.plot()</code> function with the test data:</p>
<p> </p>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb589-1" data-line-number="1"><span class="kw">pyramid.plot</span>(age.group, SEX)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-395-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Note how the function has used default values for the axis labels and chart titles. We can override these default values if we want to:</p>
<p> </p>
<div class="sourceCode" id="cb590"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb590-1" data-line-number="1"><span class="kw">pyramid.plot</span>(age.group, SEX, <span class="dt">ylab =</span> <span class="st">&quot;Months&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Sex F / M&quot;</span>,</a>
<a class="sourceLine" id="cb590-2" data-line-number="2">             <span class="dt">main =</span> <span class="st">&quot;Children by age and sex&quot;</span>)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-397-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>You might like to use the <code>save()</code> function to save the <code>pyramid.plot()</code> function.</p>
</div>
<div id="pareto-chart" class="section level2">
<h2><span class="header-section-number">8.2</span> Pareto chart</h2>
<p>Another type of chart that is missing from many statistical applications is the <em>Pareto</em> chart which is a bar chart where the bars are sorted by the bar value with the largest bar drawn first. Such a chart is easier to interpret than a pie chart, particularly when there are more than a few categories being plotted.</p>
<p>Before we go any further we should detach the <code>pop</code> data.frame and retrieve a new dataset:</p>
<p> </p>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb591-1" data-line-number="1"><span class="kw">detach</span>(pop)</a>
<a class="sourceLine" id="cb591-2" data-line-number="2">sssw &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;sssw.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb591-3" data-line-number="3"><span class="kw">attach</span>(sssw)</a></code></pre></div>
<p> </p>
<p>The file <code>sssw.dat</code> contains data on the marital status, home circumstances, and ethnic group of 152 persons recruited into a study into the levels of stress experienced by student social workers in the United Kingdom. The columns in this dataset are as follows:</p>
<p> </p>
<table style="width:79%;">
<colgroup>
<col width="22%" />
<col width="56%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>marital</strong></td>
<td><p>Marital status coded as:</p>
<p>1 = Married</p>
<p>2 = Single</p>
<p>3 = Divorced</p>
<p>4 = Separated</p>
<p>5 = Cohabiting</p>
<p>6 = Widowed</p></td>
</tr>
</tbody>
</table>
<table style="width:79%;">
<colgroup>
<col width="22%" />
<col width="56%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>living</strong></td>
<td><p>Living with… coded as:</p>
<p>1 = Alone</p>
<p>2 = Parents or siblings</p>
<p>3 = Partner</p>
<p>4 = Partner and children</p>
<p>5 = Children</p>
<p>6 = Friends or colleagues</p></td>
</tr>
</tbody>
</table>
<table style="width:79%;">
<colgroup>
<col width="22%" />
<col width="56%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>ethnic</strong></td>
<td><p>Ethnic group coded as:</p>
<p>1 = African</p>
<p>2 = West-Indian</p>
<p>3 = Indian</p>
<p>4 = Pakistani</p>
<p>5 = Bangladeshi</p>
<p>6 = East African Asian</p>
<p>7 = Chinese</p>
<p>8 = Cypriot</p>
<p>9 = Black European</p>
<p>10 = White European</p>
<p>11 = Other</p></td>
</tr>
</tbody>
</table>

<p>Examine the dataset:</p>
<p> </p>
<div class="sourceCode" id="cb592"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb592-1" data-line-number="1">sssw[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>, ]</a></code></pre></div>
<pre><code>##    marital living ethnic
## 1        2      5      2
## 2        1      4      2
## 3        1      1     11
## 4        1      4     10
## 5        2      3     10
## 6        2      6     10
## 7        1      4     10
## 8        1      4     10
## 9        2      2      4
## 10       2      6     10
## 11       2      5     10
## 12       1      3      1
## 13       5      3     10
## 14       1      4     10
## 15       2      6      3
## 16       1      4     10
## 17       1      3      3
## 18       5      3     10
## 19       3      5     10
## 20       5      3     10</code></pre>
<p> </p>
<p>Producing a bar chart from this data is simple as long as we remember to pass summary data (i.e. created using the <code>table()</code> function) to the <code>barplot()</code> function instead of the variable name:</p>
<p> </p>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb594-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(marital))</a>
<a class="sourceLine" id="cb594-2" data-line-number="2"><span class="kw">barplot</span>(<span class="kw">table</span>(living))</a>
<a class="sourceLine" id="cb594-3" data-line-number="3"><span class="kw">barplot</span>(<span class="kw">table</span>(ethnic))</a></code></pre></div>

<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(marital))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-401-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb596-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(living))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-402-1.png" style="display: block; margin: auto;" /></p>

<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">table</span>(ethnic))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-403-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Creating a Pareto chart only requires us to sort the summary data. We do this using the <code>rev()</code> and <code>sort()</code> functions:</p>
<p> </p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb598-1" data-line-number="1"><span class="kw">barplot</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">table</span>(marital))))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-404-1.png" width="672" /></p>

<p>Having to specify <code>rev(sort(table(variable)))</code> each time we want to produce a <em>Pareto</em> plot is rather tedious but now that we know how to create a <em>Pareto</em> chart, we can write a function that we will be able to use whenever we need to plot a Pareto chart. Create a new function called <code>pareto()</code>:</p>
<p> </p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1">pareto &lt;-<span class="st"> </span><span class="cf">function</span>() {}</a></code></pre></div>
<p> </p>
<p>This creates an empty function called <code>pareto()</code>. Use the <code>fix()</code> function to edit the <code>pareto()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb600-1" data-line-number="1"><span class="kw">fix</span>(pareto)</a></code></pre></div>
<p>Edit the function to read:</p>
<p> </p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" data-line-number="1"><span class="cf">function</span>(x,</a>
<a class="sourceLine" id="cb601-2" data-line-number="2">         <span class="dt">xlab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(x)),</a>
<a class="sourceLine" id="cb601-3" data-line-number="3">         <span class="dt">ylab =</span> <span class="st">&quot;Count&quot;</span>,</a>
<a class="sourceLine" id="cb601-4" data-line-number="4">         <span class="dt">main =</span> <span class="kw">paste</span>(<span class="st">&quot;Pareto Chart of&quot;</span>, <span class="kw">deparse</span>(<span class="kw">substitute</span>(x)))) {</a>
<a class="sourceLine" id="cb601-5" data-line-number="5">  <span class="kw">barplot</span>(<span class="kw">rev</span>(<span class="kw">sort</span>(<span class="kw">table</span>(x))),</a>
<a class="sourceLine" id="cb601-6" data-line-number="6">          <span class="dt">xlab =</span> xlab,</a>
<a class="sourceLine" id="cb601-7" data-line-number="7">          <span class="dt">ylab =</span> ylab,</a>
<a class="sourceLine" id="cb601-8" data-line-number="8">          <span class="dt">main =</span> main,</a>
<a class="sourceLine" id="cb601-9" data-line-number="9">          <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</a>
<a class="sourceLine" id="cb601-10" data-line-number="10">}</a></code></pre></div>
<p> </p>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>

<p>Let’s try the <code>pareto()</code> function with the test data:</p>
<p> </p>
<div class="sourceCode" id="cb602"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb602-1" data-line-number="1"><span class="kw">pareto</span>(marital)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-409-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Note how the function has used default values for the axis labels and chart titles. We can override these default values if we want to:</p>
<p> </p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1"><span class="kw">pareto</span>(marital, <span class="dt">ylab =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Marital Status&quot;</span>,</a>
<a class="sourceLine" id="cb603-2" data-line-number="2">       <span class="dt">main =</span> <span class="st">&quot;Marital Status&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-410-1.png" style="display: block; margin: auto;" /></p>

<p>Note that we can use value labels if the variable we plot is a factor with value labels as levels rather than a simple numeric vector:</p>
<p> </p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb604-1" data-line-number="1">ms &lt;-<span class="st"> </span><span class="kw">as.factor</span>(marital)</a>
<a class="sourceLine" id="cb604-2" data-line-number="2"><span class="kw">levels</span>(ms) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Married&quot;</span>, <span class="st">&quot;Single&quot;</span>, <span class="st">&quot;Divorced&quot;</span>, <span class="st">&quot;Separated&quot;</span>,</a>
<a class="sourceLine" id="cb604-3" data-line-number="3">                <span class="st">&quot;Cohabiting&quot;</span>, <span class="st">&quot;Widowed&quot;</span>)</a>
<a class="sourceLine" id="cb604-4" data-line-number="4"><span class="kw">table</span>(ms)</a>
<a class="sourceLine" id="cb604-5" data-line-number="5"><span class="kw">pareto</span>(ms, <span class="dt">ylab =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Marital Status&quot;</span>,</a>
<a class="sourceLine" id="cb604-6" data-line-number="6">       <span class="dt">main =</span> <span class="st">&quot;Marital Status&quot;</span>)</a></code></pre></div>
<pre><code>## ms
##    Married     Single   Divorced  Separated Cohabiting    Widowed 
##         32         90          5          4         21          0</code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-412-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>You may need to resize the plot to display the x-axis labels correctly.</p>
<p>You might like to use the <code>save()</code> function to save the <code>pareto()</code> function.</p>

</div>
<div id="adding-confidence-intervals-or-error-bars-on-plots" class="section level2">
<h2><span class="header-section-number">8.3</span> Adding confidence intervals or error bars on plots</h2>
<p>You may want to plot your data with confidence intervals or error bars. <code>R</code> does not have a function to do this but it is a relatively simple matter to write a function to do so. On the way we will use some of <code>R</code>s data management functions as well.</p>
<p>Before we go any further we should detach the <code>sssw</code> data.frame and retrieve a new dataset:</p>
<p> </p>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb606-1" data-line-number="1"><span class="kw">detach</span>(sssw)</a>
<a class="sourceLine" id="cb606-2" data-line-number="2">diets &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;diets.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p> </p>
<p>The file <code>diets.dat</code> contains data from a trial of two different diets undertaken at an adult therapeutic feeding centre in Somalia. The columns in this dataset are as follows:</p>
<p> </p>
<table>
<colgroup>
<col width="16%" />
<col width="83%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>day</strong></td>
<td>The day after start of diet that measurements were taken</td>
</tr>
<tr class="even">
<td><strong>oedema</strong></td>
<td>Type of undernutrition coded as: 1 = Oedematous; 2 = Marasmic</td>
</tr>
<tr class="odd">
<td><strong>diet</strong></td>
<td>The trial diets coded as: LP = Low protein; HP = High protein</td>
</tr>
<tr class="even">
<td><strong>wt</strong></td>
<td>Mean weight change weight velocity) in g/kg/day since the previous measurement</td>
</tr>
<tr class="odd">
<td><strong>sd</strong></td>
<td>Standard deviation of weight change in g/kg/day</td>
</tr>
<tr class="even">
<td><strong>n</strong></td>
<td>Number of subjects at each observation</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Examine the dataset:</p>
<p> </p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1">diets</a></code></pre></div>
<pre><code>##    day oedema diet   wt   sd   n
## 1    3      1   HP  1.1 11.5  37
## 2    6      1   HP  1.0 11.0  37
## 3    9      1   HP  1.2  8.4  37
## 4   12      1   HP -1.0  7.4  37
## 5   15      1   HP -0.9  3.2  37
## 6   18      1   HP -1.7  5.8  37
## 7   21      1   HP -1.7  4.8  37
## 8   24      1   HP -1.7  4.8  37
## 9   27      1   HP -1.7  5.3  37
## 10  30      1   HP -2.5  6.8  37
## 11  33      1   HP -1.3  8.4  37
## 12   3      2   HP  5.1 15.1 291
## 13   6      2   HP  5.1 13.4 291
## 14   9      2   HP  4.5  6.5 291
## 15  12      2   HP  5.2  9.9 291
## 16  15      2   HP  4.6  8.2 291
## 17  18      2   HP  5.1 13.4 291
## 18  21      2   HP  5.0 13.4 291
## 19  24      2   HP  5.2 15.1 291
## 20  27      2   HP  5.1 11.6 291
## 21  30      2   HP  5.0  9.2 291
## 22  33      2   HP  5.2  8.2 291
## 23   3      1   LP -3.0 15.7  65
## 24   6      1   LP -2.5 11.9  65
## 25   9      1   LP -2.0 13.7  65
## 26  12      1   LP  2.0 11.0  65
## 27  15      1   LP  2.1 13.2  65
## 28  18      1   LP  1.7 16.2  65
## 29  21      1   LP  4.0 11.0  65
## 30  24      1   LP  6.5 14.7  65
## 31  27      1   LP  6.4 10.2  65
## 32  30      1   LP  6.6  8.0  65
## 33  33      1   LP  6.5 11.0  65
## 34   3      2   LP  5.1 11.1  86
## 35   6      2   LP  6.0  8.2  86
## 36   9      2   LP  5.1  8.2  86
## 37  12      2   LP  6.5 11.9  86
## 38  15      2   LP  6.4  9.1  86
## 39  18      2   LP  5.9 13.8  86
## 40  21      2   LP  6.1 16.5  86
## 41  24      2   LP  4.0  9.1  86
## 42  27      2   LP  3.1 12.8  86
## 43  30      2   LP  4.0  7.3  86
## 44  33      2   LP  5.0  9.1  86</code></pre>

<p>Note that the dataset contains a summary of the results from the four arms of the trial:</p>
<p> </p>
<table style="width:74%;">
<colgroup>
<col width="15%" />
<col width="22%" />
<col width="36%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"><strong>Arm</strong></th>
<th align="center"><strong>Oedema</strong></th>
<th align="center"><strong>Therapeutic diet</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">Present</td>
<td align="center">High protein</td>
</tr>
<tr class="even">
<td align="center">2</td>
<td align="center">Present</td>
<td align="center">Low protein</td>
</tr>
<tr class="odd">
<td align="center">3</td>
<td align="center">Absent</td>
<td align="center">High protein</td>
</tr>
<tr class="even">
<td align="center">4</td>
<td align="center">Absent</td>
<td align="center">Low protein</td>
</tr>
</tbody>
</table>
<p> </p>
<p>with observations at 3, 6, 9, 12, 15, 18, 21, 24, 27, 30, and 33 days after admission.</p>
<p>We can calculate a confidence interval for the mean weight velocity (<code>wt</code>) using the data in the <code>sd</code> and <code>n</code>
variables. We will use the <code>transform()</code> function to do this:</p>
<p> </p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb609-1" data-line-number="1">diets &lt;-<span class="st"> </span><span class="kw">transform</span>(diets, <span class="dt">lci =</span> wt <span class="op">-</span><span class="st"> </span>sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n), <span class="dt">uci =</span> wt <span class="op">+</span><span class="st"> </span>sd <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n))</a></code></pre></div>
<p> </p>
<p>In this case we are calculating confidence intervals as plus or minus one standard error of the mean.</p>
<p>The <code>transform()</code> function is very useful as it can add columns directly to a data.frame or transform data already stored in a data.frame.</p>

<p>Examine the <code>diets</code> data.frame:</p>
<p> </p>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb610-1" data-line-number="1">diets</a></code></pre></div>
<pre><code>##    day oedema diet   wt   sd   n        lci         uci
## 1    3      1   HP  1.1 11.5  37 -0.7905884  2.99058835
## 2    6      1   HP  1.0 11.0  37 -0.8083889  2.80838886
## 3    9      1   HP  1.2  8.4  37 -0.1809515  2.58095149
## 4   12      1   HP -1.0  7.4  37 -2.2165525  0.21655251
## 5   15      1   HP -0.9  3.2  37 -1.4260768 -0.37392324
## 6   18      1   HP -1.7  5.8  37 -2.6535141 -0.74648587
## 7   21      1   HP -1.7  4.8  37 -2.4891151 -0.91088486
## 8   24      1   HP -1.7  4.8  37 -2.4891151 -0.91088486
## 9   27      1   HP -1.7  5.3  37 -2.5713146 -0.82868537
## 10  30      1   HP -2.5  6.8  37 -3.6179131 -1.38208689
## 11  33      1   HP -1.3  8.4  37 -2.6809515  0.08095149
## 12   3      2   HP  5.1 15.1 291  4.2148223  5.98517768
## 13   6      2   HP  5.1 13.4 291  4.3144781  5.88552191
## 14   9      2   HP  4.5  6.5 291  4.1189633  4.88103675
## 15  12      2   HP  5.2  9.9 291  4.6196517  5.78034828
## 16  15      2   HP  4.6  8.2 291  4.1193075  5.08069251
## 17  18      2   HP  5.1 13.4 291  4.3144781  5.88552191
## 18  21      2   HP  5.0 13.4 291  4.2144781  5.78552191
## 19  24      2   HP  5.2 15.1 291  4.3148223  6.08517768
## 20  27      2   HP  5.1 11.6 291  4.4199960  5.78000404
## 21  30      2   HP  5.0  9.2 291  4.4606864  5.53931355
## 22  33      2   HP  5.2  8.2 291  4.7193075  5.68069251
## 23   3      1   LP -3.0 15.7  65 -4.9473453 -1.05265467
## 24   6      1   LP -2.5 11.9  65 -3.9760133 -1.02398666
## 25   9      1   LP -2.0 13.7  65 -3.6992759 -0.30072414
## 26  12      1   LP  2.0 11.0  65  0.6356179  3.36438208
## 27  15      1   LP  2.1 13.2  65  0.4627415  3.73725850
## 28  18      1   LP  1.7 16.2  65 -0.3093627  3.70936270
## 29  21      1   LP  4.0 11.0  65  2.6356179  5.36438208
## 30  24      1   LP  6.5 14.7  65  4.6766894  8.32331060
## 31  27      1   LP  6.4 10.2  65  5.1348457  7.66515429
## 32  30      1   LP  6.6  8.0  65  5.6077221  7.59227788
## 33  33      1   LP  6.5 11.0  65  5.1356179  7.86438208
## 34   3      2   LP  5.1 11.1  86  3.9030562  6.29694378
## 35   6      2   LP  6.0  8.2  86  5.1157713  6.88422874
## 36   9      2   LP  5.1  8.2  86  4.2157713  5.98422874
## 37  12      2   LP  6.5 11.9  86  5.2167900  7.78321000
## 38  15      2   LP  6.4  9.1  86  5.4187218  7.38127824
## 39  18      2   LP  5.9 13.8  86  4.4119077  7.38809227
## 40  21      2   LP  6.1 16.5  86  4.3207592  7.87924076
## 41  24      2   LP  4.0  9.1  86  3.0187218  4.98127824
## 42  27      2   LP  3.1 12.8  86  1.7197405  4.48025950
## 43  30      2   LP  4.0  7.3  86  3.2128208  4.78717924
## 44  33      2   LP  5.0  9.1  86  4.0187218  5.98127824</code></pre>
<p> </p>
<p>Two new columns (<code>lci</code> and <code>uci</code>) have been added.</p>
<p>Now that we have calculated the confidence intervals we should, for convenience, split the diets data.frame
into four separate data.frames (one for each arm of the trial):</p>
<p> </p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb612-1" data-line-number="1">oed.hp &lt;-<span class="st"> </span><span class="kw">subset</span>(diets, oedema <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>diet <span class="op">==</span><span class="st"> &quot;HP&quot;</span>)</a>
<a class="sourceLine" id="cb612-2" data-line-number="2">oed.lp &lt;-<span class="st"> </span><span class="kw">subset</span>(diets, oedema <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>diet <span class="op">==</span><span class="st"> &quot;LP&quot;</span>)</a>
<a class="sourceLine" id="cb612-3" data-line-number="3">mar.hp &lt;-<span class="st"> </span><span class="kw">subset</span>(diets, oedema <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>diet <span class="op">==</span><span class="st"> &quot;HP&quot;</span>)</a>
<a class="sourceLine" id="cb612-4" data-line-number="4">mar.lp &lt;-<span class="st"> </span><span class="kw">subset</span>(diets, oedema <span class="op">==</span><span class="st"> </span><span class="dv">2</span> <span class="op">&amp;</span><span class="st"> </span>diet <span class="op">==</span><span class="st"> &quot;LP&quot;</span>)</a></code></pre></div>
<p> </p>
<p>Check that each data.frame contains the data that you expect it to:</p>
<p> </p>
<div class="sourceCode" id="cb613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb613-1" data-line-number="1">oed.hp</a>
<a class="sourceLine" id="cb613-2" data-line-number="2">oed.lp</a>
<a class="sourceLine" id="cb613-3" data-line-number="3">mar.hp</a>
<a class="sourceLine" id="cb613-4" data-line-number="4">mar.lp</a></code></pre></div>

<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb614-1" data-line-number="1">oed.hp</a></code></pre></div>
<pre><code>##    day oedema diet   wt   sd  n        lci         uci
## 1    3      1   HP  1.1 11.5 37 -0.7905884  2.99058835
## 2    6      1   HP  1.0 11.0 37 -0.8083889  2.80838886
## 3    9      1   HP  1.2  8.4 37 -0.1809515  2.58095149
## 4   12      1   HP -1.0  7.4 37 -2.2165525  0.21655251
## 5   15      1   HP -0.9  3.2 37 -1.4260768 -0.37392324
## 6   18      1   HP -1.7  5.8 37 -2.6535141 -0.74648587
## 7   21      1   HP -1.7  4.8 37 -2.4891151 -0.91088486
## 8   24      1   HP -1.7  4.8 37 -2.4891151 -0.91088486
## 9   27      1   HP -1.7  5.3 37 -2.5713146 -0.82868537
## 10  30      1   HP -2.5  6.8 37 -3.6179131 -1.38208689
## 11  33      1   HP -1.3  8.4 37 -2.6809515  0.08095149</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" data-line-number="1">oed.lp</a></code></pre></div>
<pre><code>##    day oedema diet   wt   sd  n        lci        uci
## 23   3      1   LP -3.0 15.7 65 -4.9473453 -1.0526547
## 24   6      1   LP -2.5 11.9 65 -3.9760133 -1.0239867
## 25   9      1   LP -2.0 13.7 65 -3.6992759 -0.3007241
## 26  12      1   LP  2.0 11.0 65  0.6356179  3.3643821
## 27  15      1   LP  2.1 13.2 65  0.4627415  3.7372585
## 28  18      1   LP  1.7 16.2 65 -0.3093627  3.7093627
## 29  21      1   LP  4.0 11.0 65  2.6356179  5.3643821
## 30  24      1   LP  6.5 14.7 65  4.6766894  8.3233106
## 31  27      1   LP  6.4 10.2 65  5.1348457  7.6651543
## 32  30      1   LP  6.6  8.0 65  5.6077221  7.5922779
## 33  33      1   LP  6.5 11.0 65  5.1356179  7.8643821</code></pre>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" data-line-number="1">mar.hp</a></code></pre></div>
<pre><code>##    day oedema diet  wt   sd   n      lci      uci
## 12   3      2   HP 5.1 15.1 291 4.214822 5.985178
## 13   6      2   HP 5.1 13.4 291 4.314478 5.885522
## 14   9      2   HP 4.5  6.5 291 4.118963 4.881037
## 15  12      2   HP 5.2  9.9 291 4.619652 5.780348
## 16  15      2   HP 4.6  8.2 291 4.119307 5.080693
## 17  18      2   HP 5.1 13.4 291 4.314478 5.885522
## 18  21      2   HP 5.0 13.4 291 4.214478 5.785522
## 19  24      2   HP 5.2 15.1 291 4.314822 6.085178
## 20  27      2   HP 5.1 11.6 291 4.419996 5.780004
## 21  30      2   HP 5.0  9.2 291 4.460686 5.539314
## 22  33      2   HP 5.2  8.2 291 4.719307 5.680693</code></pre>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb620-1" data-line-number="1">mar.lp</a></code></pre></div>
<pre><code>##    day oedema diet  wt   sd  n      lci      uci
## 34   3      2   LP 5.1 11.1 86 3.903056 6.296944
## 35   6      2   LP 6.0  8.2 86 5.115771 6.884229
## 36   9      2   LP 5.1  8.2 86 4.215771 5.984229
## 37  12      2   LP 6.5 11.9 86 5.216790 7.783210
## 38  15      2   LP 6.4  9.1 86 5.418722 7.381278
## 39  18      2   LP 5.9 13.8 86 4.411908 7.388092
## 40  21      2   LP 6.1 16.5 86 4.320759 7.879241
## 41  24      2   LP 4.0  9.1 86 3.018722 4.981278
## 42  27      2   LP 3.1 12.8 86 1.719741 4.480259
## 43  30      2   LP 4.0  7.3 86 3.212821 4.787179
## 44  33      2   LP 5.0  9.1 86 4.018722 5.981278</code></pre>
<p> </p>
<p>We can now plot the data for one arm of the trial:</p>
<p> </p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" data-line-number="1"><span class="kw">plot</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-424-1.png" style="display: block; margin: auto;" /></p>

<p>We can add error bars using the <code>arrows()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" data-line-number="1"><span class="kw">arrows</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>uci, </a>
<a class="sourceLine" id="cb623-2" data-line-number="2">       <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-426-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The scale of the y axis is wrong because the <code>plot()</code> function automatically scales axes to the ranges of the x and y data it is given. We can fix this by specifying a different set of limits (from <code>lci</code> and <code>uci</code>) for the y axis using the <code>ylim</code> parameter:</p>
<p> </p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb624-1" data-line-number="1"><span class="kw">plot</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, </a>
<a class="sourceLine" id="cb624-2" data-line-number="2">     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(oed.hp<span class="op">$</span>lci), <span class="kw">max</span>(oed.hp<span class="op">$</span>uci)))</a>
<a class="sourceLine" id="cb624-3" data-line-number="3"><span class="kw">arrows</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>uci, </a>
<a class="sourceLine" id="cb624-4" data-line-number="4">       <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-428-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The plot might also be improved by adding plotting symbols:</p>
<p> </p>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" data-line-number="1"><span class="kw">points</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-430-1.png" style="display: block; margin: auto;" /></p>

<p>The axis titles (<code>oed.hp$day</code> and <code>oed.hp$wt</code>) are the column (variable) names.</p>
<p>We can specify titles and axes labels in the call to the <code>plot()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb626-1" data-line-number="1"><span class="kw">plot</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</a>
<a class="sourceLine" id="cb626-2" data-line-number="2">     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(oed.hp<span class="op">$</span>lci), <span class="kw">max</span>(oed.hp<span class="op">$</span>uci)),</a>
<a class="sourceLine" id="cb626-3" data-line-number="3">     <span class="dt">main =</span> <span class="st">&quot;HP Diet. Oedematous Cases&quot;</span>,</a>
<a class="sourceLine" id="cb626-4" data-line-number="4">     <span class="dt">xlab =</span> <span class="st">&quot;Days of treatment&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Weight gain (g/kg/d)&quot;</span>)</a>
<a class="sourceLine" id="cb626-5" data-line-number="5"></a>
<a class="sourceLine" id="cb626-6" data-line-number="6"><span class="kw">arrows</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>uci,</a>
<a class="sourceLine" id="cb626-7" data-line-number="7">       <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb626-8" data-line-number="8"></a>
<a class="sourceLine" id="cb626-9" data-line-number="9"><span class="kw">points</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, <span class="dt">pch =</span> <span class="dv">21</span>, <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-432-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Now that we know how to plot error bars, we can write a function that we will be able to use whenever we need to plot data with error bars.</p>
<p>Before continuing we will consider what the new function should be able to do. This will help us when it comes to writing the function. Our new function should:</p>
<ol style="list-style-type: decimal">
<li><p>Take four numeric vectors (x, y, lower CI for y, and upper CI for y) and plot them.</p></li>
<li><p>Be able to plot the data points as unconnected points or as points joined by lines.</p></li>
<li><p>Calculate appropriate limits for the y-axis.</p></li>
<li><p>Produce a plot without axes so that more than one data series may be plotted on the same chart. 5. Provide sensible default values for axis limits and labels.</p></li>
</ol>
<p>From this list we know that we need the function to take several parameters:</p>
<p> </p>
<table style="width:94%;">
<colgroup>
<col width="16%" />
<col width="34%" />
<col width="43%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Name</strong></th>
<th><strong>Purpose</strong></th>
<th><strong>Default value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>x</code></td>
<td>Data to plot</td>
<td>None</td>
</tr>
<tr class="even">
<td><code>y</code></td>
<td>Data to plot</td>
<td>None</td>
</tr>
<tr class="odd">
<td><code>y.lci</code></td>
<td>Data to plot</td>
<td>None</td>
</tr>
<tr class="even">
<td><code>y.uci</code></td>
<td>Data to plot</td>
<td>None</td>
</tr>
<tr class="odd">
<td><code>ylim</code></td>
<td>Limits for y axis</td>
<td><code>c(min(y.lci), max(y.uci))</code></td>
</tr>
<tr class="even">
<td><code>xlab</code></td>
<td>Label for x axis</td>
<td><code>deparse(substitute(x))</code></td>
</tr>
<tr class="odd">
<td><code>ylab</code></td>
<td>Label for y axis</td>
<td><code>deparse(substitute(y))</code></td>
</tr>
<tr class="even">
<td><code>main</code></td>
<td>Chart title</td>
<td><code>paste(ylab, &quot;by&quot;, xlab)</code></td>
</tr>
<tr class="odd">
<td><code>type</code></td>
<td>Type of plot</td>
<td><code>&quot;l&quot;</code></td>
</tr>
<tr class="even">
<td><code>lty</code></td>
<td>Line type</td>
<td><code>1</code></td>
</tr>
<tr class="odd">
<td><code>col</code></td>
<td>Line and point colour</td>
<td><code>&quot;black&quot;</code></td>
</tr>
<tr class="even">
<td><code>axes</code></td>
<td>Draw x and y axes</td>
<td><code>TRUE</code></td>
</tr>
<tr class="odd">
<td><code>pch</code></td>
<td>Type of points to plot</td>
<td><code>1</code></td>
</tr>
<tr class="even">
<td><code>bg</code></td>
<td>Fill colour of point</td>
<td><code>white</code></td>
</tr>
</tbody>
</table>
<p> </p>
<p>The parameter names have been chosen to be the same as the parameter names to <code>plot()</code> and <code>points()</code>. This makes the function easier to use. It also makes the function easier to write.</p>
<p>Create a new function called <code>plot.ci()</code>:</p>
<p> </p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb627-1" data-line-number="1">plot.ci &lt;-<span class="st"> </span><span class="cf">function</span>() {}</a></code></pre></div>
<p> </p>
<p>This creates an empty function called <code>plot.ci()</code>.</p>
<p>Use the <code>fix()</code> function to edit the <code>plot.ci()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb628-1" data-line-number="1"><span class="kw">fix</span>(plot.ci)</a></code></pre></div>

<p>Edit the function to read:</p>
<p> </p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" data-line-number="1"><span class="cf">function</span>(x,</a>
<a class="sourceLine" id="cb629-2" data-line-number="2">         y, y.lci, y.uci,</a>
<a class="sourceLine" id="cb629-3" data-line-number="3">         <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(y.lci), <span class="kw">max</span>(y.uci)),</a>
<a class="sourceLine" id="cb629-4" data-line-number="4">         <span class="dt">xlab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(x)),</a>
<a class="sourceLine" id="cb629-5" data-line-number="5">         <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y)),</a>
<a class="sourceLine" id="cb629-6" data-line-number="6">         <span class="dt">main =</span> <span class="kw">paste</span>(ylab, <span class="st">&quot;by&quot;</span>, xlab),</a>
<a class="sourceLine" id="cb629-7" data-line-number="7">         <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>,</a>
<a class="sourceLine" id="cb629-8" data-line-number="8">         <span class="dt">lty =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb629-9" data-line-number="9">         <span class="dt">col =</span> <span class="st">&quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb629-10" data-line-number="10">         <span class="dt">axes =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb629-11" data-line-number="11">         <span class="dt">pch =</span> <span class="dv">21</span>,</a>
<a class="sourceLine" id="cb629-12" data-line-number="12">         <span class="dt">bg =</span> <span class="st">&quot;white&quot;</span>) {</a>
<a class="sourceLine" id="cb629-13" data-line-number="13"></a>
<a class="sourceLine" id="cb629-14" data-line-number="14">  <span class="kw">plot</span>(x, y, <span class="dt">type =</span> type, <span class="dt">ylim =</span> ylim, <span class="dt">xlab =</span> xlab, <span class="dt">ylab =</span> ylab,</a>
<a class="sourceLine" id="cb629-15" data-line-number="15">       <span class="dt">main =</span> main, <span class="dt">lty =</span> lty, <span class="dt">col =</span> col, <span class="dt">axes =</span> axes)</a>
<a class="sourceLine" id="cb629-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb629-17" data-line-number="17">  <span class="kw">arrows</span>(x, y.lci, x, y.uci, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb629-18" data-line-number="18">         <span class="dt">lty =</span> lty, <span class="dt">col =</span> col)</a>
<a class="sourceLine" id="cb629-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb629-20" data-line-number="20">  <span class="kw">points</span>(x, y, <span class="dt">pch =</span> pch, <span class="dt">bg =</span> bg, <span class="dt">col =</span> col)</a>
<a class="sourceLine" id="cb629-21" data-line-number="21">}</a></code></pre></div>
<p> </p>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>

<p>Let’s try the <code>plot.ci()</code> function with the test data:</p>
<p> </p>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb630-1" data-line-number="1"><span class="kw">plot.ci</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>uci)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-437-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Note how the function has used default values for the axis labels, chart titles, chart limits etc.</p>
<p>We can override these default values if we need to:</p>
<p> </p>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" data-line-number="1"><span class="kw">plot.ci</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>uci,</a>
<a class="sourceLine" id="cb631-2" data-line-number="2">        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">6</span>, <span class="dv">10</span>), <span class="dt">xlab =</span> <span class="st">&quot;Day&quot;</span>,</a>
<a class="sourceLine" id="cb631-3" data-line-number="3">        <span class="dt">ylab =</span> <span class="st">&quot;Weight gain (g/kg/day)&quot;</span>,</a>
<a class="sourceLine" id="cb631-4" data-line-number="4">        <span class="dt">main =</span> <span class="st">&quot;Oedematous&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-439-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Do not close the plot window.</p>
<p>We should also check that we can plot another data series on this chart:</p>
<p> </p>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb632-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb632-2" data-line-number="2"><span class="kw">plot.ci</span>(oed.lp<span class="op">$</span>day, oed.lp<span class="op">$</span>wt, oed.lp<span class="op">$</span>lci, oed.lp<span class="op">$</span>uci,</a>
<a class="sourceLine" id="cb632-3" data-line-number="3">        <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">pch =</span> <span class="dv">22</span>, <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb632-4" data-line-number="4">        <span class="dt">col =</span> <span class="st">&quot;darkgreen&quot;</span>)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-441-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>We can also add a legend:</p>
<p> </p>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb633-1" data-line-number="1"><span class="kw">legend</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;HP&quot;</span>, <span class="st">&quot;LP&quot;</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb633-2" data-line-number="2">       <span class="dt">pch =</span> <span class="kw">c</span>(<span class="dv">21</span>, <span class="dv">22</span>), <span class="dt">col =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-443-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>We should also check that we can produce plots of unconnected points:</p>
<p> </p>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" data-line-number="1"><span class="kw">plot.ci</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>wt, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>uci, <span class="dt">type =</span> <span class="st">&quot;p&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-444-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Try plotting the data for the marasmic patients using the <code>plot.ci()</code> function.</p>
<p>You might like to use the <code>save()</code> function to save the <code>plot.ci()</code> function.</p>
<p>We can use a similar technique to add error bars to different types of plot. If we plot the weight velocities for oedematous patients receiving the high protein diet as a bar chart:</p>

<div class="sourceCode" id="cb635"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb635-1" data-line-number="1"><span class="kw">barplot</span>(oed.hp<span class="op">$</span>wt, <span class="dt">names.arg =</span> oed.hp<span class="op">$</span>day, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>, </a>
<a class="sourceLine" id="cb635-2" data-line-number="2">        <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(oed.hp<span class="op">$</span>lci), <span class="kw">max</span>(oed.hp<span class="op">$</span>uci)))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-445-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>we could add error bars using the <code>arrows()</code> function as we did with a line plot:</p>
<p> </p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb636-1" data-line-number="1"><span class="kw">arrows</span>(oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>uci, </a>
<a class="sourceLine" id="cb636-2" data-line-number="2">       <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-447-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>but this does not produce the expected results because the centres of the bars are not placed on the chart at the positions held in <code>oed.hp$day</code>. This is easily fixed as <code>barplot()</code> returns a numeric vector (or matrix, when <code>beside = TRUE</code>) containing the co-ordinates of the bar midpoints:</p>

<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb637-1" data-line-number="1">bar.positions &lt;-<span class="st"> </span><span class="kw">barplot</span>(oed.hp<span class="op">$</span>wt, <span class="dt">names.arg =</span> oed.hp<span class="op">$</span>day,</a>
<a class="sourceLine" id="cb637-2" data-line-number="2">                         <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(oed.hp<span class="op">$</span>lci), <span class="kw">max</span>(oed.hp<span class="op">$</span>uci)),</a>
<a class="sourceLine" id="cb637-3" data-line-number="3">                         <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-448-1.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb638-1" data-line-number="1">bar.positions</a></code></pre></div>
<pre><code>##       [,1]
##  [1,]  0.7
##  [2,]  1.9
##  [3,]  3.1
##  [4,]  4.3
##  [5,]  5.5
##  [6,]  6.7
##  [7,]  7.9
##  [8,]  9.1
##  [9,] 10.3
## [10,] 11.5
## [11,] 12.7</code></pre>
<p> </p>
<p>We can now use the information stored in <code>bar.positions</code> to specify the positions of the error bars:</p>
<p> </p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb640-1" data-line-number="1"><span class="kw">arrows</span>(bar.positions, oed.hp<span class="op">$</span>lci, bar.positions, oed.hp<span class="op">$</span>uci,</a>
<a class="sourceLine" id="cb640-2" data-line-number="2">       <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-450-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Armed with this information, we can write a function that we will be able to use whenever we need to plot a bar chart with error bars.</p>
<p>Create a new function called <code>barplot.ci()</code>:</p>
<p> </p>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb641-1" data-line-number="1">barplot.ci &lt;-<span class="st"> </span><span class="cf">function</span>() {}</a></code></pre></div>
<p> </p>
<p>This creates an empty function called <code>barplot.ci()</code>.</p>
<p>Use the <code>fix()</code> function to edit the <code>barplot.ci()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb642-1" data-line-number="1"><span class="kw">fix</span>(barplot.ci)</a></code></pre></div>

<p>Edit the function to read:</p>
<p> </p>
<div class="sourceCode" id="cb643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb643-1" data-line-number="1"><span class="cf">function</span>(y, bar.names, lci, uci,</a>
<a class="sourceLine" id="cb643-2" data-line-number="2">         <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(lci), <span class="kw">max</span>(uci)),</a>
<a class="sourceLine" id="cb643-3" data-line-number="3">         <span class="dt">xlab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(bar.names)),</a>
<a class="sourceLine" id="cb643-4" data-line-number="4">         <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y)),</a>
<a class="sourceLine" id="cb643-5" data-line-number="5">         <span class="dt">main =</span> <span class="kw">paste</span>(ylab, <span class="st">&quot;by&quot;</span>, xlab)) {</a>
<a class="sourceLine" id="cb643-6" data-line-number="6">     </a>
<a class="sourceLine" id="cb643-7" data-line-number="7">  bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(y, <span class="dt">names.arg =</span> bar.names, <span class="dt">ylim =</span> ylim, <span class="dt">xlab =</span> xlab,</a>
<a class="sourceLine" id="cb643-8" data-line-number="8">                <span class="dt">ylab =</span> ylab, <span class="dt">main =</span> main, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</a>
<a class="sourceLine" id="cb643-9" data-line-number="9">     </a>
<a class="sourceLine" id="cb643-10" data-line-number="10">  <span class="kw">arrows</span>(bp, lci, bp, uci, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb643-11" data-line-number="11">}</a></code></pre></div>
<p> </p>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>
<p>Let’s try the <code>barplot.ci()</code> function with the test data:</p>
<p> </p>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb644-1" data-line-number="1"><span class="kw">barplot.ci</span>(oed.hp<span class="op">$</span>wt, oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>uci)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-455-1.png" style="display: block; margin: auto;" /></p>

<p>Try plotting the weight velocities for the marasmic patients receiving the high protein diet using the <code>barplot.ci()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb645-1" data-line-number="1"><span class="kw">barplot.ci</span>(mar.hp<span class="op">$</span>wt, mar.hp<span class="op">$</span>day, mar.hp<span class="op">$</span>lci, mar.hp<span class="op">$</span>uci)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-456-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The chart looks wrong. This is because we have set the wrong limits for the y axis. The bars are drawn from zero to the data point but we have specified a limit for the y axis that is not constrained to include zero. This is easy to fix. Edit the <code>barplot.ci()</code> function to read:</p>
<p> </p>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb646-1" data-line-number="1"><span class="cf">function</span>(y, bar.names, lci, uci,</a>
<a class="sourceLine" id="cb646-2" data-line-number="2">         <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(<span class="dv">0</span>, lci), <span class="kw">max</span>(<span class="dv">0</span>, uci)),</a>
<a class="sourceLine" id="cb646-3" data-line-number="3">         <span class="dt">xlab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(bar.names)),</a>
<a class="sourceLine" id="cb646-4" data-line-number="4">         <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y)),</a>
<a class="sourceLine" id="cb646-5" data-line-number="5">         <span class="dt">main =</span> <span class="kw">paste</span>(ylab, <span class="st">&quot;by&quot;</span>, xlab)) {</a>
<a class="sourceLine" id="cb646-6" data-line-number="6"></a>
<a class="sourceLine" id="cb646-7" data-line-number="7">  bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(y, <span class="dt">names.arg =</span> bar.names,  <span class="dt">ylim =</span> ylim, <span class="dt">xlab =</span> xlab,</a>
<a class="sourceLine" id="cb646-8" data-line-number="8">                <span class="dt">ylab =</span> ylab, <span class="dt">main =</span> main, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</a>
<a class="sourceLine" id="cb646-9" data-line-number="9">     </a>
<a class="sourceLine" id="cb646-10" data-line-number="10">  <span class="kw">arrows</span>(bp, lci, bp, uci, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb646-11" data-line-number="11">}</a></code></pre></div>

<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>
<p>Try plotting the data for the marasmic patients using the <code>barplot.ci()</code> function:</p>
<p> </p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb647-1" data-line-number="1"><span class="kw">barplot.ci</span>(mar.hp<span class="op">$</span>wt, mar.hp<span class="op">$</span>day, mar.hp<span class="op">$</span>lci, mar.hp<span class="op">$</span>uci)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-459-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Check that the function still operates as expected with the data for oedematous patients:</p>
<p> </p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb648-1" data-line-number="1"><span class="kw">barplot.ci</span>(oed.hp<span class="op">$</span>wt, oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>uci)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-460-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The end of one of the error bars touches the x axis. This can also be fixed by slightly widening the limits for the y axis. It might also be useful to plot the centre position of each error bar. We can use the <code>points()</code> function to do this. Edit the <code>barplot.ci()</code> function to read:</p>
<p> </p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb649-1" data-line-number="1"><span class="cf">function</span>(y, bar.names, lci, uci,</a>
<a class="sourceLine" id="cb649-2" data-line-number="2">         <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(<span class="dv">0</span>, lci), <span class="kw">max</span>(<span class="dv">0</span>, uci)),</a>
<a class="sourceLine" id="cb649-3" data-line-number="3">         <span class="dt">xlab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(bar.names)),</a>
<a class="sourceLine" id="cb649-4" data-line-number="4">         <span class="dt">ylab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y)),</a>
<a class="sourceLine" id="cb649-5" data-line-number="5">         <span class="dt">main =</span> <span class="kw">paste</span>(ylab, <span class="st">&quot;by&quot;</span>, xlab)) {</a>
<a class="sourceLine" id="cb649-6" data-line-number="6">     </a>
<a class="sourceLine" id="cb649-7" data-line-number="7">  ylim &lt;-<span class="st"> </span>ylim <span class="op">*</span><span class="st"> </span><span class="fl">1.1</span></a>
<a class="sourceLine" id="cb649-8" data-line-number="8">     </a>
<a class="sourceLine" id="cb649-9" data-line-number="9">  bp &lt;-<span class="st"> </span><span class="kw">barplot</span>(y, <span class="dt">names.arg =</span> bar.names, <span class="dt">ylim =</span> ylim, <span class="dt">xlab =</span> xlab,</a>
<a class="sourceLine" id="cb649-10" data-line-number="10">                <span class="dt">ylab =</span> ylab, <span class="dt">main =</span> main, <span class="dt">col =</span> <span class="st">&quot;white&quot;</span>)</a>
<a class="sourceLine" id="cb649-11" data-line-number="11">     </a>
<a class="sourceLine" id="cb649-12" data-line-number="12">  <span class="kw">arrows</span>(bp, lci, bp, uci, <span class="dt">code =</span> <span class="dv">3</span>, <span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">length =</span> <span class="fl">0.1</span>)</a>
<a class="sourceLine" id="cb649-13" data-line-number="13">     </a>
<a class="sourceLine" id="cb649-14" data-line-number="14">  <span class="kw">points</span>(bp, y)</a>
<a class="sourceLine" id="cb649-15" data-line-number="15">}</a></code></pre></div>

<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>
<p>Check that the function works as expected:</p>
<p> </p>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb650-1" data-line-number="1"><span class="kw">barplot.ci</span>(oed.hp<span class="op">$</span>wt, oed.hp<span class="op">$</span>day, oed.hp<span class="op">$</span>lci, oed.hp<span class="op">$</span>uci)</a>
<a class="sourceLine" id="cb650-2" data-line-number="2"><span class="kw">barplot.ci</span>(mar.hp<span class="op">$</span>wt, mar.hp<span class="op">$</span>day, mar.hp<span class="op">$</span>lci, mar.hp<span class="op">$</span>uci)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-464-1.png" style="display: block; margin: auto;" /></p>
<p><img src="prfe_files/figure-html/unnamed-chunk-465-1.png" style="display: block; margin: auto;" /></p>

<p>The <code>barplot.ci()</code> function now works as expected with both sets of data. It is important when developing your own functions, to test them with different data so as to ensure that they work correctly with a wide range if data.</p>
<p>You might like to use the <code>save()</code> function to save the <code>barplot.ci()</code> function.</p>
</div>
<div id="mesh-map" class="section level2">
<h2><span class="header-section-number">8.4</span> Mesh map</h2>
<p>The fact that <code>R</code> provides flexible graphical functions means that, with little extra work, you can use these functions to present your data in appropriate and interesting ways rather than having to rely on a limited set of basic chart types.</p>
<p>In this exercise we will use the <code>plot()</code> function to produce a simple <em>mesh-map</em>.</p>
<p>The file <code>cover.dat</code> contains data from a coverage survey for a therapeutic feeding program (TFP) in central Malawi undertaken in March 2003. Data were collected using the <em>centric systematic area sampling</em> method to define sampling locations: A number of communities located closest to the centres of thirty 10 x 10 kilometre grid squares were sampled using active (investigative) case-finding.</p>
<p>The columns in this dataset are as follows:</p>
<p> </p>
<table>
<colgroup>
<col width="10%" />
<col width="89%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>x</strong></td>
<td>x position of grid square</td>
</tr>
<tr class="even">
<td><strong>y</strong></td>
<td>y position of grid square</td>
</tr>
<tr class="odd">
<td><strong>cases</strong></td>
<td>Number of cases found in sampled communities in.program Number of cases (from above) enrolled in the TFP</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Retrieve the dataset:</p>
<p> </p>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb651-1" data-line-number="1">cs &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;cover.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a></code></pre></div>

<p>Examine the dataset:</p>
<p> </p>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb652-1" data-line-number="1">cs</a></code></pre></div>
<pre><code>##    x  y cases in.program
## 1  1  7     7          2
## 2  2  5     4          0
## 3  2  6     4          1
## 4  2  7     3          1
## 5  2  8     3          1
## 6  2  9     5          1
## 7  3  3     3          0
## 8  3  4     2          0
## 9  3  5     3          0
## 10 3  6     3          1
## 11 3  7     5          2
## 12 3  8     2          0
## 13 3  9     4          1
## 14 3 10     5          0
## 15 4  4     5          2
## 16 4  5     8          1
## 17 4  6     6          0
## 18 4  7     6          1
## 19 4  8     3          1
## 20 4  9     5          1
## 21 4 10     6          2
## 22 5  4     5          1
## 23 5  5     3          1
## 24 5  6     4          0
## 25 5  7     6          3
## 26 5  8     4          0
## 27 6  3     8          2
## 28 6  4     5          2
## 29 6  6     6          1
## 30 6  7     3          1</code></pre>

<p>We should calculate the observed coverage for each grid square:</p>
<p> </p>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb654-1" data-line-number="1">cs<span class="op">$</span>cvr &lt;-<span class="st"> </span>cs<span class="op">$</span>in.program <span class="op">/</span><span class="st"> </span>cs<span class="op">$</span>cases</a>
<a class="sourceLine" id="cb654-2" data-line-number="2">cs</a></code></pre></div>
<pre><code>##    x  y cases in.program       cvr
## 1  1  7     7          2 0.2857143
## 2  2  5     4          0 0.0000000
## 3  2  6     4          1 0.2500000
## 4  2  7     3          1 0.3333333
## 5  2  8     3          1 0.3333333
## 6  2  9     5          1 0.2000000
## 7  3  3     3          0 0.0000000
## 8  3  4     2          0 0.0000000
## 9  3  5     3          0 0.0000000
## 10 3  6     3          1 0.3333333
## 11 3  7     5          2 0.4000000
## 12 3  8     2          0 0.0000000
## 13 3  9     4          1 0.2500000
## 14 3 10     5          0 0.0000000
## 15 4  4     5          2 0.4000000
## 16 4  5     8          1 0.1250000
## 17 4  6     6          0 0.0000000
## 18 4  7     6          1 0.1666667
## 19 4  8     3          1 0.3333333
## 20 4  9     5          1 0.2000000
## 21 4 10     6          2 0.3333333
## 22 5  4     5          1 0.2000000
## 23 5  5     3          1 0.3333333
## 24 5  6     4          0 0.0000000
## 25 5  7     6          3 0.5000000
## 26 5  8     4          0 0.0000000
## 27 6  3     8          2 0.2500000
## 28 6  4     5          2 0.4000000
## 29 6  6     6          1 0.1666667
## 30 6  7     3          1 0.3333333</code></pre>

<p>Note that some grid squares have zero coverage. It might be useful to use specific plotting characters (e.g. open and filled squares) to indicate zero and non-zero coverage. We can use the <code>ifelse()</code> function to do this:</p>
<p> </p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" data-line-number="1">cs<span class="op">$</span>cvr.pch &lt;-<span class="st"> </span><span class="kw">ifelse</span>(cs<span class="op">$</span>cvr <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb656-2" data-line-number="2">cs</a></code></pre></div>
<pre><code>##    x  y cases in.program       cvr cvr.pch
## 1  1  7     7          2 0.2857143      15
## 2  2  5     4          0 0.0000000       0
## 3  2  6     4          1 0.2500000      15
## 4  2  7     3          1 0.3333333      15
## 5  2  8     3          1 0.3333333      15
## 6  2  9     5          1 0.2000000      15
## 7  3  3     3          0 0.0000000       0
## 8  3  4     2          0 0.0000000       0
## 9  3  5     3          0 0.0000000       0
## 10 3  6     3          1 0.3333333      15
## 11 3  7     5          2 0.4000000      15
## 12 3  8     2          0 0.0000000       0
## 13 3  9     4          1 0.2500000      15
## 14 3 10     5          0 0.0000000       0
## 15 4  4     5          2 0.4000000      15
## 16 4  5     8          1 0.1250000      15
## 17 4  6     6          0 0.0000000       0
## 18 4  7     6          1 0.1666667      15
## 19 4  8     3          1 0.3333333      15
## 20 4  9     5          1 0.2000000      15
## 21 4 10     6          2 0.3333333      15
## 22 5  4     5          1 0.2000000      15
## 23 5  5     3          1 0.3333333      15
## 24 5  6     4          0 0.0000000       0
## 25 5  7     6          3 0.5000000      15
## 26 5  8     4          0 0.0000000       0
## 27 6  3     8          2 0.2500000      15
## 28 6  4     5          2 0.4000000      15
## 29 6  6     6          1 0.1666667      15
## 30 6  7     3          1 0.3333333      15</code></pre>

<p>A quick way of seeing the code associated with each plotting symbol is:</p>
<p> </p>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1"><span class="kw">plot</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">25</span>, <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>, <span class="dt">pch =</span> <span class="dv">0</span><span class="op">:</span><span class="dv">25</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-470-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The size of the plotting symbol may be used to indicate the level of coverage in each quadrat but we must
ensure that the symbol used for zero-coverage is not invisibly small:</p>
<p> </p>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb659-1" data-line-number="1">cs<span class="op">$</span>cvr.cex &lt;-<span class="st"> </span><span class="kw">ifelse</span>(cs<span class="op">$</span>cvr <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span> <span class="op">*</span><span class="st"> </span>cs<span class="op">$</span>cvr)</a>
<a class="sourceLine" id="cb659-2" data-line-number="2">cs</a></code></pre></div>
<pre><code>##    x  y cases in.program       cvr cvr.pch  cvr.cex
## 1  1  7     7          2 0.2857143      15 2.857143
## 2  2  5     4          0 0.0000000       0 1.000000
## 3  2  6     4          1 0.2500000      15 2.500000
## 4  2  7     3          1 0.3333333      15 3.333333
## 5  2  8     3          1 0.3333333      15 3.333333
## 6  2  9     5          1 0.2000000      15 2.000000
## 7  3  3     3          0 0.0000000       0 1.000000
## 8  3  4     2          0 0.0000000       0 1.000000
## 9  3  5     3          0 0.0000000       0 1.000000
## 10 3  6     3          1 0.3333333      15 3.333333
## 11 3  7     5          2 0.4000000      15 4.000000
## 12 3  8     2          0 0.0000000       0 1.000000
## 13 3  9     4          1 0.2500000      15 2.500000
## 14 3 10     5          0 0.0000000       0 1.000000
## 15 4  4     5          2 0.4000000      15 4.000000
## 16 4  5     8          1 0.1250000      15 1.250000
## 17 4  6     6          0 0.0000000       0 1.000000
## 18 4  7     6          1 0.1666667      15 1.666667
## 19 4  8     3          1 0.3333333      15 3.333333
## 20 4  9     5          1 0.2000000      15 2.000000
## 21 4 10     6          2 0.3333333      15 3.333333
## 22 5  4     5          1 0.2000000      15 2.000000
## 23 5  5     3          1 0.3333333      15 3.333333
## 24 5  6     4          0 0.0000000       0 1.000000
## 25 5  7     6          3 0.5000000      15 5.000000
## 26 5  8     4          0 0.0000000       0 1.000000
## 27 6  3     8          2 0.2500000      15 2.500000
## 28 6  4     5          2 0.4000000      15 4.000000
## 29 6  6     6          1 0.1666667      15 1.666667
## 30 6  7     3          1 0.3333333      15 3.333333</code></pre>
<p> </p>
<p>We can now plot the data:</p>
<p> </p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb661-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">pty=</span><span class="st">&quot;s&quot;</span>)</a>
<a class="sourceLine" id="cb661-2" data-line-number="2"><span class="kw">plot</span>(cs<span class="op">$</span>x, cs<span class="op">$</span>y, <span class="dt">cex =</span> cs<span class="op">$</span>cvr.cex, <span class="dt">pch =</span> cs<span class="op">$</span>cvr.pch)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-472-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>There are some problems with this plot:</p>
<ul>
<li><p>The axes and labels distract from the data.</p></li>
<li><p>The distance between grid-square centres is wider in the <em>x</em> than in the <em>y</em> direction.</p></li>
<li><p>The colour (black) of the plotting symbols is too strong.</p></li>
</ul>
<p>All of these problems can be fixed by specifying values for <code>plot()</code> function parameters:</p>
<p> </p>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb662-1" data-line-number="1"><span class="kw">plot</span>(cs<span class="op">$</span>x, cs<span class="op">$</span>y,</a>
<a class="sourceLine" id="cb662-2" data-line-number="2">     <span class="dt">cex =</span> cs<span class="op">$</span>cvr.cex,</a>
<a class="sourceLine" id="cb662-3" data-line-number="3">     <span class="dt">pch =</span> cs<span class="op">$</span>cvr.pch,</a>
<a class="sourceLine" id="cb662-4" data-line-number="4">     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb662-5" data-line-number="5">     <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb662-6" data-line-number="6">     <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb662-7" data-line-number="7">     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb662-8" data-line-number="8">     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb662-9" data-line-number="9">     <span class="dt">col =</span> <span class="kw">gray</span>(<span class="fl">0.5</span>))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-473-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>An alternative way of plotting this data is to use shades of grey (rather than the size of the plotting symbol) to represent the level of coverage in each grid-square:</p>
<p> </p>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" data-line-number="1"><span class="kw">plot</span>(cs<span class="op">$</span>x, cs<span class="op">$</span>y,</a>
<a class="sourceLine" id="cb663-2" data-line-number="2">     <span class="dt">cex =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb663-3" data-line-number="3">     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb663-4" data-line-number="4">     <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb663-5" data-line-number="5">     <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb663-6" data-line-number="6">     <span class="dt">pch =</span> <span class="dv">15</span>,</a>
<a class="sourceLine" id="cb663-7" data-line-number="7">     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb663-8" data-line-number="8">     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb663-9" data-line-number="9">     <span class="dt">col =</span> <span class="kw">gray</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>cs<span class="op">$</span>cvr))</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-474-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>In this context it is useful to show the approximate location of therapeutic feeding centres:</p>
<p> </p>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb664-1" data-line-number="1"><span class="kw">plot</span>(cs<span class="op">$</span>x, cs<span class="op">$</span>y,</a>
<a class="sourceLine" id="cb664-2" data-line-number="2">     <span class="dt">cex =</span> cs<span class="op">$</span>cvr.cex,</a>
<a class="sourceLine" id="cb664-3" data-line-number="3">     <span class="dt">pch =</span> cs<span class="op">$</span>cvr.pch,</a>
<a class="sourceLine" id="cb664-4" data-line-number="4">     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb664-5" data-line-number="5">     <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>,</a>
<a class="sourceLine" id="cb664-6" data-line-number="6">     <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb664-7" data-line-number="7">     <span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb664-8" data-line-number="8">     <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb664-9" data-line-number="9">     <span class="dt">col =</span> <span class="kw">gray</span>(<span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb664-10" data-line-number="10"></a>
<a class="sourceLine" id="cb664-11" data-line-number="11"><span class="kw">points</span>(<span class="kw">c</span>(<span class="fl">2.5</span>, <span class="fl">4.5</span>, <span class="fl">5.5</span>), <span class="kw">c</span>(<span class="fl">6.5</span>, <span class="fl">8.25</span>, <span class="dv">5</span>), <span class="dt">pch =</span> <span class="dv">19</span>, <span class="dt">cex =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-475-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>The techniques introduced in this section allow you to write custom graphical functions but they can also be used to change the default behaviour of standard graphical functions.</p>
</div>
<div id="combining-plots" class="section level2">
<h2><span class="header-section-number">8.5</span> Combining plots</h2>
<p>In <a href="exercise1.html#exercise1"><strong><em>Exercise 1 Getting acquainted with R</em></strong></a>, we saw how the <code>plot()</code> function could be applied to a fitted object:</p>
<p> </p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb665-1" data-line-number="1">fem &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;fem.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb665-2" data-line-number="2"><span class="kw">attach</span>(fem)</a>
<a class="sourceLine" id="cb665-3" data-line-number="3">fem.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(WT <span class="op">~</span><span class="st"> </span>AGE)</a>
<a class="sourceLine" id="cb665-4" data-line-number="4"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb666-1" data-line-number="1">fem &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;fem.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb666-2" data-line-number="2"><span class="kw">attach</span>(fem)</a></code></pre></div>
<pre><code>## The following objects are masked from fem (pos = 4):
## 
##     AGE, ANX, DEP, ID, IQ, LIFE, SEX, SLP, WT</code></pre>
<pre><code>## The following objects are masked from fem (pos = 5):
## 
##     AGE, ANX, DEP, ID, IQ, LIFE, SEX, SLP, WT</code></pre>
<pre><code>## The following objects are masked from fem (pos = 10):
## 
##     AGE, ANX, DEP, ID, IQ, LIFE, SEX, SLP, WT</code></pre>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb670-1" data-line-number="1">fem.lm &lt;-<span class="st"> </span><span class="kw">lm</span>(WT <span class="op">~</span><span class="st"> </span>AGE)</a></code></pre></div>

<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb671-1" data-line-number="1"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-478-1.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-478-2.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-478-3.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-478-4.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Each of the diagnostic plots are presented as a separate chart. We could use the <code>mfrow</code> parameter of the <code>par()</code> function to present all four diagnostic plots on a single chart:</p>
<p> </p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb672-2" data-line-number="2"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-479-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>It might improve the appearance of the chart if each of the diagnostic plots were square rather than rectangular:</p>
<p> </p>
<div class="sourceCode" id="cb673"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb673-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb673-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">pty =</span> <span class="st">&quot;s&quot;</span>)</a>
<a class="sourceLine" id="cb673-3" data-line-number="3"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-481-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>It might improve the appearance of the chart if smaller text and symbols were used:</p>
<p> </p>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb674-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb674-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">pty =</span> <span class="st">&quot;s&quot;</span>)</a>
<a class="sourceLine" id="cb674-3" data-line-number="3"><span class="kw">par</span>(<span class="dt">cex =</span> <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb674-4" data-line-number="4"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-483-1.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Graphical parameters set using the <code>par()</code> function affect all subsequent plot commands and must be reset explicitly:</p>
<p> </p>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">pty =</span> <span class="st">&quot;m&quot;</span>, <span class="dt">cex =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb675-2" data-line-number="2"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-485-1.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-485-2.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-485-3.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-485-4.png" style="display: block; margin: auto;" /></p>

<p>It is possible to save graphical parameters into an <code>R</code> object and use this object to restore original graphical parameters:</p>
<p> </p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb676-1" data-line-number="1">old.par &lt;-<span class="st"> </span><span class="kw">par</span>()</a>
<a class="sourceLine" id="cb676-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">pty =</span> <span class="st">&quot;s&quot;</span>)</a>
<a class="sourceLine" id="cb676-3" data-line-number="3"><span class="kw">plot</span>(fem.lm)</a>
<a class="sourceLine" id="cb676-4" data-line-number="4"><span class="kw">par</span>(old.par)</a>
<a class="sourceLine" id="cb676-5" data-line-number="5"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-487-1.png" style="display: block; margin: auto;" /></p>

<p><img src="prfe_files/figure-html/unnamed-chunk-488-1.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-488-2.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-488-3.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-488-4.png" style="display: block; margin: auto;" /></p>

<p>The ability to save and apply graphical parameters means that you can create a library of graphical parameter sets that can be applied with the <code>par()</code> function as required:</p>
<p> </p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb677-1" data-line-number="1">default.par &lt;-<span class="st"> </span><span class="kw">par</span>()</a>
<a class="sourceLine" id="cb677-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">pty =</span> <span class="st">&quot;s&quot;</span>)</a>
<a class="sourceLine" id="cb677-3" data-line-number="3">plot.lm.par &lt;-<span class="st"> </span><span class="kw">par</span>()</a>
<a class="sourceLine" id="cb677-4" data-line-number="4"><span class="kw">par</span>(default.par)</a>
<a class="sourceLine" id="cb677-5" data-line-number="5"><span class="kw">plot</span>(fem.lm)</a>
<a class="sourceLine" id="cb677-6" data-line-number="6"><span class="kw">par</span>(plot.lm.par)</a>
<a class="sourceLine" id="cb677-7" data-line-number="7"><span class="kw">plot</span>(fem.lm)</a>
<a class="sourceLine" id="cb677-8" data-line-number="8"><span class="kw">par</span>(default.par)</a>
<a class="sourceLine" id="cb677-9" data-line-number="9"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>

<p><img src="prfe_files/figure-html/unnamed-chunk-490-1.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-490-2.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-490-3.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-490-4.png" style="display: block; margin: auto;" /></p>

<p><img src="prfe_files/figure-html/unnamed-chunk-491-1.png" style="display: block; margin: auto;" /></p>

<p><img src="prfe_files/figure-html/unnamed-chunk-492-1.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-492-2.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-492-3.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-492-4.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p><code>R</code> produces warning messages when you save and restore graphical parameters in this way. This is because some graphical parameters are read only and cannot be changed using the <code>par()</code> function. This has no effect other than to cause <code>R</code> to issue warning messages.</p>
<p>If you do not like the warning messages then you can use the <code>par()</code> function with the <code>no.readonly</code> parameter set to <code>TRUE</code>:</p>
<p> </p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb678-1" data-line-number="1">default.par &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">no.readonly =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb678-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="dt">pty =</span> <span class="st">&quot;s&quot;</span>)</a>
<a class="sourceLine" id="cb678-3" data-line-number="3">plot.lm.par &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="dt">no.readonly =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb678-4" data-line-number="4"><span class="kw">par</span>(default.par)</a>
<a class="sourceLine" id="cb678-5" data-line-number="5"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-493-1.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-493-2.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-493-3.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-493-4.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb679-1" data-line-number="1"><span class="kw">par</span>(plot.lm.par)</a>
<a class="sourceLine" id="cb679-2" data-line-number="2"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-493-5.png" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb680"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb680-1" data-line-number="1"><span class="kw">par</span>(default.par)</a>
<a class="sourceLine" id="cb680-2" data-line-number="2"><span class="kw">plot</span>(fem.lm)</a></code></pre></div>
<p><img src="prfe_files/figure-html/unnamed-chunk-493-6.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-493-7.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-493-8.png" style="display: block; margin: auto;" /><img src="prfe_files/figure-html/unnamed-chunk-493-9.png" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Graphical parameter sets, like any other <code>R</code> object, may be saved and loaded using the <code>save()</code> and <code>load()</code> functions.</p>
</div>
<div id="summary-7" class="section level2">
<h2><span class="header-section-number">8.6</span> Summary</h2>
<ul>
<li><p><code>R</code> allows you to create functions that produce graphical output.</p></li>
<li><p><code>R</code> graphical functions are flexible so that you can create functions that can produce chart types that are not available in <code>R</code> or many other statistical applications. Standard plots may also be customised using the <code>par()</code> function.</p></li>
<li><p><code>R</code> allows you to specify default values for function parameters making functions calls easier by removing the requirement to specify values for every function parameter.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise9.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["prfe.pdf", "prfe.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
