<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Practical R for Epidemiologists</title>
  <meta name="description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book.">
  <meta name="generator" content="bookdown 0.7.1 and GitBook 2.6.7">

  <meta property="og:title" content="Practical R for Epidemiologists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://guevarra.io/prfe/" />
  <meta property="og:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />
  <meta property="og:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="github-repo" content="ernestguevarra/practical-r-for-epidemiologists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Practical R for Epidemiologists" />
  
  <meta name="twitter:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="twitter:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />

<meta name="author" content="Mark Myatt">


<meta name="date" content="2018-04-24">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exercise7.html">
<link rel="next" href="exercise9.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
pre, code { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.bn { color: #0000cf; } /* BaseN */
code span.fl { color: #0000cf; } /* Float */
code span.ch { color: #4e9a06; } /* Char */
code span.st { color: #4e9a06; } /* String */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.ot { color: #8f5902; } /* Other */
code span.al { color: #ef2929; } /* Alert */
code span.fu { color: #000000; } /* Function */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #000000; } /* Constant */
code span.sc { color: #000000; } /* SpecialChar */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #000000; } /* Variable */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.ex { } /* Extension */
code span.at { color: #c4a000; } /* Attribute */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical R for Epidemiologists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Practical R for Epidemiologists</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="introducing-r.html"><a href="introducing-r.html"><i class="fa fa-check"></i><b>1</b> Introducing R</a><ul>
<li class="chapter" data-level="1.1" data-path="introducing-r.html"><a href="introducing-r.html#retrieving-data"><i class="fa fa-check"></i><b>1.1</b> Retrieving data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise1.html"><a href="exercise1.html"><i class="fa fa-check"></i><b>2</b> Getting acquainted with R</a><ul>
<li class="chapter" data-level="2.1" data-path="exercise1.html"><a href="exercise1.html#summary"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise2.html"><a href="exercise2.html"><i class="fa fa-check"></i><b>3</b> Manipulating objects and creating new functions</a><ul>
<li class="chapter" data-level="3.1" data-path="exercise2.html"><a href="exercise2.html#summary-1"><i class="fa fa-check"></i><b>3.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise3.html"><a href="exercise3.html"><i class="fa fa-check"></i><b>4</b> Logistic regression and stratified analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exercise3.html"><a href="exercise3.html#matched-data"><i class="fa fa-check"></i><b>4.1</b> Matched data</a></li>
<li class="chapter" data-level="4.2" data-path="exercise3.html"><a href="exercise3.html#summary-2"><i class="fa fa-check"></i><b>4.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise4.html"><a href="exercise4.html"><i class="fa fa-check"></i><b>5</b> Analysing some data with R</a><ul>
<li class="chapter" data-level="5.1" data-path="exercise4.html"><a href="exercise4.html#summary-3"><i class="fa fa-check"></i><b>5.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise5.html"><a href="exercise5.html"><i class="fa fa-check"></i><b>6</b> Extending R with packages</a><ul>
<li class="chapter" data-level="6.1" data-path="exercise5.html"><a href="exercise5.html#summary-4"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exercise6.html"><a href="exercise6.html"><i class="fa fa-check"></i><b>7</b> Making your own objects behave like R objects</a><ul>
<li class="chapter" data-level="7.1" data-path="exercise6.html"><a href="exercise6.html#summary-5"><i class="fa fa-check"></i><b>7.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercise7.html"><a href="exercise7.html"><i class="fa fa-check"></i><b>8</b> Writing your own graphical functions</a><ul>
<li class="chapter" data-level="8.1" data-path="exercise7.html"><a href="exercise7.html#summary-6"><i class="fa fa-check"></i><b>8.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="exercise8.html"><a href="exercise8.html"><i class="fa fa-check"></i><b>9</b> More graphical functions</a></li>
<li class="chapter" data-level="10" data-path="exercise9.html"><a href="exercise9.html"><i class="fa fa-check"></i><b>10</b> Computer intensive methods</a></li>
<li class="chapter" data-level="11" data-path="whatnow.html"><a href="whatnow.html"><i class="fa fa-check"></i><b>11</b> What now?</a></li>
<li class="divider"></li>
<li>&nbsp; &nbsp; @ Mark Myatt 2018</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical R for Epidemiologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise8" class="section level1">
<h1><span class="header-section-number">9</span> More graphical functions</h1>
<p>Graphical functions in <code>R</code> are just like any other function in <code>R</code> in the sense that <code>R</code> provides you with a set of functions which can be altered or added to. In this exercise we will experiment with some of the graphical functions provided by R to demonstrate the flexibility of graphical functions in <code>R</code>. We will then use the graphical functions that we experiment with to create some useful graphical functions of our own.</p>
<p>The first function that we will develop will be a function that is capable of plotting two data series on a single graph. We will take this exercise slowly in order to introduce some further graphical functions.
Before we go any further we should start <code>R</code> and retrieve a dataset:</p>
<pre class="sourceCode r" id="cb556"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" data-line-number="1">mal &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;malaria.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb556-2" data-line-number="2"><span class="kw">attach</span>(mal)</a></code></pre>
<p>The file <code>malaria.dat</code> contains data on rainfall (in mm) and the number of cases of malaria reported from health centres in an administrative district of Ethiopia between July 1997 and July 1999. The columns in this dataset are as follows:</p>
<table style="width:72%;">
<colgroup>
<col width="15%" />
<col width="56%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Time</strong></td>
<td>Month and year (as text)</td>
</tr>
<tr class="even">
<td><strong>Cases</strong></td>
<td>Number of cases of malaria reported</td>
</tr>
<tr class="odd">
<td><strong>Rain</strong></td>
<td>Rainfall in mm</td>
</tr>
</tbody>
</table>
<p>Examine the dataset:</p>
<pre class="sourceCode r" id="cb557"><code class="sourceCode r"><a class="sourceLine" id="cb557-1" data-line-number="1">mal</a></code></pre>
<pre><code>##      Time Cases  Rain
## 1  Jul-97   997  68.5
## 2  Aug-97   824 162.1
## 3  Sep-97   573 138.8
## 4  Oct-97   586 222.2
## 5  Nov-97   523 115.5
## 6  Dec-97   968  37.2
## 7  Jan-98   985  96.6
## 8  Feb-98   745  99.1
## 9  Mar-98   520  51.2
## 10 Apr-98   406  80.0
## 11 May-98   523 112.4
## 12 Jun-98   560 183.7
## 13 Jul-98   671 101.0
## 14 Aug-98   667 252.5
## 15 Sep-98   768  40.8
## 16 Oct-98   990 193.7
## 17 Nov-98   775  17.5
## 18 Dec-98   833   0.0
## 19 Jan-99   672  33.5
## 20 Feb-99   505   0.0
## 21 Mar-99   320 106.8
## 22 Apr-99   274 117.4
## 23 May-99   263 175.8
## 24 Jun-99   264 187.5
## 25 Jul-99   179 283.5</code></pre>
<p>First we will plot the number of cases of malaria seen over time using the <code>plot()</code> function:</p>
<pre class="sourceCode r" id="cb559"><code class="sourceCode r"><a class="sourceLine" id="cb559-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-314-1.png" width="672" /></p>
<p>The problem with this plot is that it does not treat the data as a time series. Adding the <code>Time</code> variable to the plot does not solve the problem:</p>
<pre class="sourceCode r" id="cb560"><code class="sourceCode r"><a class="sourceLine" id="cb560-1" data-line-number="1"><span class="kw">plot</span>(Time, Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-315-1.png" width="672" /></p>
<p>Because <code>Time</code> is a factor variable. If you convert <code>Time</code> to a character variable using <code>as.character()</code> or prevent <code>R</code> from converting <code>Time</code> to a factor using the <code>as.is</code> parameter to the <code>read.table()</code> function the <code>plot()</code> function will return an error because it expects a numeric x-axis variable. We should, instead, specify a time series (<code>ts</code>) class object. Rather than change the original data, we will create a new object using the <code>ts()</code> function:</p>
<pre class="sourceCode r" id="cb561"><code class="sourceCode r"><a class="sourceLine" id="cb561-1" data-line-number="1">cases.ts &lt;-<span class="st"> </span><span class="kw">ts</span>(Cases, <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">1997</span>, <span class="dv">7</span>), <span class="dt">frequency =</span> <span class="dv">12</span>)</a></code></pre>
<p>Examine the cases.ts object:</p>
<pre class="sourceCode r" id="cb562"><code class="sourceCode r"><a class="sourceLine" id="cb562-1" data-line-number="1">cases.ts</a></code></pre>
<pre><code>##      Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec
## 1997                         997 824 573 586 523 968
## 1998 985 745 520 406 523 560 671 667 768 990 775 833
## 1999 672 505 320 274 263 264 179</code></pre>
<p>We can now plot <code>cases.ts</code> as a time series:</p>
<pre class="sourceCode r" id="cb564"><code class="sourceCode r"><a class="sourceLine" id="cb564-1" data-line-number="1"><span class="kw">plot</span>(cases.ts)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-318-1.png" width="672" /></p>
<p>We might want to explore the association between the <code>Rain</code> and <code>Cases</code> variables. A simple scatter plot is not particularly informative:</p>
<pre class="sourceCode r" id="cb565"><code class="sourceCode r"><a class="sourceLine" id="cb565-1" data-line-number="1"><span class="kw">plot</span>(Rain, Cases)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-319-1.png" width="672" /></p>
<p>It is better to treat both variables as time series (which they are) and use the built-in <code>plot()</code> methods for objects of class <code>ts</code>:</p>
<pre class="sourceCode r" id="cb566"><code class="sourceCode r"><a class="sourceLine" id="cb566-1" data-line-number="1">rain.cases.ts &lt;-<span class="st"> </span><span class="kw">ts</span>(<span class="kw">cbind</span>(Rain, Cases), <span class="dt">start =</span> <span class="kw">c</span>(<span class="dv">1997</span>,<span class="dv">7</span>), <span class="dt">frequency =</span> <span class="dv">12</span>)</a>
<a class="sourceLine" id="cb566-2" data-line-number="2"><span class="kw">plot</span>(rain.cases.ts)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-320-1.png" width="672" /></p>
<p>The association between the <code>Rain</code> and <code>Cases</code> variables is now clearer with the number of malaria cases peaking shortly after peaks in rainfall.</p>
<p>The <code>plot()</code> function when used with objects of class <code>ts</code> produces useful output but it is not particularly flexible and the output is, sometimes, not particularly pretty. We can however use basic graphical functions to produce multiple plots. First we will set the <code>mfrow</code> graphical parameter using the <code>par()</code> function:</p>
<pre class="sourceCode r" id="cb567"><code class="sourceCode r"><a class="sourceLine" id="cb567-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</a></code></pre>
<p>The <code>par()</code> function sets a graphical parameter. The <code>mfrow</code> parameter is used to set the number of charts that will appear on a page in rows and columns. We have specified two rows with one chart per row. Test this by plotting two charts:</p>
<pre class="sourceCode r" id="cb568"><code class="sourceCode r"><a class="sourceLine" id="cb568-1" data-line-number="1"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-322-1.png" width="672" /></p>
<pre class="sourceCode r" id="cb569"><code class="sourceCode r"><a class="sourceLine" id="cb569-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-322-2.png" width="672" /></p>
<p>We will want to have tick-marks on the x-axis of each for each record. We can set the number of tick-marks on axes by setting the <code>lab</code> graphical parameter using the <code>par()</code> function:</p>
<pre class="sourceCode r" id="cb570"><code class="sourceCode r"><a class="sourceLine" id="cb570-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(Time), <span class="dv">10</span>, <span class="dv">7</span>))</a></code></pre>
<p>The <code>par()</code> function sets a graphical parameter. The <code>lab</code> parameter is used to set the number tick-marks on the x and y axes and the label size. We have specified a tick-mark on the x-axis for each record (i.e. using <code>length(Time)</code>), ten tick-marks on the y-axis, and a label length of seven. Test this by plotting two charts:</p>
<pre class="sourceCode r" id="cb571"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" data-line-number="1"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-324-1.png" width="672" /></p>
<pre class="sourceCode r" id="cb572"><code class="sourceCode r"><a class="sourceLine" id="cb572-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-324-2.png" width="672" /></p>
<p>The problem with these charts is that the month and year are not displayed on the x-axis. We can get round this by plotting a chart without axes and then specifying the axes and labels directly:</p>
<pre class="sourceCode r" id="cb573"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" data-line-number="1"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;mm&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Rainfall&quot;</span>)</a>
<a class="sourceLine" id="cb573-2" data-line-number="2"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(Time), <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Time))</a>
<a class="sourceLine" id="cb573-3" data-line-number="3"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-325-1.png" width="672" /></p>
<pre class="sourceCode r" id="cb574"><code class="sourceCode r"><a class="sourceLine" id="cb574-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>, <span class="dt">xlab =</span> <span class="st">&quot;Time&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;n&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Cases&quot;</span>)</a>
<a class="sourceLine" id="cb574-2" data-line-number="2"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(Time), <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Time))</a>
<a class="sourceLine" id="cb574-3" data-line-number="3"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-325-2.png" width="672" /></p>
<p>The resulting charts now look much better (you may need to resize the plot to display the x-axis labels correctly) but it would be nice to be able draw the two lines on a single chart.</p>
<p>Before proceeding we will use the <code>par()</code> function to specify one plot per window (using the <code>mfrow</code> parameter) and set the default number of tick-marks on the axes (using the <code>lab</code> parameter):</p>
<pre class="sourceCode r" id="cb575"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb575-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">7</span>))</a></code></pre>
<p>And then use the <code>plot()</code> and <code>lines()</code> function to draw the two lines on the same graph:</p>
<pre class="sourceCode r" id="cb576"><code class="sourceCode r"><a class="sourceLine" id="cb576-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a>
<a class="sourceLine" id="cb576-2" data-line-number="2"><span class="kw">lines</span>(Rain, <span class="dt">lty =</span> <span class="dv">2</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-327-1.png" width="672" /></p>
<p>The problem with this is that the ranges of the two variables are different and the <code>plot()</code> function automatically sets the y-axis to the range of the specified variable. To fix this problem we need to set the limits of the y-axis to the minimum and maximum value of both of variables using the <code>ylim</code> parameter of the <code>plot()</code> function:</p>
<pre class="sourceCode r" id="cb577"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" data-line-number="1"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="kw">min</span>(Cases, Rain), <span class="kw">max</span>(Cases, Rain)))</a>
<a class="sourceLine" id="cb577-2" data-line-number="2"><span class="kw">lines</span>(Rain, <span class="dt">lty =</span> <span class="dv">2</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-328-1.png" width="672" /></p>
<p>We can improve the chart by adding a legend:</p>
<pre class="sourceCode r" id="cb578"><code class="sourceCode r"><a class="sourceLine" id="cb578-1" data-line-number="1"><span class="kw">legend</span>(<span class="dv">18</span>, <span class="dv">1000</span>, <span class="dt">legend =</span> <span class="kw">c</span>(<span class="st">&quot;Cases&quot;</span>, <span class="st">&quot;Rainfall (mm)&quot;</span>), <span class="dt">lty =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-330-1.png" width="672" /></p>
<p>We could continue to improve the chart (e.g. by adding labels for the x-axis tick-marks taken from the <code>Time</code> variable, specifying more meaningful axis labels, and specifying a title) but the chart would be more useful if each variable made full use of the plotting area. We can do this by plotting one chart on top of another by using the <code>new</code> graphical parameter:</p>
<pre class="sourceCode r" id="cb579"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(Time), <span class="dv">5</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb579-2" data-line-number="2"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb579-3" data-line-number="3"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb579-4" data-line-number="4"><span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb579-5" data-line-number="5"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb579-6" data-line-number="6"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb579-7" data-line-number="7"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>)</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-331-1.png" width="672" /></p>
<p>This chart is much clearer but there are still some improvements that could be made:</p>
<ul>
<li><p>The chart should have a title. We can do this using the <code>main</code> parameter of either of the <code>plot()</code> functions.</p></li>
<li><p>The y-axis labels are displayed on top of each other beside the left-hand y-axis. We can solve this problem by preventing the second <code>plot()</code> function from displaying a y-axis label (i.e. by specifying an empty character string for the <code>ylab</code> parameter).</p></li>
<li><p>We will need to make room on the right-hand side of the chart for an axis label (i.e. by setting the <code>mar</code> (margin) graphical parameter) and place the label there ourselves (using the <code>mtext()</code> function).</p></li>
<li><p>The x-axis should display the month and year which are held as character strings in the <code>Time</code> variable. We can do this using the labels parameter of the <code>axis()</code> function after setting the appropriate number of tick-marks using the <code>lab</code> graphical parameter.</p></li>
</ul>
<p>The x-axis should be properly labelled. We can do this using the <code>xlab</code> parameters of the <code>plot()</code> functions. An empty string must be specified for one of the <code>plot()</code> functions in order to prevent the default label from being displayed.</p>
<p>Try this now:</p>
<pre class="sourceCode r" id="cb580"><code class="sourceCode r"><a class="sourceLine" id="cb580-1" data-line-number="1"><span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb580-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(Time), <span class="dv">5</span>, <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb580-3" data-line-number="3"><span class="kw">plot</span>(Cases, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb580-4" data-line-number="4">     <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Malaria cases and rainfall&quot;</span>)</a>
<a class="sourceLine" id="cb580-5" data-line-number="5"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb580-6" data-line-number="6"><span class="kw">mtext</span>(<span class="dt">text =</span> <span class="st">&quot;Malaria cases&quot;</span>, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb580-7" data-line-number="7"><span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb580-8" data-line-number="8"><span class="kw">plot</span>(Rain, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb580-9" data-line-number="9">     <span class="dt">xlab =</span> <span class="st">&quot;Month &amp; Year&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb580-10" data-line-number="10"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb580-11" data-line-number="11"><span class="kw">mtext</span>(<span class="dt">text =</span> <span class="st">&quot;Rainfall (mm)&quot;</span>, <span class="dt">side =</span> <span class="dv">4</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb580-12" data-line-number="12"><span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(Time), <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(Time))</a></code></pre>
<p><img src="prfe_files/figure-html/unnamed-chunk-332-1.png" width="672" /></p>
<p>Now that we know how to create a two-axis chart, we can write a function that we will be able to use whenever we need to plot two variables on the same chart. Create a new function called <code>plot2var()</code>:</p>
<pre class="sourceCode r" id="cb581"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" data-line-number="1">plot2var &lt;-<span class="st"> </span><span class="cf">function</span>() {}</a></code></pre>
<p>This creates an empty function called <code>plot2var()</code>.</p>
<p>Use the <code>fix()</code> function to edit the <code>plot2var()</code> function:</p>
<pre class="sourceCode r" id="cb582"><code class="sourceCode r"><a class="sourceLine" id="cb582-1" data-line-number="1"><span class="kw">fix</span>(plot2var)</a></code></pre>
<p>Edit the function to read:</p>
<pre class="sourceCode r" id="cb583"><code class="sourceCode r"><a class="sourceLine" id="cb583-1" data-line-number="1"><span class="cf">function</span>(y1,</a>
<a class="sourceLine" id="cb583-2" data-line-number="2">         y2,</a>
<a class="sourceLine" id="cb583-3" data-line-number="3">         x.ticks,</a>
<a class="sourceLine" id="cb583-4" data-line-number="4">         <span class="dt">x.lab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(x.ticks)),</a>
<a class="sourceLine" id="cb583-5" data-line-number="5">         <span class="dt">y1.lab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y1)),</a>
<a class="sourceLine" id="cb583-6" data-line-number="6">         <span class="dt">y2.lab =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(y2)),</a>
<a class="sourceLine" id="cb583-7" data-line-number="7">         <span class="dt">main =</span> <span class="kw">paste</span>(y1.lab, <span class="st">&quot;&amp;&quot;</span>, y2.lab)) {</a>
<a class="sourceLine" id="cb583-8" data-line-number="8">  old.par.mar &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;mar&quot;</span>)</a>
<a class="sourceLine" id="cb583-9" data-line-number="9">  old.par.lab &lt;-<span class="st"> </span><span class="kw">par</span>(<span class="st">&quot;lab&quot;</span>)</a>
<a class="sourceLine" id="cb583-10" data-line-number="10">  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>))</a>
<a class="sourceLine" id="cb583-11" data-line-number="11">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">missing</span>(x.ticks)) {<span class="kw">par</span>(<span class="dt">lab =</span> <span class="kw">c</span>(<span class="kw">length</span>(x.ticks), <span class="dv">5</span>, <span class="dv">7</span>))}</a>
<a class="sourceLine" id="cb583-12" data-line-number="12">  <span class="kw">plot</span>(y1, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">1</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb583-13" data-line-number="13">       <span class="dt">xlab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">main =</span> main)</a>
<a class="sourceLine" id="cb583-14" data-line-number="14">  <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb583-15" data-line-number="15">  <span class="kw">mtext</span>(<span class="dt">text =</span> y1.lab, <span class="dt">side =</span> <span class="dv">2</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb583-16" data-line-number="16">  <span class="kw">par</span>(<span class="dt">new =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb583-17" data-line-number="17">  <span class="kw">plot</span>(y2, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>, <span class="dt">axes =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb583-18" data-line-number="18">       <span class="dt">ylab =</span> <span class="st">&quot;&quot;</span>, <span class="dt">xlab =</span> x.lab)</a>
<a class="sourceLine" id="cb583-19" data-line-number="19">  <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb583-20" data-line-number="20">  <span class="kw">mtext</span>(<span class="dt">text =</span> y2.lab, <span class="dt">side =</span> <span class="dv">4</span>, <span class="dt">line =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb583-21" data-line-number="21">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">missing</span>(x.ticks)) {</a>
<a class="sourceLine" id="cb583-22" data-line-number="22">    <span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>, <span class="dt">labels =</span> <span class="kw">as.character</span>(x.ticks),</a>
<a class="sourceLine" id="cb583-23" data-line-number="23">         <span class="dt">at =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(x.ticks))</a>
<a class="sourceLine" id="cb583-24" data-line-number="24">  } <span class="cf">else</span> {<span class="kw">axis</span>(<span class="dt">side =</span> <span class="dv">1</span>)}</a>
<a class="sourceLine" id="cb583-25" data-line-number="25">  <span class="kw">par</span>(<span class="dt">mar =</span> old.par.mar)</a>
<a class="sourceLine" id="cb583-26" data-line-number="26">  <span class="kw">par</span>(<span class="dt">lab =</span> old.par.lab)</a>
<a class="sourceLine" id="cb583-27" data-line-number="27">}</a></code></pre>
<p>Once you have made the changes shown above, save the file and quit the editor.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise7.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise9.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["prfe.pdf", "prfe.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
