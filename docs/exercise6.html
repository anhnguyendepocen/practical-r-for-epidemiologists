<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Practical R for Epidemiologists</title>
  <meta name="description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book.">
  <meta name="generator" content="bookdown 0.7.1 and GitBook 2.6.7">

  <meta property="og:title" content="Practical R for Epidemiologists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://guevarra.io/prfe/" />
  <meta property="og:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />
  <meta property="og:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="github-repo" content="ernestguevarra/prfe" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Practical R for Epidemiologists" />
  
  <meta name="twitter:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="twitter:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />

<meta name="author" content="Mark Myatt">


<meta name="date" content="2018-04-22">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exercise5.html">
<link rel="next" href="exercise7.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
pre, code { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.bn { color: #0000cf; } /* BaseN */
code span.fl { color: #0000cf; } /* Float */
code span.ch { color: #4e9a06; } /* Char */
code span.st { color: #4e9a06; } /* String */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.ot { color: #8f5902; } /* Other */
code span.al { color: #ef2929; } /* Alert */
code span.fu { color: #000000; } /* Function */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #000000; } /* Constant */
code span.sc { color: #000000; } /* SpecialChar */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #000000; } /* Variable */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.ex { } /* Extension */
code span.at { color: #c4a000; } /* Attribute */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical R for Epidemiologists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Practical R for Epidemiologists</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="introducing-r.html"><a href="introducing-r.html"><i class="fa fa-check"></i><b>1</b> Introducing R</a><ul>
<li class="chapter" data-level="1.1" data-path="introducing-r.html"><a href="introducing-r.html#retrieving-data"><i class="fa fa-check"></i><b>1.1</b> Retrieving data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise1.html"><a href="exercise1.html"><i class="fa fa-check"></i><b>2</b> Getting acquainted with R</a><ul>
<li class="chapter" data-level="2.1" data-path="exercise1.html"><a href="exercise1.html#summary"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise2.html"><a href="exercise2.html"><i class="fa fa-check"></i><b>3</b> Manipulating objects and creating new functions</a><ul>
<li class="chapter" data-level="3.1" data-path="exercise2.html"><a href="exercise2.html#summary-1"><i class="fa fa-check"></i><b>3.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise3.html"><a href="exercise3.html"><i class="fa fa-check"></i><b>4</b> Logistic regression and stratified analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exercise3.html"><a href="exercise3.html#matched-data"><i class="fa fa-check"></i><b>4.1</b> Matched data</a></li>
<li class="chapter" data-level="4.2" data-path="exercise3.html"><a href="exercise3.html#summary-2"><i class="fa fa-check"></i><b>4.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise4.html"><a href="exercise4.html"><i class="fa fa-check"></i><b>5</b> Analysing some data with R</a><ul>
<li class="chapter" data-level="5.1" data-path="exercise4.html"><a href="exercise4.html#summary-3"><i class="fa fa-check"></i><b>5.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise5.html"><a href="exercise5.html"><i class="fa fa-check"></i><b>6</b> Extending R with packages</a><ul>
<li class="chapter" data-level="6.1" data-path="exercise5.html"><a href="exercise5.html#summary-4"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exercise6.html"><a href="exercise6.html"><i class="fa fa-check"></i><b>7</b> Making your own objects behave like R objects</a></li>
<li class="chapter" data-level="8" data-path="exercise7.html"><a href="exercise7.html"><i class="fa fa-check"></i><b>8</b> Writing your own graphical functions</a></li>
<li class="chapter" data-level="9" data-path="exercise8.html"><a href="exercise8.html"><i class="fa fa-check"></i><b>9</b> More graphical functions</a></li>
<li class="chapter" data-level="10" data-path="exercise9.html"><a href="exercise9.html"><i class="fa fa-check"></i><b>10</b> Computer intensive methods</a></li>
<li class="chapter" data-level="11" data-path="whatnow.html"><a href="whatnow.html"><i class="fa fa-check"></i><b>11</b> What now?</a></li>
<li class="divider"></li>
<li>&nbsp; &nbsp; @ Mark Myatt 2018</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical R for Epidemiologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise6" class="section level1">
<h1><span class="header-section-number">7</span> Making your own objects behave like R objects</h1>
<p>In the previous exercises we concentrated on writing functions that take some input data, analyse it, and display the results of the analysis. The standard <code>R</code> functions we have used all do this. The <code>fisher.test()</code> function, for example, takes a <code>table</code> object (or the names of two variables) as input and calculates and displays the p- value for <em>Fisher’s exact test</em> and the odds ratio and associated confidence interval for two-by-two tables:</p>
<pre class="sourceCode r" id="cb458"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" data-line-number="1">fem &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;fem.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb458-2" data-line-number="2"><span class="kw">attach</span>(fem)</a></code></pre>
<pre><code>## The following objects are masked from fem (pos = 7):
## 
##     AGE, ANX, DEP, ID, IQ, LIFE, SEX, SLP, WT</code></pre>
<pre class="sourceCode r" id="cb460"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1"><span class="kw">fisher.test</span>(SEX, LIFE)</a></code></pre>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  SEX and LIFE
## p-value = 0.03175
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.080298 14.214482
## sample estimates:
## odds ratio 
##   3.620646</code></pre>
<p>The results of the <code>fisher.test()</code> function may also be saved for later use:</p>
<pre class="sourceCode r" id="cb462"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" data-line-number="1">ft &lt;-<span class="st"> </span><span class="kw">fisher.test</span>(SEX, LIFE)</a>
<a class="sourceLine" id="cb462-2" data-line-number="2">ft</a></code></pre>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  SEX and LIFE
## p-value = 0.03175
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.080298 14.214482
## sample estimates:
## odds ratio 
##   3.620646</code></pre>
<p>The <code>fisher.test()</code> function returns an object of the class <code>htest</code>:</p>
<pre class="sourceCode r" id="cb464"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" data-line-number="1"><span class="kw">class</span>(ft)</a></code></pre>
<pre><code>## [1] &quot;htest&quot;</code></pre>
<p>which is a list containing the output of the <code>fisher.test()</code> function. Each item of output is stored as a different named item in the list:</p>
<pre class="sourceCode r" id="cb466"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" data-line-number="1"><span class="kw">names</span>(ft)</a>
<a class="sourceLine" id="cb466-2" data-line-number="2"><span class="kw">str</span>(ft)</a></code></pre>
<pre><code>## [1] &quot;p.value&quot;     &quot;conf.int&quot;    &quot;estimate&quot;    &quot;null.value&quot;  &quot;alternative&quot;
## [6] &quot;method&quot;      &quot;data.name&quot;</code></pre>
<pre><code>## List of 7
##  $ p.value    : num 0.0318
##  $ conf.int   : atomic [1:2] 1.08 14.21
##   ..- attr(*, &quot;conf.level&quot;)= num 0.95
##  $ estimate   : Named num 3.62
##   ..- attr(*, &quot;names&quot;)= chr &quot;odds ratio&quot;
##  $ null.value : Named num 1
##   ..- attr(*, &quot;names&quot;)= chr &quot;odds ratio&quot;
##  $ alternative: chr &quot;two.sided&quot;
##  $ method     : chr &quot;Fisher&#39;s Exact Test for Count Data&quot;
##  $ data.name  : chr &quot;SEX and LIFE&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;htest&quot;</code></pre>
<p>Each of these items can be referred to by name:</p>
<pre class="sourceCode r" id="cb469"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" data-line-number="1">ft<span class="op">$</span>estimate</a>
<a class="sourceLine" id="cb469-2" data-line-number="2">ft<span class="op">$</span>conf.int</a></code></pre>
<pre><code>## odds ratio 
##   3.620646</code></pre>
<pre><code>## [1]  1.080298 14.214482
## attr(,&quot;conf.level&quot;)
## [1] 0.95</code></pre>
<p>When you display the output of the <code>fisher.test()</code> function either by calling the function directly:</p>
<pre class="sourceCode r" id="cb472"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1"><span class="kw">fisher.test</span>(SEX, LIFE)</a></code></pre>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  SEX and LIFE
## p-value = 0.03175
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.080298 14.214482
## sample estimates:
## odds ratio 
##   3.620646</code></pre>
<p>or by typing the name of an object created using the <code>fisher.test()</code> function:</p>
<pre class="sourceCode r" id="cb474"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1">ft</a></code></pre>
<pre><code>## 
##  Fisher&#39;s Exact Test for Count Data
## 
## data:  SEX and LIFE
## p-value = 0.03175
## alternative hypothesis: true odds ratio is not equal to 1
## 95 percent confidence interval:
##   1.080298 14.214482
## sample estimates:
## odds ratio 
##   3.620646</code></pre>
<p>The <code>print()</code> function takes over and formatted output is produced. The <code>print()</code> function knows about <code>htest</code> class objects and produces output of the correct format for that class of object. This means that any function that produces an <code>htest</code> object (or any other standard <code>R</code> object) does not need to include <code>R</code> commands to produce formatted output.</p>
<p>All hypothesis testing functions supplied with <code>R</code> produce objects of the htest class and use the <code>print()</code> function to produce formatted output. For example:</p>
<pre class="sourceCode r" id="cb476"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1">tt &lt;-<span class="st"> </span><span class="kw">t.test</span>(WT <span class="op">~</span><span class="st"> </span>LIFE)</a>
<a class="sourceLine" id="cb476-2" data-line-number="2"><span class="kw">class</span>(tt)</a>
<a class="sourceLine" id="cb476-3" data-line-number="3">tt</a></code></pre>
<pre><code>## [1] &quot;htest&quot;</code></pre>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  WT by LIFE
## t = 0.60608, df = 98.866, p-value = 0.5459
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.3326225  0.6251763
## sample estimates:
## mean in group 1 mean in group 2 
##       0.7867213       0.6404444</code></pre>
<p>You can use this feature of <code>R</code> in your own functions. We will explore this by writing a function to test the null hypothesis that the <em>variance to mean ratio</em> of a vector of numbers is equal to one. Such a test might be used to investigate the spatial distribution (e.g. over natural sampling units such as households) of cases of a disease.</p>
<p>Create a new function using the <code>function()</code> function:</p>
<pre class="sourceCode r" id="cb479"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" data-line-number="1">v2m.test &lt;-<span class="st"> </span><span class="cf">function</span>(data) {}</a></code></pre>
<p>And start the function editor:</p>
<pre class="sourceCode r" id="cb480"><code class="sourceCode r"><a class="sourceLine" id="cb480-1" data-line-number="1"><span class="kw">fix</span>(v2m.test)</a></code></pre>
<p>Now edit this function to make it do something useful:</p>
<pre class="sourceCode r" id="cb481"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1"><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb481-2" data-line-number="2">  nsu &lt;-<span class="st"> </span><span class="kw">length</span>(data)</a>
<a class="sourceLine" id="cb481-3" data-line-number="3">  obs &lt;-<span class="st"> </span><span class="kw">sum</span>(data)</a>
<a class="sourceLine" id="cb481-4" data-line-number="4">  m &lt;-<span class="st"> </span>obs <span class="op">/</span><span class="st"> </span>nsu</a>
<a class="sourceLine" id="cb481-5" data-line-number="5">  v &lt;-<span class="st"> </span><span class="kw">var</span>(data)</a>
<a class="sourceLine" id="cb481-6" data-line-number="6">  vmr &lt;-<span class="st"> </span>v <span class="op">/</span><span class="st"> </span>m</a>
<a class="sourceLine" id="cb481-7" data-line-number="7">  chi2 &lt;-<span class="st"> </span><span class="kw">sum</span>((data <span class="op">-</span><span class="st"> </span>m)<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>m</a>
<a class="sourceLine" id="cb481-8" data-line-number="8">  df &lt;-<span class="st"> </span>nsu <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb481-9" data-line-number="9">  p &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(chi2, df)</a>
<a class="sourceLine" id="cb481-10" data-line-number="10">  <span class="kw">names</span>(chi2) &lt;-<span class="st"> &quot;Chi-square&quot;</span></a>
<a class="sourceLine" id="cb481-11" data-line-number="11">  <span class="kw">names</span>(df) &lt;-<span class="st"> &quot;df&quot;</span></a>
<a class="sourceLine" id="cb481-12" data-line-number="12">  <span class="kw">names</span>(vmr) &lt;-<span class="st"> &quot;Variance : mean ratio&quot;</span></a>
<a class="sourceLine" id="cb481-13" data-line-number="13">  v2m &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">method =</span> <span class="st">&quot;Variance to mean test&quot;</span>,</a>
<a class="sourceLine" id="cb481-14" data-line-number="14">              <span class="dt">data.name =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(data)),</a>
<a class="sourceLine" id="cb481-15" data-line-number="15">              <span class="dt">statistic =</span> chi2,</a>
<a class="sourceLine" id="cb481-16" data-line-number="16">              <span class="dt">parameter =</span> df,</a>
<a class="sourceLine" id="cb481-17" data-line-number="17">              <span class="dt">p.value =</span> p,</a>
<a class="sourceLine" id="cb481-18" data-line-number="18">              <span class="dt">estimate =</span> vmr)</a>
<a class="sourceLine" id="cb481-19" data-line-number="19">  <span class="kw">class</span>(v2m) &lt;-<span class="st"> &quot;htest&quot;</span></a>
<a class="sourceLine" id="cb481-20" data-line-number="20">  <span class="kw">return</span>(v2m)</a>
<a class="sourceLine" id="cb481-21" data-line-number="21">}</a></code></pre>
<pre class="sourceCode r" id="cb482"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1">v2m.test &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb482-2" data-line-number="2">  nsu &lt;-<span class="st"> </span><span class="kw">length</span>(data)</a>
<a class="sourceLine" id="cb482-3" data-line-number="3">  obs &lt;-<span class="st"> </span><span class="kw">sum</span>(data)</a>
<a class="sourceLine" id="cb482-4" data-line-number="4">  m &lt;-<span class="st"> </span>obs <span class="op">/</span><span class="st"> </span>nsu</a>
<a class="sourceLine" id="cb482-5" data-line-number="5">  v &lt;-<span class="st"> </span><span class="kw">var</span>(data)</a>
<a class="sourceLine" id="cb482-6" data-line-number="6">  vmr &lt;-<span class="st"> </span>v <span class="op">/</span><span class="st"> </span>m</a>
<a class="sourceLine" id="cb482-7" data-line-number="7">  chi2 &lt;-<span class="st"> </span><span class="kw">sum</span>((data <span class="op">-</span><span class="st"> </span>m)<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>m</a>
<a class="sourceLine" id="cb482-8" data-line-number="8">  df &lt;-<span class="st"> </span>nsu <span class="op">-</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb482-9" data-line-number="9">  p &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pchisq</span>(chi2, df)</a>
<a class="sourceLine" id="cb482-10" data-line-number="10">  <span class="kw">names</span>(chi2) &lt;-<span class="st"> &quot;Chi-square&quot;</span></a>
<a class="sourceLine" id="cb482-11" data-line-number="11">  <span class="kw">names</span>(df) &lt;-<span class="st"> &quot;df&quot;</span></a>
<a class="sourceLine" id="cb482-12" data-line-number="12">  <span class="kw">names</span>(vmr) &lt;-<span class="st"> &quot;Variance : mean ratio&quot;</span></a>
<a class="sourceLine" id="cb482-13" data-line-number="13">  v2m &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">method =</span> <span class="st">&quot;Variance to mean test&quot;</span>,</a>
<a class="sourceLine" id="cb482-14" data-line-number="14">              <span class="dt">data.name =</span> <span class="kw">deparse</span>(<span class="kw">substitute</span>(data)),</a>
<a class="sourceLine" id="cb482-15" data-line-number="15">              <span class="dt">statistic =</span> chi2,</a>
<a class="sourceLine" id="cb482-16" data-line-number="16">              <span class="dt">parameter =</span> df,</a>
<a class="sourceLine" id="cb482-17" data-line-number="17">              <span class="dt">p.value =</span> p,</a>
<a class="sourceLine" id="cb482-18" data-line-number="18">              <span class="dt">estimate =</span> vmr)</a>
<a class="sourceLine" id="cb482-19" data-line-number="19">  <span class="kw">class</span>(v2m) &lt;-<span class="st"> &quot;htest&quot;</span></a>
<a class="sourceLine" id="cb482-20" data-line-number="20">  <span class="kw">return</span>(v2m)</a>
<a class="sourceLine" id="cb482-21" data-line-number="21">}</a></code></pre>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>
<p>Before proceeding we should examine the <code>v2m.test()</code> function to make sure we understand what is happening:</p>
<ol style="list-style-type: decimal">
<li><p>The first eight lines after the opening curly bracket (<code>{</code>) contain the required calculations.</p></li>
<li><p>The next three lines use the <code>names()</code> function to give our variables names that will make sense in formatted output.</p></li>
<li><p>The next line creates a list of items that the function returns using some of the names used by <code>htest</code> class objects.</p></li>
<li><p>The next line tells <code>R</code> that the list object called <code>v2m</code> is of the class <code>htest</code>.</p></li>
<li><p>The next line causes the function to return the <code>v2m</code> object (i.e. a list of class <code>htest</code> containing the named items <code>method</code>, <code>data.name</code>, <code>statistic</code>, <code>parameter</code>, <code>p.value</code>, and <code>estimate</code>).</p></li>
<li><p>The final line ends the function definition.</p></li>
</ol>
<p>Note that objects of class htest may contain items with the following names:</p>
<table>
<colgroup>
<col width="22%" />
<col width="77%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>Item</strong></th>
<th><strong>Usage</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>method</strong></td>
<td>Text description of the test used to title output</td>
</tr>
<tr class="even">
<td><strong>data.name</strong></td>
<td>Name(s) of data or variables used for the test</td>
</tr>
<tr class="odd">
<td><strong>null.value</strong></td>
<td>The null value</td>
</tr>
<tr class="even">
<td><strong>statistic</strong></td>
<td>Value of test statistic</td>
</tr>
<tr class="odd">
<td><strong>parameter</strong></td>
<td>A test parameter such as the degrees of freedom of the test statistic</td>
</tr>
<tr class="even">
<td><strong>p.value</strong></td>
<td>The p-value of the test</td>
</tr>
<tr class="odd">
<td><strong>estimate</strong></td>
<td>An estimate (e.g. the mean)</td>
</tr>
<tr class="even">
<td><strong>conf.int</strong></td>
<td>Confidence interval of estimate</td>
</tr>
<tr class="odd">
<td><strong>alternative</strong></td>
<td>Text describing the alternative hypothesis</td>
</tr>
<tr class="even">
<td><strong>note</strong></td>
<td>Text note</td>
</tr>
</tbody>
</table>
<p>We are now ready to test the <code>v2m.test()</code> function. This table:</p>
<pre><code>Number of cases :       0  1  2  3  4  6
Number of households : 24 29 26 14  5  2</code></pre>
<p>shows the number of cases of chronic (stunting) undernutrition found in a random sample of 100 households.</p>
<p>We can reproduce the data behind this table using a combination of the <code>c()</code> and <code>rep()</code> functions:</p>
<pre class="sourceCode r" id="cb484"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1">stunt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">24</span>), <span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">29</span>), <span class="kw">rep</span>(<span class="dv">2</span>,<span class="dv">26</span>), <span class="kw">rep</span>(<span class="dv">3</span>,<span class="dv">14</span>), <span class="kw">rep</span>(<span class="dv">4</span>,<span class="dv">5</span>),</a>
<a class="sourceLine" id="cb484-2" data-line-number="2">           <span class="kw">rep</span>(<span class="dv">5</span>,<span class="dv">0</span>), <span class="kw">rep</span>(<span class="dv">6</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb484-3" data-line-number="3"><span class="kw">table</span>(stunt)</a></code></pre>
<pre><code>## stunt
##  0  1  2  3  4  6 
## 24 29 26 14  5  2</code></pre>
<p>And use it to test our new <code>v2m.test()</code> function:</p>
<pre class="sourceCode r" id="cb486"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1"><span class="kw">v2m.test</span>(stunt)</a></code></pre>
<p>Which should produce the following output:</p>
<pre class="sourceCode r" id="cb487"><code class="sourceCode r"><a class="sourceLine" id="cb487-1" data-line-number="1"><span class="kw">v2m.test</span>(stunt)</a></code></pre>
<pre><code>## 
##  Variance to mean test
## 
## data:  stunt
## Chi-square = 110.16, df = 99, p-value = 0.2083
## sample estimates:
## Variance : mean ratio 
##               1.11274</code></pre>
<p>If your <code>vm2.test()</code> function does not produce this output then use the <code>fix()</code> function:</p>
<pre class="sourceCode r" id="cb489"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1"><span class="kw">fix</span>(v2m.test)</a></code></pre>
<p>to check and edit the <code>vm2.test()</code> function and try again.</p>

</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise5.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise7.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["prfe.pdf", "prfe.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
