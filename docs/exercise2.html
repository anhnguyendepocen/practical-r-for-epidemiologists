<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Practical R for Epidemiologists</title>
  <meta name="description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book.">
  <meta name="generator" content="bookdown 0.7.1 and GitBook 2.6.7">

  <meta property="og:title" content="Practical R for Epidemiologists" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://guevarra.io/prfe/" />
  <meta property="og:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />
  <meta property="og:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="github-repo" content="ernestguevarra/practical-r-for-epidemiologists" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Practical R for Epidemiologists" />
  
  <meta name="twitter:description" content="This guide is intended as a practical introduction to using the R environment for data analysis and graphics to work with epidemiological data. Topics covered include univariate statistics, simple statistical inference, charting data, two-by-two tables, stratified analysis, chi-square test for trend, logistic regression, survival analysis, computer-intensive methods, and extending R using user-provided functions. You should be able to follow the material if you are reasonably familiar with the mechanics of statistical estimation (e.g. calculation of odds ratios and confidence intervals) and require a system that can perform simple or complex analyses to your exact specifications. If you are interested in a system that is flexible, can be tailored to produce exactly the analysis you want, provides modern analytical facilities, and have a basic understanding of the mechanics of hypothesis testing and estimation then you should consider purchasing this book." />
  <meta name="twitter:image" content="http://guevarra.io/prfe/images/bookcover.jpg" />

<meta name="author" content="Mark Myatt">


<meta name="date" content="2018-04-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="exercise1.html">
<link rel="next" href="exercise3.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; min-height: 1.25em; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; }
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
pre, code { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; color: initial; }
}
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.bn { color: #0000cf; } /* BaseN */
code span.fl { color: #0000cf; } /* Float */
code span.ch { color: #4e9a06; } /* Char */
code span.st { color: #4e9a06; } /* String */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.ot { color: #8f5902; } /* Other */
code span.al { color: #ef2929; } /* Alert */
code span.fu { color: #000000; } /* Function */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code span.cn { color: #000000; } /* Constant */
code span.sc { color: #000000; } /* SpecialChar */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.im { } /* Import */
code span.va { color: #000000; } /* Variable */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.ex { } /* Extension */
code span.at { color: #c4a000; } /* Attribute */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Practical R for Epidemiologists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome to Practical R for Epidemiologists</a></li>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="1" data-path="introducing-r.html"><a href="introducing-r.html"><i class="fa fa-check"></i><b>1</b> Introducing R</a><ul>
<li class="chapter" data-level="1.1" data-path="introducing-r.html"><a href="introducing-r.html#retrieving-data"><i class="fa fa-check"></i><b>1.1</b> Retrieving data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exercise1.html"><a href="exercise1.html"><i class="fa fa-check"></i><b>2</b> Getting acquainted with R</a><ul>
<li class="chapter" data-level="2.1" data-path="exercise1.html"><a href="exercise1.html#summary"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise2.html"><a href="exercise2.html"><i class="fa fa-check"></i><b>3</b> Manipulating objects and creating new functions</a><ul>
<li class="chapter" data-level="3.1" data-path="exercise2.html"><a href="exercise2.html#summary-1"><i class="fa fa-check"></i><b>3.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise3.html"><a href="exercise3.html"><i class="fa fa-check"></i><b>4</b> Logistic regression and stratified analysis</a><ul>
<li class="chapter" data-level="4.1" data-path="exercise3.html"><a href="exercise3.html#matched-data"><i class="fa fa-check"></i><b>4.1</b> Matched data</a></li>
<li class="chapter" data-level="4.2" data-path="exercise3.html"><a href="exercise3.html#summary-2"><i class="fa fa-check"></i><b>4.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise4.html"><a href="exercise4.html"><i class="fa fa-check"></i><b>5</b> Analysing some data with R</a><ul>
<li class="chapter" data-level="5.1" data-path="exercise4.html"><a href="exercise4.html#summary-3"><i class="fa fa-check"></i><b>5.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="exercise5.html"><a href="exercise5.html"><i class="fa fa-check"></i><b>6</b> Extending R with packages</a><ul>
<li class="chapter" data-level="6.1" data-path="exercise5.html"><a href="exercise5.html#summary-4"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exercise6.html"><a href="exercise6.html"><i class="fa fa-check"></i><b>7</b> Making your own objects behave like R objects</a><ul>
<li class="chapter" data-level="7.1" data-path="exercise6.html"><a href="exercise6.html#summary-5"><i class="fa fa-check"></i><b>7.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="exercise7.html"><a href="exercise7.html"><i class="fa fa-check"></i><b>8</b> Writing your own graphical functions</a><ul>
<li class="chapter" data-level="8.1" data-path="exercise7.html"><a href="exercise7.html#summary-6"><i class="fa fa-check"></i><b>8.1</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="exercise8.html"><a href="exercise8.html"><i class="fa fa-check"></i><b>9</b> More graphical functions</a></li>
<li class="chapter" data-level="10" data-path="exercise9.html"><a href="exercise9.html"><i class="fa fa-check"></i><b>10</b> Computer intensive methods</a></li>
<li class="chapter" data-level="11" data-path="whatnow.html"><a href="whatnow.html"><i class="fa fa-check"></i><b>11</b> What now?</a></li>
<li class="divider"></li>
<li>&nbsp; &nbsp; @ Mark Myatt 2018</li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Practical R for Epidemiologists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise2" class="section level1">
<h1><span class="header-section-number">3</span> Manipulating objects and creating new functions</h1>
<p>In this exercise we will explore how to manipulate <code>R</code> objects and how to write functions that can manipulate and extract data and information from <code>R</code> objects and produce useful analyses.</p>
<p>Before we go any further we should start <code>R</code> and retrieve a dataset:</p>
<pre class="sourceCode r" id="cb141"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">salex &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;salex.dat&quot;</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>, <span class="dt">na.strings =</span> <span class="st">&quot;9&quot;</span>)</a></code></pre>
<p>Missing values are coded as 9 throughout this dataset so we can use the <code>na.strings</code> parameter of the <code>read.table()</code> function to replace all 9’s with the special <code>NA</code> code when we retrieve the dataset. Check that this works by examining the <code>salex</code> data.frame:</p>
<pre class="sourceCode r" id="cb142"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" data-line-number="1">salex</a></code></pre>
<pre><code>##    ILL HAM BEEF EGGS MUSHROOM PEPPER PORKPIE PASTA RICE LETTUCE TOMATO
## 1    1   1    1    1        1      1       2     2    2       2      2
## 2    1   1    1    1        2      2       1     2    2       2      1
## 3    1   1    1    1        1      1       1     1    1       1      2
## 4    1   1    1    1        2      2       2     2    2       1      1
## 5    1   1    1    1        1      1       1     1    1       1      1
## 6    1   1    1    1        2      2       2     2    2       2      1
## 7    1   1    1    1        1      1       1     2    2       2      2
## 8    1   1    2    1        1      1       2     1    1       1      2
## 9    1   1    1    1        2      1       1     2    1       2      2
## 10   1   1    1    1        2      1       1     1    1       1      1
## 11   1   2    2    1        1      1       2     2    2       1      1
## 12   1   1    1    1        2      2       2     2    2       2      2
## 13   2   2    1    2        2      2       1     2    2       2      1
## 14   1   1    1    1        2      2       2     1    1       2      1
## 15   1   1    1    1        1      1       2     1    1       2      2
## 16   1   1    1    1        1      1       1     2    2       2      2
## 17   1   1    1    1        1      1       1     1    1       1      1
## 18   2   1    1    2        2      2       2     2    2       2      2
## 19   2   1    1    1        1      2       2     1    1       2      1
## 20   2   1    1    2        2      2       2     2    2       2      2
## 21   2   2    2    2        2      2       2     2    2       2      2
## 22   1   1    1    1        2      2       2     2    2       1      1
## 23   1   2    1    2        2      2       2     1    1       2      1
## 24   1   1    1    1        2      1       2     1    1       2      2
## 25   1   1    1    2        1      1       1     1    1       1      1
## 26   1   1    2    1        1      1       2     2    2       1      1
## 27   1   1    1    1        2      2       1     2    1       1      1
## 28   1   1    1    1        1      1       2     1    1       2      2
## 29   1   2    1    1        1     NA       2     1    1       1      1
## 30   1   1    1    2        2      2       1     2    2       2      2
## 31   1   1    1    1        1      2       2     1    1       2      2
## 32   1   1    1    1        1      2      NA     2    1       1      1
## 33   1   1    1    1        2      2       2     1    2       2      2
## 34   1   1    1    1        1      2       2     2    2       1      1
## 35   1   1    1    1        1      1       1     1    2       2      1
## 36   2   2    1    2        2      2       2     2    2       2      2
## 37   1   1    1    1        1      1       2     1    1       1      1
## 38   1   1    1    2        2      2       1     1    1       1      2
## 39   1   1    1    1        1      1       1     2    2       1      2
## 40   1   1    1    1        1      1       1     2    2       1      1
## 41   1   1    1    2        2      1       2     1    1       1      1
## 42   1   1    1    2        2      2       2     2    2       2      2
## 43   1   1    1    1        1      1       2     1    1       1      1
## 44   1   2    1    2        2      2       1     2    2       1      2
## 45   1   1    1    1        1      2       2     2    1       1      1
## 46   1   1    1    2        2      2       2     1    1       1      1
## 47   1   1    1    1        2      2       2     2    1       1      2
## 48   1   1    1    1        1     NA       1     1    1       2      2
## 49   1   1    1    1        2      1       2     2    1       1      1
## 50   1   2    1    1        2      2       2     1    2       2      1
## 51   2   2    1    2        2      2       2     2    2       2      2
## 52   2   1    1    2        2      2       2     1    2       2      1
## 53   2   1    1    2        2      2       1     2    2       2      1
## 54   2   1    1    2        1      2       1     2    2       2      1
## 55   2   1    1    1        1      1       2     2    1       2      2
## 56   2   1    1    2        2      2       2     2    2       2      1
## 57   2   1    1    1        1      1       1     2    2       2      2
## 58   2   1    1    1        2      2       1     2    1       2      2
## 59   2   1    1    2        2      2       2     2    2       2      2
## 60   2   2    2    2        2      2       1     2    2       2      2
## 61   2   1    1    2        2      2       1     2    2       2      2
## 62   2   1    2    2        2      2       2     2    2       1      1
## 63   1   1    1    1        1      1       2     2    2       2      1
## 64   2   1    1    2        2      2       2     2    2       2      2
## 65   2   1    1    1        1      2       1     2    1       2      2
## 66   2   2    1    2        2      2       2     2    2       2      2
## 67   2   2    1    2        2      2       2     2    2       2      2
## 68   2   1    1    2        1      1       1     1    2       2      1
## 69   2   2    1    2        2      2       2     2    2       2      2
## 70   2   2    1    2        2      2       2     2    2       2      2
## 71   1   1    2    2        2      2       1     2    1       2      2
## 72   2   1    2    1       NA     NA       2     2    2       2      1
## 73   1   1    1    1        2      2       1     2    2       2      2
## 74   1   1    2    1       NA     NA       2     1    1       1      1
## 75   1   1    2    2        2      1       2     1    2       1      1
## 76   1   1    1    1        2      2       1     1    2       2      2
## 77   1   1    1   NA       NA     NA       1     2    1       1      1
##    COLESLAW CRISPS PEACHCAKE CHOCOLATE FRUIT TRIFLE ALMONDS
## 1         2      2         2         2     2      2       2
## 2         2      2         2         2     2      2       2
## 3         2      1         2         1     2      2       2
## 4         2      2         2         1     2      2       2
## 5         1      2         2         1     2      1       2
## 6         1      1         2         1     2      2       2
## 7         1      1         1         2     2      2       2
## 8         1      1         2         2     2      1       2
## 9         2      2         2         2     2      1       2
## 10        1      1         2         2     2      1       1
## 11        2      2         2         2     2      2      NA
## 12        2      1         2         1     2      2       2
## 13        2      1         2         2     1      2      NA
## 14        1      1         2         2     2      1       2
## 15        1      1         2         2     2      1       1
## 16        1      2         2         2     2      2       2
## 17        1      2         2         2     2      2       2
## 18        2      2         2         2     2      2       2
## 19        1      1         2         2     1      2       2
## 20        2      2         2         1     2      2       2
## 21        2      2         2         2     2      2       2
## 22        2      1         2         1     2      2       2
## 23        1      2         2         2     2      2      NA
## 24        1      1         2         2     2      1       2
## 25        1      2         2         2     2      1      NA
## 26        1      2         2         2     2      1       2
## 27        1      1         1         1     2      1       2
## 28        2      1         2         2     2      2      NA
## 29        1      1         2         2     2      2      NA
## 30        2      2         2         2     2      2       2
## 31        2      2         2         2     2      2       2
## 32        2      2         2         2     2      2       2
## 33        1      2         2         2     2      2       2
## 34        1      2         2         2     2      1       2
## 35        1      2         2         2     2      1       2
## 36        2      2         2         2     2      2      NA
## 37        1      1         2         1     2      1       2
## 38        2      2         2         2     2      2       2
## 39        2      2         2         1     2      2       2
## 40        1      2         2         2     2      2       2
## 41        1      1         2         2    NA      1      NA
## 42        2      2         2         2     2      2      NA
## 43        1      1         2         2     2      2      NA
## 44        2      2         2         2     2      2       2
## 45        1      2         2         2     2      1       2
## 46        1      2         2         2     2      1       2
## 47        2      2         2        NA     2      1       2
## 48        2      1         2         2     2      2       2
## 49        1      1         2         2     2      1       2
## 50       NA      2         2         1     2      1       1
## 51        2      2         2         2     2      2      NA
## 52        2      2         2         1     2      2       1
## 53        2      2         2         2     1      2       2
## 54        2      2         2         2     2      2       2
## 55        2      1         2         2     2      2       2
## 56        2      2         2         2     1      2       2
## 57        1      2         2         2     2      2       1
## 58        2      1         1         2     2      2       2
## 59        2      1         1         2     2      1       2
## 60        2      2         2         2     2      2       2
## 61        2      1         2         2     2      1       1
## 62        2      1         2         2     2      2       2
## 63        1      2         2         1     1      2       2
## 64        2      2         2         2     2      2       2
## 65        1      1         2         2     2      1       2
## 66        2      2         2         2     2      1      NA
## 67        2      1         2         2     2      2       2
## 68        2      2         2         2     2      2       2
## 69        2      1         2         2     2      2       2
## 70        2      2         2         2     2      2       2
## 71        2      2         2         2     2      2       2
## 72        2      2         2         2     2      1       2
## 73        2      2         2         2     2      2       2
## 74        1      1         2         1     2      2       2
## 75        1      1         2         2     2      2      NA
## 76        2      2         2         2     2      2      NA
## 77        1      1         2         2     2      2       2</code></pre>
<pre class="sourceCode r" id="cb144"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" data-line-number="1"><span class="kw">names</span>(salex)</a></code></pre>
<pre><code>##  [1] &quot;ILL&quot;       &quot;HAM&quot;       &quot;BEEF&quot;      &quot;EGGS&quot;      &quot;MUSHROOM&quot; 
##  [6] &quot;PEPPER&quot;    &quot;PORKPIE&quot;   &quot;PASTA&quot;     &quot;RICE&quot;      &quot;LETTUCE&quot;  
## [11] &quot;TOMATO&quot;    &quot;COLESLAW&quot;  &quot;CRISPS&quot;    &quot;PEACHCAKE&quot; &quot;CHOCOLATE&quot;
## [16] &quot;FRUIT&quot;     &quot;TRIFLE&quot;    &quot;ALMONDS&quot;</code></pre>
<p>This data comes from a food-borne outbreak. On Saturday 17th October 1992, eighty-two people attended a buffet meal at a sports club. Within fourteen to twenty-four hours, fifty-one of the participants developed diarrhoea, with nausea, vomiting, abdominal pain and fever.</p>
<p>The columns in the dataset are as follows:</p>
<table style="width:54%;">
<colgroup>
<col width="22%" />
<col width="31%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>ILL</strong></td>
<td>Ill or not-ill</td>
</tr>
<tr class="even">
<td><strong>HAM</strong></td>
<td>Baked ham</td>
</tr>
<tr class="odd">
<td><strong>BEEF</strong></td>
<td>Roast beef</td>
</tr>
<tr class="even">
<td><strong>EGGS</strong></td>
<td>Eggs</td>
</tr>
<tr class="odd">
<td><strong>MUSHROOM</strong></td>
<td>Mushroom flan</td>
</tr>
<tr class="even">
<td><strong>PEPPER</strong></td>
<td>Pepper flan</td>
</tr>
<tr class="odd">
<td><strong>PORKPIE</strong></td>
<td>Pork pie</td>
</tr>
<tr class="even">
<td><strong>PASTA</strong></td>
<td>Pasta salad</td>
</tr>
<tr class="odd">
<td><strong>RICE</strong></td>
<td>Rice salad</td>
</tr>
<tr class="even">
<td><strong>LETTUCE</strong></td>
<td>Lettuce</td>
</tr>
<tr class="odd">
<td><strong>TOMATO</strong></td>
<td>Tomato salad</td>
</tr>
<tr class="even">
<td><strong>COLESLAW</strong></td>
<td>Coleslaw</td>
</tr>
<tr class="odd">
<td><strong>CRISPS</strong></td>
<td>Crisps</td>
</tr>
<tr class="even">
<td><strong>PEACHCAKE</strong></td>
<td>Peach cake</td>
</tr>
<tr class="odd">
<td><strong>CHOCOLATE</strong></td>
<td>Chocolate cake</td>
</tr>
<tr class="even">
<td><strong>FRUIT</strong></td>
<td>Tropical fruit salad</td>
</tr>
<tr class="odd">
<td><strong>TRIFLE</strong></td>
<td>Trifle</td>
</tr>
<tr class="even">
<td><strong>ALMONDS</strong></td>
<td>Almonds</td>
</tr>
</tbody>
</table>
<p>Data is available for seventy-seven of the eighty-two people who attended the sports club buffet. All of the variables are coded 1=yes, 2=no.</p>
<p>We can use the <code>attach()</code> function to make it easier to access our data:</p>
<pre class="sourceCode r" id="cb146"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" data-line-number="1"><span class="kw">attach</span>(salex)</a></code></pre>
<p>The two-by-two table is a basic epidemiological tool. In analysing data from a food-borne outbreak collected as a retrospective cohort study, for example, we would tabulate each exposure (suspect foodstuffs) against the outcome (illness) and calculate risk ratios and confidence intervals. <code>R</code> has no explicit function to calculate risk ratios from two-by-two tables but we can easily write one ourselves.</p>
<p>The first step in writing such a function would be to create the two-by-two table. This can be done with the <code>table()</code> function. We will use a table of <code>HAM</code> by <code>ILL</code> as an illustration:</p>
<pre class="sourceCode r" id="cb147"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">table</span>(HAM, ILL)</a></code></pre>
<p>This command produces the following output:</p>
<pre><code>##    ILL
## HAM  1  2
##   1 46 17
##   2  5  9</code></pre>
<p>We can manipulate the output directly but it is easier if we instruct <code>R</code> to save the output of the <code>table()</code> function in an object:</p>
<pre class="sourceCode r" id="cb149"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1">tab &lt;-<span class="st"> </span><span class="kw">table</span>(HAM, ILL)</a></code></pre>
<p>The <code>tab</code> object contains the output of the <code>table()</code> function:</p>
<pre class="sourceCode r" id="cb150"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" data-line-number="1">tab</a></code></pre>
<pre><code>##    ILL
## HAM  1  2
##   1 46 17
##   2  5  9</code></pre>
<p>As it is stored in an object we can examine its contents on an item by item basis.</p>
<p>The <code>tab</code> object is an object of class <code>table</code>:</p>
<pre class="sourceCode r" id="cb152"><code class="sourceCode r"><a class="sourceLine" id="cb152-1" data-line-number="1"><span class="kw">class</span>(tab)</a></code></pre>
<pre><code>## [1] &quot;table&quot;</code></pre>
<p>We can extract data from a table object by using indices or row and column co-ordinates:</p>
<pre class="sourceCode r" id="cb154"><code class="sourceCode r"><a class="sourceLine" id="cb154-1" data-line-number="1">tab[<span class="dv">1</span>,<span class="dv">1</span>]</a></code></pre>
<pre><code>## [1] 46</code></pre>
<pre class="sourceCode r" id="cb156"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" data-line-number="1">tab[<span class="dv">1</span>,<span class="dv">2</span>]</a></code></pre>
<pre><code>## [1] 17</code></pre>
<pre class="sourceCode r" id="cb158"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" data-line-number="1">tab[<span class="dv">2</span>,<span class="dv">1</span>]</a></code></pre>
<pre><code>## [1] 5</code></pre>
<p>The numbers in the square brackets refer to the <strong><em>position</em></strong> (as row and column co-ordinates) of the data item in the table <strong><em>not</em></strong> the <strong><em>values</em></strong> of the variables. We can extract data using the values of the row and column variables by enclosing the index values in double quotes (“). For example:</p>
<pre class="sourceCode r" id="cb160"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">tab[<span class="st">&quot;1&quot;</span>,<span class="st">&quot;1&quot;</span>]</a></code></pre>
<pre><code>## [1] 46</code></pre>
<p>The two methods of extracting data may be combined. For example:</p>
<pre class="sourceCode r" id="cb162"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">tab[<span class="dv">1</span>,<span class="st">&quot;1&quot;</span>]</a></code></pre>
<pre><code>## [1] 46</code></pre>
<p>We can calculate a risk ratio using the extracted data:</p>
<pre class="sourceCode r" id="cb164"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1">(tab[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">/</span>(tab[<span class="dv">1</span>,<span class="dv">1</span>]<span class="op">+</span>tab[<span class="dv">1</span>,<span class="dv">2</span>]))<span class="op">/</span>(tab[<span class="dv">2</span>,<span class="dv">1</span>]<span class="op">/</span>(tab[<span class="dv">2</span>,<span class="dv">1</span>]<span class="op">+</span>tab[<span class="dv">2</span>,<span class="dv">2</span>]))</a></code></pre>
<p>Which returns a risk ratio of</p>
<pre><code>## [1] 2.044444</code></pre>
<p>This is a tedious calculation to have to type in every time you need to calculate a risk ratio from a two-by-two table. It would be better to have a function that calculates and displays the risk ratio automatically. Fortunately, <code>R</code> allows us to do just that.</p>
<p>The <code>function()</code> function allows us to create new functions in <code>R</code>:</p>
<pre class="sourceCode r" id="cb166"><code class="sourceCode r"><a class="sourceLine" id="cb166-1" data-line-number="1">tab2by2 &lt;-<span class="st"> </span><span class="cf">function</span>(exposure, outcome) {}</a></code></pre>
<p>This creates an empty function called <code>tab2by2</code> that expects two parameters called <code>exposure</code> and <code>outcome</code>. We could type the whole function in at the <code>R</code> command prompt but it is easier to use a text editor:</p>
<pre class="sourceCode r" id="cb167"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="kw">fix</span>(tab2by2)</a></code></pre>
<p>This will start an editor with the empty <code>tab2by2()</code> function already loaded. We can now edit this function to make it do something useful:</p>
<pre class="sourceCode r" id="cb168"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1"><span class="cf">function</span>(exposure, outcome)</a>
<a class="sourceLine" id="cb168-2" data-line-number="2">  {</a>
<a class="sourceLine" id="cb168-3" data-line-number="3">  tab &lt;-<span class="st"> </span><span class="kw">table</span>(exposure, outcome)</a>
<a class="sourceLine" id="cb168-4" data-line-number="4">  a &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb168-5" data-line-number="5">  b &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb168-6" data-line-number="6">  c &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb168-7" data-line-number="7">  d &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb168-8" data-line-number="8">  rr &lt;-<span class="st"> </span>(a <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b)) <span class="op">/</span><span class="st"> </span>(c <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d))</a>
<a class="sourceLine" id="cb168-9" data-line-number="9">  <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb168-10" data-line-number="10">  <span class="kw">print</span>(rr) </a>
<a class="sourceLine" id="cb168-11" data-line-number="11">  }</a></code></pre>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.
Before proceeding we should examine the <code>tab2by2()</code> function to make sure we understand what the function will do:</p>
<ul>
<li><p>The first line defines <code>tab2by2</code> as a function that expects to be given two parameters which are called <code>exposure</code> and <code>outcome</code>.</p></li>
<li><p>The body of the function (i.e. the work of the function) is enclosed within curly brackets (<code>{}</code>).</p></li>
<li><p>The first line of the body of the function creates a table object (<code>tab</code>) using the variables specified when the <code>tab2by2()</code> function is called (these are the parameters <code>exposure</code> and <code>outcome</code>).</p></li>
<li><p>The next line creates four new objects (called <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>) which contain the values of the four cells in the two-by-two table.</p></li>
<li><p>The following line calculates the risk ratio using the objects <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code> and stores the result of the calculation in an object called <code>rr</code>.</p></li>
<li><p>The final two lines print the contents of the <code>tab</code> and <code>rr</code> objects.</p></li>
</ul>
<p>Let’s try the <code>tab2by2()</code> function with our test data:</p>
<pre class="sourceCode r" id="cb169"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="kw">tab2by2</span>(HAM, ILL)</a></code></pre>
<pre><code>##         outcome
## exposure  1  2
##        1 46 17
##        2  5  9
## [1] 2.044444</code></pre>
<p>The <code>tab2by2()</code> function displays a table of <code>HAM</code> by <code>ILL</code> followed by the risk ratio calculated from the data in the table.</p>
<p>Try producing another table:</p>
<pre class="sourceCode r" id="cb171"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="kw">tab2by2</span>(PASTA, ILL)</a></code></pre>
<pre><code>##         outcome
## exposure  1  2
##        1 25  3
##        2 26 23
## [1] 1.682692</code></pre>
<p>Have a look at the <code>R</code> objects available to you:</p>
<pre class="sourceCode r" id="cb173"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw">ls</span>()</a></code></pre>
<pre><code>## [1] &quot;fem&quot;     &quot;salex&quot;   &quot;tab&quot;     &quot;tab2by2&quot;</code></pre>
<p>Note that there are no <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, or <code>rr</code> objects.</p>
<p>Examine the <code>tab</code> object:</p>
<pre class="sourceCode r" id="cb175"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1">tab</a></code></pre>
<pre><code>##    ILL
## HAM  1  2
##   1 46 17
##   2  5  9</code></pre>
<p>This is the table of <code>HAM</code> by <code>ILL</code> that you created earlier <strong><em>not</em></strong> the table of <code>PASTA</code> by <code>ILL</code> that was created by the <code>tab2by2()</code> function.</p>
<p>The <code>tab</code>, <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, and <code>rr</code> objects in the <code>tab2by2()</code> function are local to that function and do not change anything outside of that function. This means that the <code>tab</code> object inside the function is independent of any object of the same name outside of the function.</p>
<p>When a function completes its work, all of the objects that are local to that function are automatically removed. This is useful as it means that you can use object names inside functions that will not interfere with objects of the same name that are stored elsewhere. It also means that you do not clutter up the <code>R</code> workspace with temporary objects.</p>
<p>Just to prove that <code>tab</code> in the <code>tab2by2()</code> function exists only in the <code>tab2by2()</code> function we can delete the tab object from the <code>R</code> workspace:</p>
<pre class="sourceCode r" id="cb177"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="kw">rm</span>(tab)</a></code></pre>
<p>Now try another call to the <code>tab2by2()</code> function:</p>
<pre class="sourceCode r" id="cb178"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" data-line-number="1"><span class="kw">tab2by2</span>(FRUIT, ILL)</a></code></pre>
<pre><code>##         outcome
## exposure  1  2
##        1  1  4
##        2 49 22
## [1] 0.2897959</code></pre>
<p>Now list the <code>R</code> objects available to you:</p>
<pre class="sourceCode r" id="cb180"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" data-line-number="1"><span class="kw">ls</span>()</a></code></pre>
<pre><code>## [1] &quot;fem&quot;     &quot;salex&quot;   &quot;tab2by2&quot;</code></pre>
<p>Note that there are no <code>tab</code>, <code>a</code>, <code>b</code>, <code>c</code>, <code>d</code>, or <code>rr</code> objects.</p>
<p>The <code>tab2by2()</code> function is very limited. It only displays a table and calculates and displays a simple ratio. A more useful function would also calculate and display a confidence interval for the risk ratio. This is what we will do now. Use the <code>fix()</code> function to edit the <code>tab2by2()</code> function:</p>
<pre class="sourceCode r" id="cb182"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" data-line-number="1"><span class="kw">fix</span>(tab2by2)</a></code></pre>
<p>We can now edit this function to calculate and display a 95% confidence interval for the risk ratio.</p>
<pre class="sourceCode r" id="cb183"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1"><span class="cf">function</span>(exposure, outcome) {</a>
<a class="sourceLine" id="cb183-2" data-line-number="2">  tab &lt;-<span class="st"> </span><span class="kw">table</span>(exposure, outcome)</a>
<a class="sourceLine" id="cb183-3" data-line-number="3">  a &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb183-4" data-line-number="4">  b &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb183-5" data-line-number="5">  c &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb183-6" data-line-number="6">  d &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb183-7" data-line-number="7">  rr &lt;-<span class="st"> </span>(a <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b)) <span class="op">/</span><span class="st"> </span>(c <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d))</a>
<a class="sourceLine" id="cb183-8" data-line-number="8">  se.log.rr &lt;-<span class="st"> </span><span class="kw">sqrt</span>((b <span class="op">/</span><span class="st"> </span>a) <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b) <span class="op">+</span><span class="st"> </span>(d <span class="op">/</span><span class="st"> </span>c) <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d)) </a>
<a class="sourceLine" id="cb183-9" data-line-number="9">  lci.rr &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(rr) <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.rr)</a>
<a class="sourceLine" id="cb183-10" data-line-number="10">  uci.rr &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(rr) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.rr)</a>
<a class="sourceLine" id="cb183-11" data-line-number="11">  <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb183-12" data-line-number="12">  <span class="kw">print</span>(rr)</a>
<a class="sourceLine" id="cb183-13" data-line-number="13">  <span class="kw">print</span>(lci.rr)</a>
<a class="sourceLine" id="cb183-14" data-line-number="14">  <span class="kw">print</span>(uci.rr)</a>
<a class="sourceLine" id="cb183-15" data-line-number="15">}</a></code></pre>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor. We should test our revised function:</p>
<pre class="sourceCode r" id="cb184"><code class="sourceCode r"><a class="sourceLine" id="cb184-1" data-line-number="1"><span class="kw">tab2by2</span>(EGGS, ILL)</a></code></pre>
<p>which produces the following output:</p>
<pre><code>##         outcome
## exposure  1  2
##        1 40  6
##        2 10 20
## [1] 2.608696
## [1] 1.553564
## [1] 4.38044</code></pre>
<p>The function works but the output could be improved. Use the <code>fix()</code> function to edit the <code>tab2by2()</code> function:</p>
<pre class="sourceCode r" id="cb186"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1"><span class="cf">function</span>(exposure, outcome) {</a>
<a class="sourceLine" id="cb186-2" data-line-number="2">  tab &lt;-<span class="st"> </span><span class="kw">table</span>(exposure, outcome)</a>
<a class="sourceLine" id="cb186-3" data-line-number="3">  a &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb186-4" data-line-number="4">  b &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb186-5" data-line-number="5">  c &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb186-6" data-line-number="6">  d &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb186-7" data-line-number="7">  rr &lt;-<span class="st"> </span>(a <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b)) <span class="op">/</span><span class="st"> </span>(c <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d))</a>
<a class="sourceLine" id="cb186-8" data-line-number="8">  se.log.rr &lt;-<span class="st"> </span><span class="kw">sqrt</span>((b <span class="op">/</span><span class="st"> </span>a) <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b) <span class="op">+</span><span class="st"> </span>(d <span class="op">/</span><span class="st"> </span>c) <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d)) </a>
<a class="sourceLine" id="cb186-9" data-line-number="9">  lci.rr &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(rr) <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.rr)</a>
<a class="sourceLine" id="cb186-10" data-line-number="10">  uci.rr &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(rr) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.rr)</a>
<a class="sourceLine" id="cb186-11" data-line-number="11">  <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb186-12" data-line-number="12">  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">RR :&quot;</span>, rr,</a>
<a class="sourceLine" id="cb186-13" data-line-number="13">      <span class="st">&quot;</span><span class="ch">\n</span><span class="st">95% CI :&quot;</span>, lci.rr, uci.rr, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb186-14" data-line-number="14">}</a></code></pre>
<p>Once you have made the changes shown above, save the file and quit the editor.</p>
<p>Now we can test our function again:</p>
<pre class="sourceCode r" id="cb187"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1"><span class="kw">tab2by2</span>(EGGS, ILL)</a></code></pre>
<p>Which produces the following output:</p>
<pre><code>##         outcome
## exposure  1  2
##        1 40  6
##        2 10 20
## 
## RR : 2.608696 
## 95% CI : 1.553564 4.38044</code></pre>
<p>The <code>tab2by2()</code> function displays output but does not behave like a standard <code>R</code> function in the sense that you cannot save the results of the <code>tab2by2()</code> function into an object:</p>
<pre class="sourceCode r" id="cb189"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">test2by2 &lt;-<span class="st"> </span><span class="kw">tab2by2</span>(EGGS, ILL)</a></code></pre>
<pre><code>##         outcome
## exposure  1  2
##        1 40  6
##        2 10 20
## 
## RR : 2.608696 
## 95% CI : 1.553564 4.38044</code></pre>
<p>displays output but does not save anything in the <code>test2by2</code> object:</p>
<pre class="sourceCode r" id="cb191"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1">test2by2</a></code></pre>
<pre><code>## NULL</code></pre>
<p>The returned value (<code>NULL</code>) means that <code>test2by2</code> is an empty object. We will not worry about this at the moment as the <code>tab2by2()</code> function is good-enough for our current purposes. In Exercise 6 we will explore how to make our own functions behave like standard <code>R</code> functions.</p>
<p>We will now add the calculation of the odds ratio and its 95% confidence interval to the <code>tab2by2()</code> function using the <code>fix()</code> function.</p>
<p>There are two ways of doing this. We could either calculate the odds ratio from the table and use (e.g.) the method of Woolf to calculate the confidence interval:</p>
<pre class="sourceCode r" id="cb193"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1">or &lt;-<span class="st"> </span>(a <span class="op">/</span><span class="st"> </span>b) <span class="op">/</span><span class="st"> </span>(c <span class="op">/</span><span class="st"> </span>d)</a>
<a class="sourceLine" id="cb193-2" data-line-number="2">se.log.or &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>d)</a>
<a class="sourceLine" id="cb193-3" data-line-number="3">lci.or &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(or) <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.or)</a>
<a class="sourceLine" id="cb193-4" data-line-number="4">uci.or &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(or) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.or)</a>
<a class="sourceLine" id="cb193-5" data-line-number="5"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">OR     :&quot;</span>, or,</a>
<a class="sourceLine" id="cb193-6" data-line-number="6">    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">95% CI :&quot;</span>, lci.or, uci.or, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre>
<p>or use the output of the <code>fisher.test()</code> function:</p>
<pre class="sourceCode r" id="cb194"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1">ft &lt;-<span class="st"> </span><span class="kw">fisher.test</span>(tab)</a>
<a class="sourceLine" id="cb194-2" data-line-number="2"><span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">OR     :&quot;</span>, ft<span class="op">$</span>estimate,</a>
<a class="sourceLine" id="cb194-3" data-line-number="3">    <span class="st">&quot;</span><span class="ch">\n</span><span class="st">95% CI :&quot;</span>, ft<span class="op">$</span>conf.int, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a></code></pre>
<p>Note that we can refer to components of a function’s output using the same syntax as when we refer to columns in a data.frame (e.g. <code>ft$estimate</code> to examine the estimate of the odds ratio from the <code>fisher.test()</code> function stored in the object <code>ft</code>).</p>
<p>The names of elements in the output of a standard function such as <code>fisher.test()</code> can be found in the documentation or the help system. For example:</p>
<pre class="sourceCode r" id="cb195"><code class="sourceCode r"><a class="sourceLine" id="cb195-1" data-line-number="1"><span class="kw">help</span>(fisher.test)</a></code></pre>
<p>Output elements are listed under the <code>Value</code> heading.</p>
<p>Revise the <code>tab2by2()</code> function to include the calculation of the odds ratio and the 95% confidence interval. The revised function will look something like this:</p>
<pre class="sourceCode r" id="cb196"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1"><span class="cf">function</span>(exposure, outcome) {</a>
<a class="sourceLine" id="cb196-2" data-line-number="2">  tab &lt;-<span class="st"> </span><span class="kw">table</span>(exposure, outcome)</a>
<a class="sourceLine" id="cb196-3" data-line-number="3">  a &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb196-4" data-line-number="4">  b &lt;-<span class="st"> </span>tab[<span class="dv">1</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb196-5" data-line-number="5">  c &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb196-6" data-line-number="6">  d &lt;-<span class="st"> </span>tab[<span class="dv">2</span>,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb196-7" data-line-number="7">  rr &lt;-<span class="st"> </span>(a <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b)) <span class="op">/</span><span class="st"> </span>(c <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d))</a>
<a class="sourceLine" id="cb196-8" data-line-number="8">  se.log.rr &lt;-<span class="st"> </span><span class="kw">sqrt</span>((b <span class="op">/</span><span class="st"> </span>a) <span class="op">/</span><span class="st"> </span>(a <span class="op">+</span><span class="st"> </span>b) <span class="op">+</span><span class="st"> </span>(d <span class="op">/</span><span class="st"> </span>c) <span class="op">/</span><span class="st"> </span>(c <span class="op">+</span><span class="st"> </span>d)) </a>
<a class="sourceLine" id="cb196-9" data-line-number="9">  lci.rr &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(rr) <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.rr)</a>
<a class="sourceLine" id="cb196-10" data-line-number="10">  uci.rr &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(rr) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.rr)</a>
<a class="sourceLine" id="cb196-11" data-line-number="11">  or &lt;-<span class="st"> </span>(a <span class="op">/</span><span class="st"> </span>b) <span class="op">/</span><span class="st"> </span>(c <span class="op">/</span><span class="st"> </span>d)</a>
<a class="sourceLine" id="cb196-12" data-line-number="12">  se.log.or &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>a <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>b <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>c <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>d)</a>
<a class="sourceLine" id="cb196-13" data-line-number="13">  lci.or &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(or) <span class="op">-</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.or)</a>
<a class="sourceLine" id="cb196-14" data-line-number="14">  uci.or &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="kw">log</span>(or) <span class="op">+</span><span class="st"> </span><span class="fl">1.96</span> <span class="op">*</span><span class="st"> </span>se.log.or)</a>
<a class="sourceLine" id="cb196-15" data-line-number="15">  ft &lt;-<span class="st"> </span><span class="kw">fisher.test</span>(tab)</a>
<a class="sourceLine" id="cb196-16" data-line-number="16">  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb196-17" data-line-number="17">  <span class="kw">print</span>(tab)</a>
<a class="sourceLine" id="cb196-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb196-19" data-line-number="19">  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Relative Risk     :&quot;</span>, rr,</a>
<a class="sourceLine" id="cb196-20" data-line-number="20">      <span class="st">&quot;</span><span class="ch">\n</span><span class="st">95% CI            :&quot;</span>, lci.rr, uci.rr, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb196-21" data-line-number="21">  </a>
<a class="sourceLine" id="cb196-22" data-line-number="22">  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">Sample Odds Ratio :&quot;</span>, or,</a>
<a class="sourceLine" id="cb196-23" data-line-number="23">      <span class="st">&quot;</span><span class="ch">\n</span><span class="st">95% CI            :&quot;</span>, lci.or, uci.or, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb196-24" data-line-number="24"></a>
<a class="sourceLine" id="cb196-25" data-line-number="25">  <span class="kw">cat</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">MLE Odds Ratio    :&quot;</span>, ft<span class="op">$</span>estimate,</a>
<a class="sourceLine" id="cb196-26" data-line-number="26">      <span class="st">&quot;</span><span class="ch">\n</span><span class="st">95% CI             :&quot;</span>,  ft<span class="op">$</span>conf.int, <span class="st">&quot;</span><span class="ch">\n\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb196-27" data-line-number="27">}</a></code></pre>
<p>Once you have made the changes shown above, check your work, save the file, and quit the editor.</p>
<p>Test the <code>tab2by2()</code> function when you have added the calculation of the odds ratio and its 95% confidence interval.</p>
<p>Now that we have a function that will calculate risk ratios and odds ratios with confidence intervals from a two- by-two table we can use it to analyse the <code>salex</code> data:</p>
<pre class="sourceCode r" id="cb197"><code class="sourceCode r"><a class="sourceLine" id="cb197-1" data-line-number="1"><span class="kw">tab2by2</span>(HAM, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 46 17
##        2  5  9
## 
## Relative Risk     : 2.044444 
## 95% CI            : 0.9964841 4.194501 
## 
## Sample Odds Ratio : 4.870588 
## 95% CI            : 1.428423 16.60756 
## 
## MLE Odds Ratio    : 4.75649 
## 95% CI             : 1.22777 20.82921</code></pre>
<pre class="sourceCode r" id="cb199"><code class="sourceCode r"><a class="sourceLine" id="cb199-1" data-line-number="1"><span class="kw">tab2by2</span>(BEEF, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 45 22
##        2  6  4
## 
## Relative Risk     : 1.119403 
## 95% CI            : 0.6568821 1.907592 
## 
## Sample Odds Ratio : 1.363636 
## 95% CI            : 0.3485746 5.334594 
## 
## MLE Odds Ratio    : 1.357903 
## 95% CI             : 0.2547114 6.428414</code></pre>
<pre class="sourceCode r" id="cb201"><code class="sourceCode r"><a class="sourceLine" id="cb201-1" data-line-number="1"><span class="kw">tab2by2</span>(EGGS, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 40  6
##        2 10 20
## 
## Relative Risk     : 2.608696 
## 95% CI            : 1.553564 4.38044 
## 
## Sample Odds Ratio : 13.33333 
## 95% CI            : 4.240168 41.92706 
## 
## MLE Odds Ratio    : 12.74512 
## 95% CI             : 3.762787 50.05419</code></pre>
<pre class="sourceCode r" id="cb203"><code class="sourceCode r"><a class="sourceLine" id="cb203-1" data-line-number="1"><span class="kw">tab2by2</span>(MUSHROOM, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 24  6
##        2 25 19
## 
## Relative Risk     : 1.408 
## 95% CI            : 1.028944 1.926697 
## 
## Sample Odds Ratio : 3.04 
## 95% CI            : 1.037274 8.909506 
## 
## MLE Odds Ratio    : 2.995207 
## 95% CI             : 0.9421008 10.7953</code></pre>
<pre class="sourceCode r" id="cb205"><code class="sourceCode r"><a class="sourceLine" id="cb205-1" data-line-number="1"><span class="kw">tab2by2</span>(PEPPER, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 24  3
##        2 23 22
## 
## Relative Risk     : 1.73913 
## 95% CI            : 1.26876 2.383882 
## 
## Sample Odds Ratio : 7.652174 
## 95% CI            : 2.013718 29.07844 
## 
## MLE Odds Ratio    : 7.448216 
## 95% CI             : 1.861728 44.12015</code></pre>
<pre class="sourceCode r" id="cb207"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1"><span class="kw">tab2by2</span>(PORKPIE, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 21  9
##        2 29 17
## 
## Relative Risk     : 1.110345 
## 95% CI            : 0.8044752 1.532509 
## 
## Sample Odds Ratio : 1.367816 
## 95% CI            : 0.5113158 3.659032 
## 
## MLE Odds Ratio    : 1.362228 
## 95% CI             : 0.4636016 4.190667</code></pre>
<pre class="sourceCode r" id="cb209"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1"><span class="kw">tab2by2</span>(PASTA, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 25  3
##        2 26 23
## 
## Relative Risk     : 1.682692 
## 95% CI            : 1.255392 2.255433 
## 
## Sample Odds Ratio : 7.371795 
## 95% CI            : 1.964371 27.66451 
## 
## MLE Odds Ratio    : 7.195422 
## 95% CI             : 1.829867 42.07488</code></pre>
<pre class="sourceCode r" id="cb211"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1"><span class="kw">tab2by2</span>(RICE, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 28  4
##        2 23 22
## 
## Relative Risk     : 1.711957 
## 95% CI            : 1.250197 2.344268 
## 
## Sample Odds Ratio : 6.695652 
## 95% CI            : 2.017327 22.22335 
## 
## MLE Odds Ratio    : 6.532868 
## 95% CI             : 1.852297 29.84928</code></pre>
<pre class="sourceCode r" id="cb213"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1"><span class="kw">tab2by2</span>(LETTUCE, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 28  1
##        2 23 25
## 
## Relative Risk     : 2.014993 
## 95% CI            : 1.488481 2.727744 
## 
## Sample Odds Ratio : 30.43478 
## 95% CI            : 3.826938 242.041 
## 
## MLE Odds Ratio    : 29.32825 
## 95% CI             : 4.161299 1284.306</code></pre>
<pre class="sourceCode r" id="cb215"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1"><span class="kw">tab2by2</span>(TOMATO, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 29  9
##        2 22 17
## 
## Relative Risk     : 1.352871 
## 95% CI            : 0.974698 1.877771 
## 
## Sample Odds Ratio : 2.489899 
## 95% CI            : 0.9347213 6.632562 
## 
## MLE Odds Ratio    : 2.459981 
## 95% CI             : 0.8467562 7.558026</code></pre>
<pre class="sourceCode r" id="cb217"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1"><span class="kw">tab2by2</span>(COLESLAW, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 29  3
##        2 21 23
## 
## Relative Risk     : 1.89881 
## 95% CI            : 1.366876 2.63775 
## 
## Sample Odds Ratio : 10.5873 
## 95% CI            : 2.806364 39.9417 
## 
## MLE Odds Ratio    : 10.26269 
## 95% CI             : 2.600771 60.35431</code></pre>
<pre class="sourceCode r" id="cb219"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" data-line-number="1"><span class="kw">tab2by2</span>(CRISPS, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 21 10
##        2 30 16
## 
## Relative Risk     : 1.03871 
## 95% CI            : 0.7529065 1.433004 
## 
## Sample Odds Ratio : 1.12 
## 95% CI            : 0.4258139 2.945888 
## 
## MLE Odds Ratio    : 1.118358 
## 95% CI             : 0.3858206 3.340535</code></pre>
<pre class="sourceCode r" id="cb221"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1"><span class="kw">tab2by2</span>(PEACHCAKE, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1  2  2
##        2 49 24
## 
## Relative Risk     : 0.744898 
## 95% CI            : 0.27594 2.010846 
## 
## Sample Odds Ratio : 0.4897959 
## 95% CI            : 0.06497947 3.691936 
## 
## MLE Odds Ratio    : 0.4947099 
## 95% CI             : 0.03393887 7.209143</code></pre>
<pre class="sourceCode r" id="cb223"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1"><span class="kw">tab2by2</span>(CHOCOLATE, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 12  2
##        2 38 24
## 
## Relative Risk     : 1.398496 
## 95% CI            : 1.045064 1.871456 
## 
## Sample Odds Ratio : 3.789474 
## 95% CI            : 0.7791326 18.43089 
## 
## MLE Odds Ratio    : 3.733535 
## 95% CI             : 0.7318646 37.28268</code></pre>
<pre class="sourceCode r" id="cb225"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1"><span class="kw">tab2by2</span>(FRUIT, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1  1  4
##        2 49 22
## 
## Relative Risk     : 0.2897959 
## 95% CI            : 0.04985828 1.684408 
## 
## Sample Odds Ratio : 0.1122449 
## 95% CI            : 0.01185022 1.06318 
## 
## MLE Odds Ratio    : 0.1157141 
## 95% CI             : 0.002240848 1.256134</code></pre>
<pre class="sourceCode r" id="cb227"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1"><span class="kw">tab2by2</span>(TRIFLE, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1 19  5
##        2 32 21
## 
## Relative Risk     : 1.311198 
## 95% CI            : 0.9718621 1.769016 
## 
## Sample Odds Ratio : 2.49375 
## 95% CI            : 0.8067804 7.708156 
## 
## MLE Odds Ratio    : 2.465794 
## 95% CI             : 0.7363311 9.778463</code></pre>
<pre class="sourceCode r" id="cb229"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1"><span class="kw">tab2by2</span>(ALMONDS, ILL)</a></code></pre>
<pre><code>## 
##         outcome
## exposure  1  2
##        1  3  3
##        2 38 19
## 
## Relative Risk     : 0.75 
## 95% CI            : 0.3300089 1.7045 
## 
## Sample Odds Ratio : 0.5 
## 95% CI            : 0.09203498 2.716358 
## 
## MLE Odds Ratio    : 0.505905 
## 95% CI             : 0.06170211 4.141891</code></pre>
<p>Make a note of any positive associations (i.e. with a risk ratio &gt; 1 with a 95% confidence intervals that does not include one). We will use these for the next exercise when we will use logistic regression to analyse this data.</p>
<p>Save the <code>tab2by2()</code> function:</p>
<pre class="sourceCode r" id="cb231"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1"><span class="kw">save</span>(tab2by2, <span class="dt">file =</span> <span class="st">&quot;tab2by2.r&quot;</span>)</a></code></pre>
<p>We can now quit <code>R</code>:</p>
<pre class="sourceCode r" id="cb232"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1"><span class="kw">q</span>()</a></code></pre>
<p>For this exercise there is no need to save the workspace image so click the <strong>No</strong> or <strong>Don’t Save</strong> button (GUI) or enter <code>n</code> when prompted to save the workspace image (terminal).</p>
<div id="summary-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Summary</h2>
<ul>
<li><p><code>R</code> objects contain information that can be examined and manipulated.</p></li>
<li><p><code>R</code> can be extended by writing new functions.</p></li>
<li><p>New functions can perform simple or complex data analysis.</p></li>
<li><p>New functions can be composed of parts of existing function.</p></li>
<li><p>New functions can be saved and used in subsequent <code>R</code> sessions.</p></li>
<li><p>Objects defined within functions are local to that function and only exist while that function is being used. This means that you can re-use meaningful names within functions without them interfering with each other.</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["prfe.pdf", "prfe.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
